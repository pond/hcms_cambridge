!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function($,t){function a(t){var e=!!t&&"length"in t&&t.length,i=pt.type(t);return"function"!==i&&!pt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&0<e&&e-1 in t)}function e(t,i,n){if(pt.isFunction(i))return pt.grep(t,function(t,e){return!!i.call(t,e,t)!==n});if(i.nodeType)return pt.grep(t,function(t){return t===i!==n});if("string"==typeof i){if($t.test(i))return pt.filter(i,t,n);i=pt.filter(i,t)}return pt.grep(t,function(t){return-1<pt.inArray(t,i)!==n})}function i(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function d(t){var i={};return pt.each(t.match(At)||[],function(t,e){i[e]=!0}),i}function s(){nt.addEventListener?(nt.removeEventListener("DOMContentLoaded",r),$.removeEventListener("load",r)):(nt.detachEvent("onreadystatechange",r),$.detachEvent("onload",r))}function r(){(nt.addEventListener||"load"===$.event.type||"complete"===nt.readyState)&&(s(),pt.ready())}function l(t,e,i){if(i===undefined&&1===t.nodeType){var n="data-"+e.replace(Ft,"-$1").toLowerCase();if("string"==typeof(i=t.getAttribute(n))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:Lt.test(i)?pt.parseJSON(i):i)}catch(s){}pt.data(t,e,i)}else i=undefined}return i}function c(t){var e;for(e in t)if(("data"!==e||!pt.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function n(t,e,i,n){if(Dt(t)){var s,r,o=pt.expando,a=t.nodeType,l=a?pt.cache:t,c=a?t[o]:t[o]&&o;if(c&&l[c]&&(n||l[c].data)||i!==undefined||"string"!=typeof e)return c||(c=a?t[o]=it.pop()||pt.guid++:o),l[c]||(l[c]=a?{}:{toJSON:pt.noop}),"object"!=typeof e&&"function"!=typeof e||(n?l[c]=pt.extend(l[c],e):l[c].data=pt.extend(l[c].data,e)),r=l[c],n||(r.data||(r.data={}),r=r.data),i!==undefined&&(r[pt.camelCase(e)]=i),"string"==typeof e?null==(s=r[e])&&(s=r[pt.camelCase(e)]):s=r,s}}function o(t,e,i){if(Dt(t)){var n,s,r=t.nodeType,o=r?pt.cache:t,a=r?t[pt.expando]:pt.expando;if(o[a]){if(e&&(n=i?o[a]:o[a].data)){s=(e=pt.isArray(e)?e.concat(pt.map(e,pt.camelCase)):e in n?[e]:(e=pt.camelCase(e))in n?[e]:e.split(" ")).length;for(;s--;)delete n[e[s]];if(i?!c(n):!pt.isEmptyObject(n))return}(i||(delete o[a].data,c(o[a])))&&(r?pt.cleanData([t],!0):ht.deleteExpando||o!=o.window?delete o[a]:o[a]=undefined)}}}function h(t,e,i,n){var s,r=1,o=20,a=n?function(){return n.cur()}:function(){return pt.css(t,e,"")},l=a(),c=i&&i[3]||(pt.cssNumber[e]?"":"px"),d=(pt.cssNumber[e]||"px"!==c&&+l)&&Ot.exec(pt.css(t,e));if(d&&d[3]!==c)for(c=c||d[3],i=i||[],d=+l||1;d/=r=r||".5",pt.style(t,e,d+c),r!==(r=a()/l)&&1!==r&&--o;);return i&&(d=+d||+l||0,s=i[1]?d+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=d,n.end=s)),s}function g(t){var e=Vt.split("|"),i=t.createDocumentFragment();if(i.createElement)for(;e.length;)i.createElement(e.pop());return i}function v(t,e){var i,n,s=0,r="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):undefined;if(!r)for(r=[],i=t.childNodes||t;null!=(n=i[s]);s++)!e||pt.nodeName(n,e)?r.push(n):pt.merge(r,v(n,e));return e===undefined||e&&pt.nodeName(t,e)?pt.merge([t],r):r}function b(t,e){for(var i,n=0;null!=(i=t[n]);n++)pt._data(i,"globalEval",!e||pt._data(e[n],"globalEval"))}function y(t){Wt.test(t.type)&&(t.defaultChecked=t.checked)}function m(t,e,i,n,s){for(var r,o,a,l,c,d,h,u=t.length,p=g(e),f=[],m=0;m<u;m++)if((o=t[m])||0===o)if("object"===pt.type(o))pt.merge(f,o.nodeType?[o]:o);else if(Gt.test(o)){for(l=l||p.appendChild(e.createElement("div")),c=(qt.exec(o)||["",""])[1].toLowerCase(),h=Xt[c]||Xt._default,l.innerHTML=h[1]+pt.htmlPrefilter(o)+h[2],r=h[0];r--;)l=l.lastChild;if(!ht.leadingWhitespace&&Kt.test(o)&&f.push(e.createTextNode(Kt.exec(o)[0])),!ht.tbody)for(r=(o="table"!==c||Yt.test(o)?"<table>"!==h[1]||Yt.test(o)?0:l:l.firstChild)&&o.childNodes.length;r--;)pt.nodeName(d=o.childNodes[r],"tbody")&&!d.childNodes.length&&o.removeChild(d);for(pt.merge(f,l.childNodes),l.textContent="";l.firstChild;)l.removeChild(l.firstChild);l=p.lastChild}else f.push(e.createTextNode(o));for(l&&p.removeChild(l),ht.appendChecked||pt.grep(v(f,"input"),y),m=0;o=f[m++];)if(n&&-1<pt.inArray(o,n))s&&s.push(o);else if(a=pt.contains(o.ownerDocument,o),l=v(p.appendChild(o),"script"),a&&b(l),i)for(r=0;o=l[r++];)Ut.test(o.type||"")&&i.push(o);return l=null,p}function u(){return!0}function p(){return!1}function f(){try{return nt.activeElement}catch(t){}}function _(t,e,i,n,s,r){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(n=n||i,i=undefined),e)_(t,a,i,n,e[a],r);return t}if(null==n&&null==s?(s=i,n=i=undefined):null==s&&("string"==typeof i?(s=n,n=undefined):(s=n,n=i,i=undefined)),!1===s)s=p;else if(!s)return t;return 1===r&&(o=s,(s=function(t){return pt().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=pt.guid++)),t.each(function(){pt.event.add(this,e,s,n,i)})}function x(t,e){return pt.nodeName(t,"table")&&pt.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function C(t){return t.type=(null!==pt.find.attr(t,"type"))+"/"+t.type,t}function E(t){var e=ae.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function w(t,e){if(1===e.nodeType&&pt.hasData(t)){var i,n,s,r=pt._data(t),o=pt._data(e,r),a=r.events;if(a)for(i in delete o.handle,o.events={},a)for(n=0,s=a[i].length;n<s;n++)pt.event.add(e,i,a[i][n]);o.data&&(o.data=pt.extend({},o.data))}}function T(t,e){var i,n,s;if(1===e.nodeType){if(i=e.nodeName.toLowerCase(),!ht.noCloneEvent&&e[pt.expando]){for(n in(s=pt._data(e)).events)pt.removeEvent(e,n,s.handle);e.removeAttribute(pt.expando)}"script"===i&&e.text!==t.text?(C(e).text=t.text,E(e)):"object"===i?(e.parentNode&&(e.outerHTML=t.outerHTML),ht.html5Clone&&t.innerHTML&&!pt.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===i&&Wt.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===i?e.defaultSelected=e.selected=t.defaultSelected:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}}function k(i,n,s,r){n=rt.apply([],n);var t,e,o,a,l,c,d=0,h=i.length,u=h-1,p=n[0],f=pt.isFunction(p);if(f||1<h&&"string"==typeof p&&!ht.checkClone&&oe.test(p))return i.each(function(t){var e=i.eq(t);f&&(n[0]=p.call(this,t,e.html())),k(e,n,s,r)});if(h&&(t=(c=m(n,i[0].ownerDocument,!1,i,r)).firstChild,1===c.childNodes.length&&(c=t),t||r)){for(o=(a=pt.map(v(c,"script"),C)).length;d<h;d++)e=c,d!==u&&(e=pt.clone(e,!0,!0),o&&pt.merge(a,v(e,"script"))),s.call(i[d],e,d);if(o)for(l=a[a.length-1].ownerDocument,pt.map(a,E),d=0;d<o;d++)e=a[d],Ut.test(e.type||"")&&!pt._data(e,"globalEval")&&pt.contains(l,e)&&(e.src?pt._evalUrl&&pt._evalUrl(e.src):pt.globalEval((e.text||e.textContent||e.innerHTML||"").replace(le,"")));c=t=null}return i}function R(t,e,i){for(var n,s=e?pt.filter(e,t):t,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||pt.cleanData(v(n)),n.parentNode&&(i&&pt.contains(n.ownerDocument,n)&&b(v(n,"script")),n.parentNode.removeChild(n));return t}function S(t,e){var i=pt(e.createElement(t)).appendTo(e.body),n=pt.css(i[0],"display");return i.detach(),n}function A(t){var e=nt,i=he[t];return i||("none"!==(i=S(t,e))&&i||((e=((de=(de||pt("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement))[0].contentWindow||de[0].contentDocument).document).write(),e.close(),i=S(t,e),de.detach()),he[t]=i),i}function N(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}function D(t){if(t in Te)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),i=we.length;i--;)if((t=we[i]+e)in Te)return t}function L(t,e){for(var i,n,s,r=[],o=0,a=t.length;o<a;o++)(n=t[o]).style&&(r[o]=pt._data(n,"olddisplay"),i=n.style.display,e?(r[o]||"none"!==i||(n.style.display=""),""===n.style.display&&Mt(n)&&(r[o]=pt._data(n,"olddisplay",A(n.nodeName)))):(s=Mt(n),(i&&"none"!==i||!s)&&pt._data(n,"olddisplay",s?i:pt.css(n,"display"))));for(o=0;o<a;o++)(n=t[o]).style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[o]||"":"none"));return t}function F(t,e,i){var n=Ce.exec(e);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):e}function I(t,e,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===e?1:0,o=0;r<4;r+=2)"margin"===i&&(o+=pt.css(t,i+Pt[r],!0,s)),n?("content"===i&&(o-=pt.css(t,"padding"+Pt[r],!0,s)),"margin"!==i&&(o-=pt.css(t,"border"+Pt[r]+"Width",!0,s))):(o+=pt.css(t,"padding"+Pt[r],!0,s),"padding"!==i&&(o+=pt.css(t,"border"+Pt[r]+"Width",!0,s)));return o}function B(t,e,i){var n=!0,s="width"===e?t.offsetWidth:t.offsetHeight,r=ge(t),o=ht.boxSizing&&"border-box"===pt.css(t,"boxSizing",!1,r);if(s<=0||null==s){if(((s=ve(t,e,r))<0||null==s)&&(s=t.style[e]),pe.test(s))return s;n=o&&(ht.boxSizingReliable()||s===t.style[e]),s=parseFloat(s)||0}return s+I(t,e,i||(o?"border":"content"),n,r)+"px"}function H(t,e,i,n,s){return new H.prototype.init(t,e,i,n,s)}function j(){return $.setTimeout(function(){ke=undefined}),ke=pt.now()}function O(t,e){var i,n={height:t},s=0;for(e=e?1:0;s<4;s+=2-e)n["margin"+(i=Pt[s])]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function P(t,e,i){for(var n,s=(W.tweeners[e]||[]).concat(W.tweeners["*"]),r=0,o=s.length;r<o;r++)if(n=s[r].call(i,e,t))return n}function M(e,t,i){var n,s,r,o,a,l,c,d=this,h={},u=e.style,p=e.nodeType&&Mt(e),f=pt._data(e,"fxshow");for(n in i.queue||(null==(a=pt._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,d.always(function(){d.always(function(){a.unqueued--,pt.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],"inline"===("none"===(c=pt.css(e,"display"))?pt._data(e,"olddisplay")||A(e.nodeName):c)&&"none"===pt.css(e,"float")&&(ht.inlineBlockNeedsLayout&&"inline"!==A(e.nodeName)?u.zoom=1:u.display="inline-block")),i.overflow&&(u.overflow="hidden",ht.shrinkWrapBlocks()||d.always(function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]})),t)if(s=t[n],Fe.exec(s)){if(delete t[n],r=r||"toggle"===s,s===(p?"hide":"show")){if("show"!==s||!f||f[n]===undefined)continue;p=!0}h[n]=f&&f[n]||pt.style(e,n)}else c=undefined;if(pt.isEmptyObject(h))"inline"===("none"===c?A(e.nodeName):c)&&(u.display=c);else for(n in f?"hidden"in f&&(p=f.hidden):f=pt._data(e,"fxshow",{}),r&&(f.hidden=!p),p?pt(e).show():d.done(function(){pt(e).hide()}),d.done(function(){var t;for(t in pt._removeData(e,"fxshow"),h)pt.style(e,t,h[t])}),h)o=P(p?f[n]:0,n,d),n in f||(f[n]=o.start,p&&(o.end=o.start,o.start="width"===n||"height"===n?1:0))}function z(t,e){var i,n,s,r,o;for(i in t)if(s=e[n=pt.camelCase(i)],r=t[i],pt.isArray(r)&&(s=r[1],r=t[i]=r[0]),i!==n&&(t[n]=r,delete t[i]),(o=pt.cssHooks[n])&&"expand"in o)for(i in r=o.expand(r),delete t[n],r)i in t||(t[i]=r[i],e[i]=s);else e[n]=s}function W(r,t,e){var i,o,n=0,s=W.prefilters.length,a=pt.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var t=ke||j(),e=Math.max(0,c.startTime+c.duration-t),i=1-(e/c.duration||0),n=0,s=c.tweens.length;n<s;n++)c.tweens[n].run(i);return a.notifyWith(r,[c,i,e]),i<1&&s?e:(a.resolveWith(r,[c]),!1)},c=a.promise({elem:r,props:pt.extend({},t),opts:pt.extend(!0,{specialEasing:{},easing:pt.easing._default},e),originalProperties:t,originalOptions:e,startTime:ke||j(),duration:e.duration,tweens:[],createTween:function(t,e){var i=pt.Tween(r,c.opts,t,e,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var e=0,i=t?c.tweens.length:0;if(o)return this;for(o=!0;e<i;e++)c.tweens[e].run(1);return t?(a.notifyWith(r,[c,1,0]),a.resolveWith(r,[c,t])):a.rejectWith(r,[c,t]),this}}),d=c.props;for(z(d,c.opts.specialEasing);n<s;n++)if(i=W.prefilters[n].call(c,r,d,c.opts))return pt.isFunction(i.stop)&&(pt._queueHooks(c.elem,c.opts.queue).stop=pt.proxy(i.stop,i)),i;return pt.map(d,P,c),pt.isFunction(c.opts.start)&&c.opts.start.call(r,c),pt.fx.timer(pt.extend(l,{elem:r,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function q(t){return pt.attr(t,"class")||""}function U(r){return function(t,e){"string"!=typeof t&&(e=t,t="*");var i,n=0,s=t.toLowerCase().match(At)||[];if(pt.isFunction(e))for(;i=s[n++];)"+"===i.charAt(0)?(i=i.slice(1)||"*",(r[i]=r[i]||[]).unshift(e)):(r[i]=r[i]||[]).push(e)}}function K(e,s,r,o){function a(t){var n;return l[t]=!0,pt.each(e[t]||[],function(t,e){var i=e(s,r,o);return"string"!=typeof i||c||l[i]?c?!(n=i):void 0:(s.dataTypes.unshift(i),a(i),!1)}),n}var l={},c=e===ri;return a(s.dataTypes[0])||!l["*"]&&a("*")}function V(t,e){var i,n,s=pt.ajaxSettings.flatOptions||{};for(n in e)e[n]!==undefined&&((s[n]?t:i||(i={}))[n]=e[n]);return i&&pt.extend(!0,t,i),t}function X(t,e,i){for(var n,s,r,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),s===undefined&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(o in a)if(a[o]&&a[o].test(s)){l.unshift(o);break}if(l[0]in i)r=l[0];else{for(o in i){if(!l[0]||t.converters[o+" "+l[0]]){r=o;break}n||(n=o)}r=r||n}if(r)return r!==l[0]&&l.unshift(r),i[r]}function G(t,e,i,n){var s,r,o,a,l,c={},d=t.dataTypes.slice();if(d[1])for(o in t.converters)c[o.toLowerCase()]=t.converters[o];for(r=d.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=r,r=d.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(!(o=c[l+" "+r]||c["* "+r]))for(s in c)if((a=s.split(" "))[1]===r&&(o=c[l+" "+a[0]]||c["* "+a[0]])){!0===o?o=c[s]:!0!==c[s]&&(r=a[0],d.unshift(a[1]));break}if(!0!==o)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(h){return{state:"parsererror",error:o?h:"No conversion from "+l+" to "+r}}}return{state:"success",data:e}}function Y(t){return t.style&&t.style.display||pt.css(t,"display")}function Q(t){if(!pt.contains(t.ownerDocument||nt,t))return!0;for(;t&&1===t.nodeType;){if("none"===Y(t)||"hidden"===t.type)return!0;t=t.parentNode}return!1}function J(i,t,n,s){var e;if(pt.isArray(t))pt.each(t,function(t,e){n||di.test(i)?s(i,e):J(i+"["+("object"==typeof e&&null!=e?t:"")+"]",e,n,s)});else if(n||"object"!==pt.type(t))s(i,t);else for(e in t)J(i+"["+e+"]",t[e],n,s)}function Z(){try{return new $.XMLHttpRequest}catch(t){}}function tt(){try{return new $.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function et(t){return pt.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}var it=[],nt=$.document,st=it.slice,rt=it.concat,ot=it.push,at=it.indexOf,lt={},ct=lt.toString,dt=lt.hasOwnProperty,ht={},ut="1.12.4",pt=function(t,e){return new pt.fn.init(t,e)},ft=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,mt=/^-ms-/,gt=/-([\da-z])/gi,vt=function(t,e){return e.toUpperCase()};pt.fn=pt.prototype={jquery:ut,constructor:pt,selector:"",length:0,toArray:function(){return st.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:st.call(this)},pushStack:function(t){var e=pt.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return pt.each(this,t)},map:function(i){return this.pushStack(pt.map(this,function(t,e){return i.call(t,e,t)}))},slice:function(){return this.pushStack(st.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(0<=i&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:ot,sort:it.sort,splice:it.splice},pt.extend=pt.fn.extend=function(t){var e,i,n,s,r,o,a=t||{},l=1,c=arguments.length,d=!1;for("boolean"==typeof a&&(d=a,a=arguments[l]||{},l++),"object"==typeof a||pt.isFunction(a)||(a={}),l===c&&(a=this,l--);l<c;l++)if(null!=(r=arguments[l]))for(s in r)e=a[s],a!==(n=r[s])&&(d&&n&&(pt.isPlainObject(n)||(i=pt.isArray(n)))?(i?(i=!1,o=e&&pt.isArray(e)?e:[]):o=e&&pt.isPlainObject(e)?e:{},a[s]=pt.extend(d,o,n)):n!==undefined&&(a[s]=n));return a},pt.extend({expando:"jQuery"+(ut+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===pt.type(t)},isArray:Array.isArray||function(t){return"array"===pt.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){var e=t&&t.toString();return!pt.isArray(t)&&0<=e-parseFloat(e)+1},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==pt.type(t)||t.nodeType||pt.isWindow(t))return!1;try{if(t.constructor&&!dt.call(t,"constructor")&&!dt.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(!ht.ownFirst)for(e in t)return dt.call(t,e);for(e in t);return e===undefined||dt.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?lt[ct.call(t)]||"object":typeof t},globalEval:function(t){t&&pt.trim(t)&&($.execScript||function(t){$.eval.call($,t)})(t)},camelCase:function(t){return t.replace(mt,"ms-").replace(gt,vt)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var i,n=0;if(a(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(ft,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(a(Object(t))?pt.merge(i,"string"==typeof t?[t]:t):ot.call(i,t)),i},inArray:function(t,e,i){var n;if(e){if(at)return at.call(e,t,i);for(n=e.length,i=i?i<0?Math.max(0,n+i):i:0;i<n;i++)if(i in e&&e[i]===t)return i}return-1},merge:function(t,e){for(var i=+e.length,n=0,s=t.length;n<i;)t[s++]=e[n++];if(i!=i)for(;e[n]!==undefined;)t[s++]=e[n++];return t.length=s,t},grep:function(t,e,i){for(var n=[],s=0,r=t.length,o=!i;s<r;s++)!e(t[s],s)!==o&&n.push(t[s]);return n},map:function(t,e,i){var n,s,r=0,o=[];if(a(t))for(n=t.length;r<n;r++)null!=(s=e(t[r],r,i))&&o.push(s);else for(r in t)null!=(s=e(t[r],r,i))&&o.push(s);return rt.apply([],o)},guid:1,proxy:function(t,e){var i,n,s;return"string"==typeof e&&(s=t[e],e=t,t=s),pt.isFunction(t)?(i=st.call(arguments,2),(n=function(){return t.apply(e||this,i.concat(st.call(arguments)))}).guid=t.guid=t.guid||pt.guid++,n):undefined},now:function(){return+new Date},support:ht}),"function"==typeof Symbol&&(pt.fn[Symbol.iterator]=it[Symbol.iterator]),pt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){lt["[object "+e+"]"]=e.toLowerCase()});var bt=function(i){function _(t,e,i,n){var s,r,o,a,l,c,d,h,u=e&&e.ownerDocument,p=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return i;if(!n&&((e?e.ownerDocument||e:P)!==D&&N(e),e=e||D,F)){if(11!==p&&(c=vt.exec(t)))if(s=c[1]){if(9===p){if(!(o=e.getElementById(s)))return i;if(o.id===s)return i.push(o),i}else if(u&&(o=u.getElementById(s))&&j(e,o)&&o.id===s)return i.push(o),i}else{if(c[2])return J.apply(i,e.getElementsByTagName(t)),i;if((s=c[3])&&v.getElementsByClassName&&e.getElementsByClassName)return J.apply(i,e.getElementsByClassName(s)),i}if(v.qsa&&!U[t+" "]&&(!I||!I.test(t))){if(1!==p)u=e,h=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(yt,"\\$&"):e.setAttribute("id",a=O),r=(d=w(t)).length,l=ut.test(a)?"#"+a:"[id='"+a+"']";r--;)d[r]=l+" "+g(d[r]);h=d.join(","),u=bt.test(t)&&m(e.parentNode)||e}if(h)try{return J.apply(i,u.querySelectorAll(h)),i}catch(f){}finally{a===O&&e.removeAttribute("id")}}}return k(t.replace(at,"$1"),e,i,n)}function t(){function i(t,e){return n.push(t+" ")>C.cacheLength&&delete i[n.shift()],i[t+" "]=e}var n=[];return i}function l(t){return t[O]=!0,t}function s(t){var e=D.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function e(t,e){for(var i=t.split("|"),n=i.length;n--;)C.attrHandle[i[n]]=e}function c(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||V)-(~t.sourceIndex||V);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function n(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function r(i){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===i}}function o(o){return l(function(r){return r=+r,l(function(t,e){for(var i,n=o([],t.length,r),s=n.length;s--;)t[i=n[s]]&&(t[i]=!(e[i]=t[i]))})})}function m(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function a(){}function g(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function h(a,t,e){var l=t.dir,c=e&&"parentNode"===l,d=z++;return t.first?function(t,e,i){for(;t=t[l];)if(1===t.nodeType||c)return a(t,e,i)}:function(t,e,i){var n,s,r,o=[M,d];if(i){for(;t=t[l];)if((1===t.nodeType||c)&&a(t,e,i))return!0}else for(;t=t[l];)if(1===t.nodeType||c){if((n=(s=(r=t[O]||(t[O]={}))[t.uniqueID]||(r[t.uniqueID]={}))[l])&&n[0]===M&&n[1]===d)return o[2]=n[2];if((s[l]=o)[2]=a(t,e,i))return!0}}}function u(s){return 1<s.length?function(t,e,i){for(var n=s.length;n--;)if(!s[n](t,e,i))return!1;return!0}:s[0]}function b(t,e,i){for(var n=0,s=e.length;n<s;n++)_(t,e[n],i);return i}function x(t,e,i,n,s){for(var r,o=[],a=0,l=t.length,c=null!=e;a<l;a++)(r=t[a])&&(i&&!i(r,n,s)||(o.push(r),c&&e.push(a)));return o}function y(p,f,m,g,v,t){return g&&!g[O]&&(g=y(g)),v&&!v[O]&&(v=y(v,t)),l(function(t,e,i,n){var s,r,o,a=[],l=[],c=e.length,d=t||b(f||"*",i.nodeType?[i]:i,[]),h=!p||!t&&f?d:x(d,a,p,i,n),u=m?v||(t?p:c||g)?[]:e:h;if(m&&m(h,u,i,n),g)for(s=x(u,l),g(s,[],i,n),r=s.length;r--;)(o=s[r])&&(u[l[r]]=!(h[l[r]]=o));if(t){if(v||p){if(v){for(s=[],r=u.length;r--;)(o=u[r])&&s.push(h[r]=o);v(null,u=[],s,n)}for(r=u.length;r--;)(o=u[r])&&-1<(s=v?tt(t,o):a[r])&&(t[s]=!(e[s]=o))}}else u=x(u===e?u.splice(c,u.length):u),v?v(null,e,u,n):J.apply(e,u)})}function p(t){for(var s,e,i,n=t.length,r=C.relative[t[0].type],o=r||C.relative[" "],a=r?1:0,l=h(function(t){return t===s},o,!0),c=h(function(t){return-1<tt(s,t)},o,!0),d=[function(t,e,i){var n=!r&&(i||e!==R)||((s=e).nodeType?l(t,e,i):c(t,e,i));return s=null,n}];a<n;a++)if(e=C.relative[t[a].type])d=[h(u(d),e)];else{if((e=C.filter[t[a].type].apply(null,t[a].matches))[O]){for(i=++a;i<n&&!C.relative[t[i].type];i++);return y(1<a&&u(d),1<a&&g(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),e,a<i&&p(t.slice(a,i)),i<n&&p(t=t.slice(i)),i<n&&g(t))}d.push(e)}return u(d)}function d(g,v){var b=0<v.length,y=0<g.length,t=function(t,e,i,n,s){var r,o,a,l=0,c="0",d=t&&[],h=[],u=R,p=t||y&&C.find.TAG("*",s),f=M+=null==u?1:Math.random()||.1,m=p.length;for(s&&(R=e===D||e||s);c!==m&&null!=(r=p[c]);c++){if(y&&r){for(o=0,e||r.ownerDocument===D||(N(r),i=!F);a=g[o++];)if(a(r,e||D,i)){n.push(r);break}s&&(M=f)}b&&((r=!a&&r)&&l--,t&&d.push(r))}if(l+=c,b&&c!==l){for(o=0;a=v[o++];)a(d,h,e,i);if(t){if(0<l)for(;c--;)d[c]||h[c]||(h[c]=Y.call(n));h=x(h)}J.apply(n,h),s&&!t&&0<h.length&&1<l+v.length&&_.uniqueSort(n)}return s&&(M=f,R=u),d};return b?l(t):t}var f,v,C,$,E,w,T,k,R,S,A,N,D,L,F,I,B,H,j,O="sizzle"+1*new Date,P=i.document,M=0,z=0,W=t(),q=t(),U=t(),K=function(t,e){return t===e&&(A=!0),0},V=1<<31,X={}.hasOwnProperty,G=[],Y=G.pop,Q=G.push,J=G.push,Z=G.slice,tt=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",st="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",rt=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+st+")*)|.*)\\)|)",ot=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ct=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),dt=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ht=new RegExp(rt),ut=new RegExp("^"+nt+"$"),pt={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt+"|[*])"),ATTR:new RegExp("^"+st),PSEUDO:new RegExp("^"+rt),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,mt=/^h\d$/i,gt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bt=/[+~]/,yt=/'|\\/g,_t=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),xt=function(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},Ct=function(){N()};try{J.apply(G=Z.call(P.childNodes),P.childNodes),G[P.childNodes.length].nodeType}catch($t){J={apply:G.length?function(t,e){Q.apply(t,Z.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}for(f in v=_.support={},E=_.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},N=_.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:P;return n!==D&&9===n.nodeType&&n.documentElement&&(L=(D=n).documentElement,F=!E(D),(i=D.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Ct,!1):i.attachEvent&&i.attachEvent("onunload",Ct)),v.attributes=s(function(t){return t.className="i",!t.getAttribute("className")}),v.getElementsByTagName=s(function(t){return t.appendChild(D.createComment("")),!t.getElementsByTagName("*").length}),v.getElementsByClassName=gt.test(D.getElementsByClassName),v.getById=s(function(t){return L.appendChild(t).id=O,!D.getElementsByName||!D.getElementsByName(O).length}),v.getById?(C.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&F){var i=e.getElementById(t);return i?[i]:[]}},C.filter.ID=function(t){var e=t.replace(_t,xt);return function(t){return t.getAttribute("id")===e}}):(delete C.find.ID,C.filter.ID=function(t){var i=t.replace(_t,xt);return function(t){var e="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return e&&e.value===i}}),C.find.TAG=v.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):v.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],s=0,r=e.getElementsByTagName(t);if("*"!==t)return r;for(;i=r[s++];)1===i.nodeType&&n.push(i);return n},C.find.CLASS=v.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&F)return e.getElementsByClassName(t)},B=[],I=[],(v.qsa=gt.test(D.querySelectorAll))&&(s(function(t){L.appendChild(t).innerHTML="<a id='"+O+"'></a><select id='"+O+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&I.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||I.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+O+"-]").length||I.push("~="),t.querySelectorAll(":checked").length||I.push(":checked"),t.querySelectorAll("a#"+O+"+*").length||I.push(".#.+[+~]")}),s(function(t){var e=D.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&I.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||I.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),I.push(",.*:")})),(v.matchesSelector=gt.test(H=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&s(function(t){v.disconnectedMatch=H.call(t,"div"),H.call(t,"[s!='']:x"),B.push("!=",rt)}),I=I.length&&new RegExp(I.join("|")),B=B.length&&new RegExp(B.join("|")),e=gt.test(L.compareDocumentPosition),j=e||gt.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},K=e?function(t,e){if(t===e)return A=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!v.sortDetached&&e.compareDocumentPosition(t)===i?t===D||t.ownerDocument===P&&j(P,t)?-1:e===D||e.ownerDocument===P&&j(P,e)?1:S?tt(S,t)-tt(S,e):0:4&i?-1:1)}:function(t,e){if(t===e)return A=!0,0;var i,n=0,s=t.parentNode,r=e.parentNode,o=[t],a=[e];if(!s||!r)return t===D?-1:e===D?1:s?-1:r?1:S?tt(S,t)-tt(S,e):0;if(s===r)return c(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[n]===a[n];)n++;return n?c(o[n],a[n]):o[n]===P?-1:a[n]===P?1:0}),D},_.matches=function(t,e){return _(t,null,null,e)},_.matchesSelector=function(t,e){if((t.ownerDocument||t)!==D&&N(t),e=e.replace(dt,"='$1']"),v.matchesSelector&&F&&!U[e+" "]&&(!B||!B.test(e))&&(!I||!I.test(e)))try{var i=H.call(t,e);if(i||v.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch($t){}return 0<_(e,D,null,[t]).length},_.contains=function(t,e){return(t.ownerDocument||t)!==D&&N(t),j(t,e)},_.attr=function(t,e){(t.ownerDocument||t)!==D&&N(t);var i=C.attrHandle[e.toLowerCase()],n=i&&X.call(C.attrHandle,e.toLowerCase())?i(t,e,!F):undefined;return n!==undefined?n:v.attributes||!F?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},_.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},_.uniqueSort=function(t){var e,i=[],n=0,s=0;if(A=!v.detectDuplicates,S=!v.sortStable&&t.slice(0),t.sort(K),A){for(;e=t[s++];)e===t[s]&&(n=i.push(s));for(;n--;)t.splice(i[n],1)}return S=null,t},$=_.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=$(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=$(e);return i},(C=_.selectors={cacheLength:50,createPseudo:l,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(_t,xt),t[3]=(t[3]||t[4]||t[5]||"").replace(_t,xt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||_.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&_.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ht.test(i)&&(e=w(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(_t,xt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(i,n,s){return function(t){var e=_.attr(t,i);return null==e?"!="===n:!n||(e+="","="===n?e===s:"!="===n?e!==s:"^="===n?s&&0===e.indexOf(s):"*="===n?s&&-1<e.indexOf(s):"$="===n?s&&e.slice(-s.length)===s:"~="===n?-1<(" "+e.replace(ot," ")+" ").indexOf(s):"|="===n&&(e===s||e.slice(0,s.length+1)===s+"-"))}},CHILD:function(f,t,e,m,g){var v="nth"!==f.slice(0,3),b="last"!==f.slice(-4),y="of-type"===t;return 1===m&&0===g?function(t){return!!t.parentNode}:function(t,e,i){var n,s,r,o,a,l,c=v!==b?"nextSibling":"previousSibling",d=t.parentNode,h=y&&t.nodeName.toLowerCase(),u=!i&&!y,p=!1;if(d){if(v){for(;c;){for(o=t;o=o[c];)if(y?o.nodeName.toLowerCase()===h:1===o.nodeType)return!1;l=c="only"===f&&!l&&"nextSibling"}return!0}if(l=[b?d.firstChild:d.lastChild],b&&u){for(p=(a=(n=(s=(r=(o=d)[O]||(o[O]={}))[o.uniqueID]||(r[o.uniqueID]={}))[f]||[])[0]===M&&n[1])&&n[2],o=a&&d.childNodes[a];o=++a&&o&&o[c]||(p=a=0)||l.pop();)if(1===o.nodeType&&++p&&o===t){s[f]=[M,a,p];break}}else if(u&&(p=a=(n=(s=(r=(o=t)[O]||(o[O]={}))[o.uniqueID]||(r[o.uniqueID]={}))[f]||[])[0]===M&&n[1]),!1===p)for(;(o=++a&&o&&o[c]||(p=a=0)||l.pop())&&((y?o.nodeName.toLowerCase()!==h:1!==o.nodeType)||!++p||(u&&((s=(r=o[O]||(o[O]={}))[o.uniqueID]||(r[o.uniqueID]={}))[f]=[M,p]),o!==t)););return(p-=g)===m||p%m==0&&0<=p/m}}},PSEUDO:function(t,r){var e,o=C.pseudos[t]||C.setFilters[t.toLowerCase()]||_.error("unsupported pseudo: "+t);return o[O]?o(r):1<o.length?(e=[t,t,"",r],C.setFilters.hasOwnProperty(t.toLowerCase())?l(function(t,e){for(var i,n=o(t,r),s=n.length;s--;)t[i=tt(t,n[s])]=!(e[i]=n[s])}):function(t){return o(t,0,e)}):o}},pseudos:{
not:l(function(t){var n=[],s=[],a=T(t.replace(at,"$1"));return a[O]?l(function(t,e,i,n){for(var s,r=a(t,null,n,[]),o=t.length;o--;)(s=r[o])&&(t[o]=!(e[o]=s))}):function(t,e,i){return n[0]=t,a(n,null,i,s),n[0]=null,!s.pop()}}),has:l(function(e){return function(t){return 0<_(e,t).length}}),contains:l(function(e){return e=e.replace(_t,xt),function(t){return-1<(t.textContent||t.innerText||$(t)).indexOf(e)}}),lang:l(function(i){return ut.test(i||"")||_.error("unsupported lang: "+i),i=i.replace(_t,xt).toLowerCase(),function(t){var e;do{if(e=F?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(e=e.toLowerCase())===i||0===e.indexOf(i+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===L},focus:function(t){return t===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return mt.test(t.nodeName)},input:function(t){return ft.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:o(function(){return[0]}),last:o(function(t,e){return[e-1]}),eq:o(function(t,e,i){return[i<0?i+e:i]}),even:o(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:o(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:o(function(t,e,i){for(var n=i<0?i+e:i;0<=--n;)t.push(n);return t}),gt:o(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}}).pseudos.nth=C.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[f]=n(f);for(f in{submit:!0,reset:!0})C.pseudos[f]=r(f);return a.prototype=C.filters=C.pseudos,C.setFilters=new a,w=_.tokenize=function(t,e){var i,n,s,r,o,a,l,c=q[t+" "];if(c)return e?0:c.slice(0);for(o=t,a=[],l=C.preFilter;o;){for(r in i&&!(n=lt.exec(o))||(n&&(o=o.slice(n[0].length)||o),a.push(s=[])),i=!1,(n=ct.exec(o))&&(i=n.shift(),s.push({value:i,type:n[0].replace(at," ")}),o=o.slice(i.length)),C.filter)!(n=pt[r].exec(o))||l[r]&&!(n=l[r](n))||(i=n.shift(),s.push({value:i,type:r,matches:n}),o=o.slice(i.length));if(!i)break}return e?o.length:o?_.error(t):q(t,a).slice(0)},T=_.compile=function(t,e){var i,n=[],s=[],r=U[t+" "];if(!r){for(e||(e=w(t)),i=e.length;i--;)(r=p(e[i]))[O]?n.push(r):s.push(r);(r=U(t,d(s,n))).selector=t}return r},k=_.select=function(t,e,i,n){var s,r,o,a,l,c="function"==typeof t&&t,d=!n&&w(t=c.selector||t);if(i=i||[],1===d.length){if(2<(r=d[0]=d[0].slice(0)).length&&"ID"===(o=r[0]).type&&v.getById&&9===e.nodeType&&F&&C.relative[r[1].type]){if(!(e=(C.find.ID(o.matches[0].replace(_t,xt),e)||[])[0]))return i;c&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(s=pt.needsContext.test(t)?0:r.length;s--&&(o=r[s],!C.relative[a=o.type]);)if((l=C.find[a])&&(n=l(o.matches[0].replace(_t,xt),bt.test(r[0].type)&&m(e.parentNode)||e))){if(r.splice(s,1),!(t=n.length&&g(r)))return J.apply(i,n),i;break}}return(c||T(t,d))(n,e,!F,i,!e||bt.test(t)&&m(e.parentNode)||e),i},v.sortStable=O.split("").sort(K).join("")===O,v.detectDuplicates=!!A,N(),v.sortDetached=s(function(t){return 1&t.compareDocumentPosition(D.createElement("div"))}),s(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||e("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),v.attributes&&s(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||e("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),s(function(t){return null==t.getAttribute("disabled")})||e(et,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),_}($);pt.find=bt,pt.expr=bt.selectors,pt.expr[":"]=pt.expr.pseudos,pt.uniqueSort=pt.unique=bt.uniqueSort,pt.text=bt.getText,pt.isXMLDoc=bt.isXML,pt.contains=bt.contains;var yt=function(t,e,i){for(var n=[],s=i!==undefined;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&pt(t).is(i))break;n.push(t)}return n},_t=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},xt=pt.expr.match.needsContext,Ct=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,$t=/^.[^:#\[\.,]*$/;pt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?pt.find.matchesSelector(n,t)?[n]:[]:pt.find.matches(t,pt.grep(e,function(t){return 1===t.nodeType}))},pt.fn.extend({find:function(t){var e,i=[],n=this,s=n.length;if("string"!=typeof t)return this.pushStack(pt(t).filter(function(){for(e=0;e<s;e++)if(pt.contains(n[e],this))return!0}));for(e=0;e<s;e++)pt.find(t,n[e],i);return(i=this.pushStack(1<s?pt.unique(i):i)).selector=this.selector?this.selector+" "+t:t,i},filter:function(t){return this.pushStack(e(this,t||[],!1))},not:function(t){return this.pushStack(e(this,t||[],!0))},is:function(t){return!!e(this,"string"==typeof t&&xt.test(t)?pt(t):t||[],!1).length}});var Et,wt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(pt.fn.init=function(t,e,i){var n,s;if(!t)return this;if(i=i||Et,"string"!=typeof t)return t.nodeType?(this.context=this[0]=t,this.length=1,this):pt.isFunction(t)?"undefined"!=typeof i.ready?i.ready(t):t(pt):(t.selector!==undefined&&(this.selector=t.selector,this.context=t.context),pt.makeArray(t,this));if(!(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:wt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof pt?e[0]:e,pt.merge(this,pt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:nt,!0)),Ct.test(n[1])&&pt.isPlainObject(e))for(n in e)pt.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}if((s=nt.getElementById(n[2]))&&s.parentNode){if(s.id!==n[2])return Et.find(t);this.length=1,this[0]=s}return this.context=nt,this.selector=t,this}).prototype=pt.fn,Et=pt(nt);var Tt=/^(?:parents|prev(?:Until|All))/,kt={children:!0,contents:!0,next:!0,prev:!0};pt.fn.extend({has:function(t){var e,i=pt(t,this),n=i.length;return this.filter(function(){for(e=0;e<n;e++)if(pt.contains(this,i[e]))return!0})},closest:function(t,e){for(var i,n=0,s=this.length,r=[],o=xt.test(t)||"string"!=typeof t?pt(t,e||this.context):0;n<s;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?-1<o.index(i):1===i.nodeType&&pt.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(1<r.length?pt.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?pt.inArray(this[0],pt(t)):pt.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(pt.uniqueSort(pt.merge(this.get(),pt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),pt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return yt(t,"parentNode")},parentsUntil:function(t,e,i){return yt(t,"parentNode",i)},next:function(t){return i(t,"nextSibling")},prev:function(t){return i(t,"previousSibling")},nextAll:function(t){return yt(t,"nextSibling")},prevAll:function(t){return yt(t,"previousSibling")},nextUntil:function(t,e,i){return yt(t,"nextSibling",i)},prevUntil:function(t,e,i){return yt(t,"previousSibling",i)},siblings:function(t){return _t((t.parentNode||{}).firstChild,t)},children:function(t){return _t(t.firstChild)},contents:function(t){return pt.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:pt.merge([],t.childNodes)}},function(n,s){pt.fn[n]=function(t,e){var i=pt.map(this,s,t);return"Until"!==n.slice(-5)&&(e=t),e&&"string"==typeof e&&(i=pt.filter(e,i)),1<this.length&&(kt[n]||(i=pt.uniqueSort(i)),Tt.test(n)&&(i=i.reverse())),this.pushStack(i)}});var Rt,St,At=/\S+/g;for(St in pt.Callbacks=function(n){n="string"==typeof n?d(n):pt.extend({},n);var s,t,e,i,r=[],o=[],a=-1,l=function(){for(i=n.once,e=s=!0;o.length;a=-1)for(t=o.shift();++a<r.length;)!1===r[a].apply(t[0],t[1])&&n.stopOnFalse&&(a=r.length,t=!1);n.memory||(t=!1),s=!1,i&&(r=t?[]:"")},c={add:function(){return r&&(t&&!s&&(a=r.length-1,o.push(t)),function i(t){pt.each(t,function(t,e){pt.isFunction(e)?n.unique&&c.has(e)||r.push(e):e&&e.length&&"string"!==pt.type(e)&&i(e)})}(arguments),t&&!s&&l()),this},remove:function(){return pt.each(arguments,function(t,e){for(var i;-1<(i=pt.inArray(e,r,i));)r.splice(i,1),i<=a&&a--}),this},has:function(t){return t?-1<pt.inArray(t,r):0<r.length},empty:function(){return r&&(r=[]),this},disable:function(){return i=o=[],r=t="",this},disabled:function(){return!r},lock:function(){return i=!0,t||c.disable(),this},locked:function(){return!!i},fireWith:function(t,e){return i||(e=[t,(e=e||[]).slice?e.slice():e],o.push(e),s||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!e}};return c},pt.extend({Deferred:function(t){var r=[["resolve","done",pt.Callbacks("once memory"),"resolved"],["reject","fail",pt.Callbacks("once memory"),"rejected"],["notify","progress",pt.Callbacks("memory")]],s="pending",o={state:function(){return s},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var s=arguments;return pt.Deferred(function(n){pt.each(r,function(t,e){var i=pt.isFunction(s[t])&&s[t];a[e[1]](function(){var t=i&&i.apply(this,arguments);t&&pt.isFunction(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[e[0]+"With"](this===o?n.promise():this,i?[t]:arguments)})}),s=null}).promise()},promise:function(t){return null!=t?pt.extend(t,o):o}},a={};return o.pipe=o.then,pt.each(r,function(t,e){var i=e[2],n=e[3];o[e[1]]=i.add,n&&i.add(function(){s=n},r[1^t][2].disable,r[2][2].lock),a[e[0]]=function(){return a[e[0]+"With"](this===a?o:this,arguments),this},a[e[0]+"With"]=i.fireWith}),o.promise(a),t&&t.call(a,a),a},when:function(t){var s,e,i,n=0,r=st.call(arguments),o=r.length,a=1!==o||t&&pt.isFunction(t.promise)?o:0,l=1===a?t:pt.Deferred(),c=function(e,i,n){return function(t){i[e]=this,n[e]=1<arguments.length?st.call(arguments):t,n===s?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(1<o)for(s=new Array(o),e=new Array(o),i=new Array(o);n<o;n++)r[n]&&pt.isFunction(r[n].promise)?r[n].promise().progress(c(n,e,s)).done(c(n,i,r)).fail(l.reject):--a;return a||l.resolveWith(i,r),l.promise()}}),pt.fn.ready=function(t){return pt.ready.promise().done(t),this},pt.extend({isReady:!1,readyWait:1,holdReady:function(t){t?pt.readyWait++:pt.ready(!0)},ready:function(t){(!0===t?--pt.readyWait:pt.isReady)||(pt.isReady=!0)!==t&&0<--pt.readyWait||(Rt.resolveWith(nt,[pt]),pt.fn.triggerHandler&&(pt(nt).triggerHandler("ready"),pt(nt).off("ready")))}}),pt.ready.promise=function(t){if(!Rt)if(Rt=pt.Deferred(),"complete"===nt.readyState||"loading"!==nt.readyState&&!nt.documentElement.doScroll)$.setTimeout(pt.ready);else if(nt.addEventListener)nt.addEventListener("DOMContentLoaded",r),$.addEventListener("load",r);else{nt.attachEvent("onreadystatechange",r),$.attachEvent("onload",r);var e=!1;try{e=null==$.frameElement&&nt.documentElement}catch(i){}e&&e.doScroll&&function n(){if(!pt.isReady){try{e.doScroll("left")}catch(i){return $.setTimeout(n,50)}s(),pt.ready()}}()}return Rt.promise(t)},pt.ready.promise(),pt(ht))break;ht.ownFirst="0"===St,ht.inlineBlockNeedsLayout=!1,pt(function(){var t,e,i,n;(i=nt.getElementsByTagName("body")[0])&&i.style&&(e=nt.createElement("div"),(n=nt.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(e),"undefined"!=typeof e.style.zoom&&(e.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ht.inlineBlockNeedsLayout=t=3===e.offsetWidth,t&&(i.style.zoom=1)),i.removeChild(n))}),function(){var t=nt.createElement("div");ht.deleteExpando=!0;try{delete t.test}catch(e){ht.deleteExpando=!1}t=null}();var Nt,Dt=function(t){var e=pt.noData[(t.nodeName+" ").toLowerCase()],i=+t.nodeType||1;return(1===i||9===i)&&(!e||!0!==e&&t.getAttribute("classid")===e)},Lt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ft=/([A-Z])/g;pt.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return!!(t=t.nodeType?pt.cache[t[pt.expando]]:t[pt.expando])&&!c(t)},data:function(t,e,i){return n(t,e,i)},removeData:function(t,e){return o(t,e)},_data:function(t,e,i){return n(t,e,i,!0)},_removeData:function(t,e){return o(t,e,!0)}}),pt.fn.extend({data:function(t,e){var i,n,s,r=this[0],o=r&&r.attributes;if(t!==undefined)return"object"==typeof t?this.each(function(){pt.data(this,t)}):1<arguments.length?this.each(function(){pt.data(this,t,e)}):r?l(r,t,pt.data(r,t)):undefined;if(this.length&&(s=pt.data(r),1===r.nodeType&&!pt._data(r,"parsedAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&l(r,n=pt.camelCase(n.slice(5)),s[n]);pt._data(r,"parsedAttrs",!0)}return s},removeData:function(t){return this.each(function(){pt.removeData(this,t)})}}),pt.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=pt._data(t,e),i&&(!n||pt.isArray(i)?n=pt._data(t,e,pt.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=pt.queue(t,e),n=i.length,s=i.shift(),r=pt._queueHooks(t,e),o=function(){pt.dequeue(t,e)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===e&&i.unshift("inprogress"),delete r.stop,s.call(t,o,r)),!n&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return pt._data(t,i)||pt._data(t,i,{empty:pt.Callbacks("once memory").add(function(){pt._removeData(t,e+"queue"),pt._removeData(t,i)})})}}),pt.fn.extend({queue:function(e,i){var t=2;return"string"!=typeof e&&(i=e,e="fx",t--),arguments.length<t?pt.queue(this[0],e):i===undefined?this:this.each(function(){var t=pt.queue(this,e,i);pt._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&pt.dequeue(this,e)})},dequeue:function(t){return this.each(function(){pt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,s=pt.Deferred(),r=this,o=this.length,a=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=undefined),t=t||"fx";o--;)(i=pt._data(r[o],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),s.promise(e)}}),ht.shrinkWrapBlocks=function(){return null!=Nt?Nt:(Nt=!1,(e=nt.getElementsByTagName("body")[0])&&e.style?(t=nt.createElement("div"),(i=nt.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",e.appendChild(i).appendChild(t),"undefined"!=typeof t.style.zoom&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(nt.createElement("div")).style.width="5px",Nt=3!==t.offsetWidth),e.removeChild(i),Nt):void 0);var t,e,i};var It,Bt,Ht,jt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ot=new RegExp("^(?:([+-])=|)("+jt+")([a-z%]*)$","i"),Pt=["Top","Right","Bottom","Left"],Mt=function(t,e){return t=e||t,"none"===pt.css(t,"display")||!pt.contains(t.ownerDocument,t)},zt=function(t,e,i,n,s,r,o){var a=0,l=t.length,c=null==i;if("object"===pt.type(i))for(a in s=!0,i)zt(t,e,a,i[a],!0,r,o);else if(n!==undefined&&(s=!0,pt.isFunction(n)||(o=!0),c&&(o?(e.call(t,n),e=null):(c=e,e=function(t,e,i){return c.call(pt(t),i)})),e))for(;a<l;a++)e(t[a],i,o?n:n.call(t[a],a,e(t[a],i)));return s?t:c?e.call(t):l?e(t[0],i):r},Wt=/^(?:checkbox|radio)$/i,qt=/<([\w:-]+)/,Ut=/^$|\/(?:java|ecma)script/i,Kt=/^\s+/,Vt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";It=nt.createElement("div"),Bt=nt.createDocumentFragment(),Ht=nt.createElement("input"),It.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ht.leadingWhitespace=3===It.firstChild.nodeType,ht.tbody=!It.getElementsByTagName("tbody").length,ht.htmlSerialize=!!It.getElementsByTagName("link").length,ht.html5Clone="<:nav></:nav>"!==nt.createElement("nav").cloneNode(!0).outerHTML,Ht.type="checkbox",Ht.checked=!0,Bt.appendChild(Ht),ht.appendChecked=Ht.checked,It.innerHTML="<textarea>x</textarea>",ht.noCloneChecked=!!It.cloneNode(!0).lastChild.defaultValue,Bt.appendChild(It),(Ht=nt.createElement("input")).setAttribute("type","radio"),Ht.setAttribute("checked","checked"),Ht.setAttribute("name","t"),It.appendChild(Ht),ht.checkClone=It.cloneNode(!0).cloneNode(!0).lastChild.checked,ht.noCloneEvent=!!It.addEventListener,It[pt.expando]=1,ht.attributes=!It.getAttribute(pt.expando);var Xt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ht.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};Xt.optgroup=Xt.option,Xt.tbody=Xt.tfoot=Xt.colgroup=Xt.caption=Xt.thead,Xt.th=Xt.td;var Gt=/<|&#?\w+;/,Yt=/<tbody/i;!function(){var t,e,i=nt.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})e="on"+t,(ht[t]=e in $)||(i.setAttribute(e,"t"),ht[t]=!1===i.attributes[e].expando);i=null}();var Qt=/^(?:input|select|textarea)$/i,Jt=/^key/,Zt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,te=/^(?:focusinfocus|focusoutblur)$/,ee=/^([^.]*)(?:\.(.+)|)/;pt.event={global:{},add:function(t,e,i,n,s){var r,o,a,l,c,d,h,u,p,f,m,g=pt._data(t);if(g){for(i.handler&&(i=(l=i).handler,s=l.selector),i.guid||(i.guid=pt.guid++),(o=g.events)||(o=g.events={}),(d=g.handle)||((d=g.handle=function(t){return void 0===pt||t&&pt.event.triggered===t.type?undefined:pt.event.dispatch.apply(d.elem,arguments)}).elem=t),a=(e=(e||"").match(At)||[""]).length;a--;)p=m=(r=ee.exec(e[a])||[])[1],f=(r[2]||"").split(".").sort(),p&&(c=pt.event.special[p]||{},p=(s?c.delegateType:c.bindType)||p,c=pt.event.special[p]||{},h=pt.extend({type:p,origType:m,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&pt.expr.match.needsContext.test(s),namespace:f.join(".")},l),(u=o[p])||((u=o[p]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(t,n,f,d)||(t.addEventListener?t.addEventListener(p,d,!1):t.attachEvent&&t.attachEvent("on"+p,d))),c.add&&(c.add.call(t,h),h.handler.guid||(h.handler.guid=i.guid)),s?u.splice(u.delegateCount++,0,h):u.push(h),pt.event.global[p]=!0);t=null}},remove:function(t,e,i,n,s){var r,o,a,l,c,d,h,u,p,f,m,g=pt.hasData(t)&&pt._data(t);if(g&&(d=g.events)){for(c=(e=(e||"").match(At)||[""]).length;c--;)if(p=m=(a=ee.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=pt.event.special[p]||{},u=d[p=(n?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=u.length;r--;)o=u[r],!s&&m!==o.origType||i&&i.guid!==o.guid||a&&!a.test(o.namespace)||n&&n!==o.selector&&("**"!==n||!o.selector)||(u.splice(r,1),o.selector&&u.delegateCount--,h.remove&&h.remove.call(t,o));l&&!u.length&&(h.teardown&&!1!==h.teardown.call(t,f,g.handle)||pt.removeEvent(t,p,g.handle),delete d[p])}else for(p in d)pt.event.remove(t,p+e[c],i,n,!0);pt.isEmptyObject(d)&&(delete g.handle,pt._removeData(t,"events"))}},trigger:function(t,e,i,n){var s,r,o,a,l,c,d,h=[i||nt],u=dt.call(t,"type")?t.type:t,p=dt.call(t,"namespace")?t.namespace.split("."):[];if(o=c=i=i||nt,3!==i.nodeType&&8!==i.nodeType&&!te.test(u+pt.event.triggered)&&(-1<u.indexOf(".")&&(u=(p=u.split(".")).shift(),p.sort()),r=u.indexOf(":")<0&&"on"+u,(t=t[pt.expando]?t:new pt.Event(u,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=p.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=i),e=null==e?[t]:pt.makeArray(e,[t]),l=pt.event.special[u]||{},n||!l.trigger||!1!==l.trigger.apply(i,e))){if(!n&&!l.noBubble&&!pt.isWindow(i)){for(a=l.delegateType||u,te.test(a+u)||(o=o.parentNode);o;o=o.parentNode)h.push(o),c=o;c===(i.ownerDocument||nt)&&h.push(c.defaultView||c.parentWindow||$)}for(d=0;(o=h[d++])&&!t.isPropagationStopped();)t.type=1<d?a:l.bindType||u,(s=(pt._data(o,"events")||{})[t.type]&&pt._data(o,"handle"))&&s.apply(o,e),(s=r&&o[r])&&s.apply&&Dt(o)&&(t.result=s.apply(o,e),!1===t.result&&t.preventDefault());if(t.type=u,!n&&!t.isDefaultPrevented()&&(!l._default||!1===l._default.apply(h.pop(),e))&&Dt(i)&&r&&i[u]&&!pt.isWindow(i)){(c=i[r])&&(i[r]=null),pt.event.triggered=u;try{i[u]()}catch(f){}pt.event.triggered=undefined,c&&(i[r]=c)}return t.result}},dispatch:function(t){t=pt.event.fix(t);var e,i,n,s,r,o=[],a=st.call(arguments),l=(pt._data(this,"events")||{})[t.type]||[],c=pt.event.special[t.type]||{};if((a[0]=t).delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(o=pt.event.handlers.call(this,t,l),e=0;(s=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(r.namespace)||(t.handleObj=r,t.data=r.data,(n=((pt.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,a))!==undefined&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,s,r,o=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==t.type)){for(n=[],i=0;i<a;i++)n[s=(r=e[i]).selector+" "]===undefined&&(n[s]=r.needsContext?-1<pt(s,this).index(l):pt.find(s,this,null,[l]).length),n[s]&&n.push(r);n.length&&o.push({elem:l,handlers:n})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},fix:function(t){if(t[pt.expando])return t;var e,i,n,s=t.type,r=t,o=this.fixHooks[s];for(o||(this.fixHooks[s]=o=Zt.test(s)?this.mouseHooks:Jt.test(s)?this.keyHooks:{}),n=o.props?this.props.concat(o.props):this.props,t=new pt.Event(r),e=n.length;e--;)t[i=n[e]]=r[i];return t.target||(t.target=r.srcElement||nt),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,o.filter?o.filter(t,r):t},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,s,r=e.button,o=e.fromElement;return null==t.pageX&&null!=e.clientX&&(s=(n=t.target.ownerDocument||nt).documentElement,i=n.body,t.pageX=e.clientX+(s&&s.scrollLeft||i&&i.scrollLeft||0)-(s&&s.clientLeft||i&&i.clientLeft||0),t.pageY=e.clientY+(s&&s.scrollTop||i&&i.scrollTop||0)-(s&&s.clientTop||i&&i.clientTop||0)),!t.relatedTarget&&o&&(t.relatedTarget=o===t.target?e.toElement:o),t.which||r===undefined||(t.which=1&r?1:2&r?3:4&r?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){if(this===f()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(pt.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(t){return pt.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==undefined&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i){var n=pt.extend(new pt.Event,i,{type:t,isSimulated:!0});pt.event.trigger(n,null,e),n.isDefaultPrevented()&&i.preventDefault()}},pt.removeEvent=nt.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)}:function(t,e,i){var n="on"+e;t.detachEvent&&("undefined"==typeof t[n]&&(t[n]=null),t.detachEvent(n,i))},pt.Event=function(t,e){if(!(this instanceof pt.Event))return new pt.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===undefined&&!1===t.returnValue?u:p):this.type=t,e&&pt.extend(this,e),this.timeStamp=t&&t.timeStamp||pt.now(),this[pt.expando]=!0},pt.Event.prototype={constructor:pt.Event,isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=u,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=u,t&&!this.isSimulated&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=u,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},pt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,r){pt.event.special[t]={delegateType:r,bindType:r,handle:function(t){var e,i=this,n=t.relatedTarget,s=t.handleObj;return n&&(n===i||pt.contains(i,n))||(t.type=s.origType,e=s.handler.apply(this,arguments),t.type=r),e}}}),ht.submit||(pt.event.special.submit={setup:function(){if(pt.nodeName(this,"form"))return!1;pt.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,i=pt.nodeName(e,"input")||pt.nodeName(e,"button")?pt.prop(e,"form"):undefined;i&&!pt._data(i,"submit")&&(pt.event.add(i,"submit._submit",function(t){t._submitBubble=!0}),pt._data(i,"submit",!0))})},postDispatch:function(t){t._submitBubble&&(delete t._submitBubble,this.parentNode&&!t.isTrigger&&pt.event.simulate("submit",this.parentNode,t))},teardown:function(){if(pt.nodeName(this,"form"))return!1;pt.event.remove(this,"._submit")}}),ht.change||(pt.event.special.change={setup:function(){if(Qt.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(pt.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._justChanged=!0)}),pt.event.add(this,"click._change",function(t){this._justChanged&&!t.isTrigger&&(this._justChanged=!1),pt.event.simulate("change",this,t)})),!1;pt.event.add(this,"beforeactivate._change",function(t){var e=t.target;Qt.test(e.nodeName)&&!pt._data(e,"change")&&(pt.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||pt.event.simulate("change",this.parentNode,t)}),pt._data(e,"change",!0))})},handle:function(t){var e=t.target;if(this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type)return t.handleObj.handler.apply(this,arguments)},teardown:function(){return pt.event.remove(this,"._change"),!Qt.test(this.nodeName)}}),ht.focusin||pt.each({focus:"focusin",blur:"focusout"},function(i,n){var s=function(t){pt.event.simulate(n,t.target,pt.event.fix(t))};pt.event.special[n]={setup:function(){var t=this.ownerDocument||this,e=pt._data(t,n);e||t.addEventListener(i,s,!0),pt._data(t,n,(e||0)+1)},teardown:function(){var t=this.ownerDocument||this,e=pt._data(t,n)-1;e?pt._data(t,n,e):(t.removeEventListener(i,s,!0),pt._removeData(t,n))}}}),pt.fn.extend({on:function(t,e,i,n){return _(this,t,e,i,n)},one:function(t,e,i,n){return _(this,t,e,i,n,1)},off:function(t,e,i){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,pt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(i=e,e=undefined),!1===i&&(i=p),this.each(function(){pt.event.remove(this,t,i,e)});for(s in t)this.off(s,e,t[s]);return this},trigger:function(t,e){return this.each(function(){pt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return pt.event.trigger(t,e,i,!0)}});var ie=/ jQuery\d+="(?:null|\d+)"/g,ne=new RegExp("<(?:"+Vt+")[\\s/>]","i"),se=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,re=/<script|<style|<link/i,oe=/checked\s*(?:[^=]|=\s*.checked.)/i,ae=/^true\/(.*)/,le=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ce=g(nt).appendChild(nt.createElement("div"));pt.extend({htmlPrefilter:function(t){return t.replace(se,"<$1></$2>")},clone:function(t,e,i){var n,s,r,o,a,l=pt.contains(t.ownerDocument,t);if(ht.html5Clone||pt.isXMLDoc(t)||!ne.test("<"+t.nodeName+">")?r=t.cloneNode(!0):(ce.innerHTML=t.outerHTML,ce.removeChild(r=ce.firstChild)),!(ht.noCloneEvent&&ht.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||pt.isXMLDoc(t)))for(n=v(r),a=v(t),o=0;null!=(s=a[o]);++o)n[o]&&T(s,n[o]);if(e)if(i)for(a=a||v(t),n=n||v(r),o=0;null!=(s=a[o]);o++)w(s,n[o]);else w(t,r);return 0<(n=v(r,"script")).length&&b(n,!l&&v(t,"script")),n=a=s=null,r},cleanData:function(t,e){for(var i,n,s,r,o=0,a=pt.expando,l=pt.cache,c=ht.attributes,d=pt.event.special;null!=(i=t[o]);o++)if((e||Dt(i))&&(r=(s=i[a])&&l[s])){if(r.events)for(n in r.events)d[n]?pt.event.remove(i,n):pt.removeEvent(i,n,r.handle);l[s]&&(delete l[s],c||"undefined"==typeof i.removeAttribute?i[a]=undefined:i.removeAttribute(a),it.push(s))}}}),pt.fn.extend({domManip:k,detach:function(t){return R(this,t,!0)},remove:function(t){return R(this,t)},text:function(t){return zt(this,function(t){return t===undefined?pt.text(this):this.empty().append((this[0]&&this[0].ownerDocument||nt).createTextNode(t))},null,t,arguments.length)},append:function(){return k(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||x(this,t).appendChild(t)})},prepend:function(){return k(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=x(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return k(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return k(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&pt.cleanData(v(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&pt.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return pt.clone(this,t,e)})},html:function(t){return zt(this,function(t){var e=this[0]||{},i=0,n=this.length;if(t===undefined)return 1===e.nodeType?e.innerHTML.replace(ie,""):undefined;if("string"==typeof t&&!re.test(t)&&(ht.htmlSerialize||!ne.test(t))&&(ht.leadingWhitespace||!Kt.test(t))&&!Xt[(qt.exec(t)||["",""])[1].toLowerCase()]){t=pt.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(pt.cleanData(v(e,!1)),e.innerHTML=t);e=0}catch(s){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var i=[];return k(this,arguments,function(t){var e=this.parentNode;pt.inArray(this,i)<0&&(pt.cleanData(v(this)),e&&e.replaceChild(t,this))},i)}}),pt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,o){pt.fn[t]=function(t){for(var e,i=0,n=[],s=pt(t),r=s.length-1;i<=r;i++)e=i===r?this:this.clone(!0),pt(s[i])[o](e),ot.apply(n,e.get());return this.pushStack(n)}});var de,he={HTML:"block",BODY:"block"},ue=/^margin/,pe=new RegExp("^("+jt+")(?!px)[a-z%]+$","i"),fe=function(t,e,i,n){var s,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];for(r in s=i.apply(t,n||[]),e)t.style[r]=o[r];return s},me=nt.documentElement;!function(){function t(){var t,e,i=nt.documentElement;i.appendChild(c),d.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",n=r=l=!1,s=a=!0,$.getComputedStyle&&(e=$.getComputedStyle(d),n="1%"!==(e||{}).top,l="2px"===(e||{}).marginLeft,r="4px"===(e||{width:"4px"}).width,d.style.marginRight="50%",s="4px"===(e||{marginRight:"4px"}).marginRight,(t=d.appendChild(nt.createElement("div"))).style.cssText=d.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",d.style.width="1px",a=!parseFloat(($.getComputedStyle(t)||{}).marginRight),d.removeChild(t)),d.style.display="none",(o=0===d.getClientRects().length)&&(d.style.display="",d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",d.childNodes[0].style.borderCollapse="separate",(
t=d.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",(o=0===t[0].offsetHeight)&&(t[0].style.display="",t[1].style.display="none",o=0===t[0].offsetHeight)),i.removeChild(c)}var n,s,r,o,a,l,c=nt.createElement("div"),d=nt.createElement("div");d.style&&(d.style.cssText="float:left;opacity:.5",ht.opacity="0.5"===d.style.opacity,ht.cssFloat=!!d.style.cssFloat,d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",ht.clearCloneStyle="content-box"===d.style.backgroundClip,(c=nt.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",d.innerHTML="",c.appendChild(d),ht.boxSizing=""===d.style.boxSizing||""===d.style.MozBoxSizing||""===d.style.WebkitBoxSizing,pt.extend(ht,{reliableHiddenOffsets:function(){return null==n&&t(),o},boxSizingReliable:function(){return null==n&&t(),r},pixelMarginRight:function(){return null==n&&t(),s},pixelPosition:function(){return null==n&&t(),n},reliableMarginRight:function(){return null==n&&t(),a},reliableMarginLeft:function(){return null==n&&t(),l}}))}();var ge,ve,be=/^(top|right|bottom|left)$/;$.getComputedStyle?(ge=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=$),e.getComputedStyle(t)},ve=function(t,e,i){var n,s,r,o,a=t.style;return""!==(o=(i=i||ge(t))?i.getPropertyValue(e)||i[e]:undefined)&&o!==undefined||pt.contains(t.ownerDocument,t)||(o=pt.style(t,e)),i&&!ht.pixelMarginRight()&&pe.test(o)&&ue.test(e)&&(n=a.width,s=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=s,a.maxWidth=r),o===undefined?o:o+""}):me.currentStyle&&(ge=function(t){return t.currentStyle},ve=function(t,e,i){var n,s,r,o,a=t.style;return null==(o=(i=i||ge(t))?i[e]:undefined)&&a&&a[e]&&(o=a[e]),pe.test(o)&&!be.test(e)&&(n=a.left,(r=(s=t.runtimeStyle)&&s.left)&&(s.left=t.currentStyle.left),a.left="fontSize"===e?"1em":o,o=a.pixelLeft+"px",a.left=n,r&&(s.left=r)),o===undefined?o:o+""||"auto"});var ye=/alpha\([^)]*\)/i,_e=/opacity\s*=\s*([^)]*)/i,xe=/^(none|table(?!-c[ea]).+)/,Ce=new RegExp("^("+jt+")(.*)$","i"),$e={position:"absolute",visibility:"hidden",display:"block"},Ee={letterSpacing:"0",fontWeight:"400"},we=["Webkit","O","Moz","ms"],Te=nt.createElement("div").style;pt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=ve(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ht.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,r,o,a=pt.camelCase(e),l=t.style;if(e=pt.cssProps[a]||(pt.cssProps[a]=D(a)||a),o=pt.cssHooks[e]||pt.cssHooks[a],i===undefined)return o&&"get"in o&&(s=o.get(t,!1,n))!==undefined?s:l[e];if("string"===(r=typeof i)&&(s=Ot.exec(i))&&s[1]&&(i=h(t,e,s),r="number"),null!=i&&i==i&&("number"===r&&(i+=s&&s[3]||(pt.cssNumber[a]?"":"px")),ht.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),!(o&&"set"in o&&(i=o.set(t,i,n))===undefined)))try{l[e]=i}catch(c){}}},css:function(t,e,i,n){var s,r,o,a=pt.camelCase(e);return e=pt.cssProps[a]||(pt.cssProps[a]=D(a)||a),(o=pt.cssHooks[e]||pt.cssHooks[a])&&"get"in o&&(r=o.get(t,!0,i)),r===undefined&&(r=ve(t,e,n)),"normal"===r&&e in Ee&&(r=Ee[e]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),pt.each(["height","width"],function(t,s){pt.cssHooks[s]={get:function(t,e,i){if(e)return xe.test(pt.css(t,"display"))&&0===t.offsetWidth?fe(t,$e,function(){return B(t,s,i)}):B(t,s,i)},set:function(t,e,i){var n=i&&ge(t);return F(t,e,i?I(t,s,i,ht.boxSizing&&"border-box"===pt.css(t,"boxSizing",!1,n),n):0)}}}),ht.opacity||(pt.cssHooks.opacity={get:function(t,e){return _e.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var i=t.style,n=t.currentStyle,s=pt.isNumeric(e)?"alpha(opacity="+100*e+")":"",r=n&&n.filter||i.filter||"";((i.zoom=1)<=e||""===e)&&""===pt.trim(r.replace(ye,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===e||n&&!n.filter)||(i.filter=ye.test(r)?r.replace(ye,s):r+" "+s)}}),pt.cssHooks.marginRight=N(ht.reliableMarginRight,function(t,e){if(e)return fe(t,{display:"inline-block"},ve,[t,"marginRight"])}),pt.cssHooks.marginLeft=N(ht.reliableMarginLeft,function(t,e){if(e)return(parseFloat(ve(t,"marginLeft"))||(pt.contains(t.ownerDocument,t)?t.getBoundingClientRect().left-fe(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}):0))+"px"}),pt.each({margin:"",padding:"",border:"Width"},function(s,r){pt.cssHooks[s+r]={expand:function(t){for(var e=0,i={},n="string"==typeof t?t.split(" "):[t];e<4;e++)i[s+Pt[e]+r]=n[e]||n[e-2]||n[0];return i}},ue.test(s)||(pt.cssHooks[s+r].set=F)}),pt.fn.extend({css:function(t,e){return zt(this,function(t,e,i){var n,s,r={},o=0;if(pt.isArray(e)){for(n=ge(t),s=e.length;o<s;o++)r[e[o]]=pt.css(t,e[o],!1,n);return r}return i!==undefined?pt.style(t,e,i):pt.css(t,e)},t,e,1<arguments.length)},show:function(){return L(this,!0)},hide:function(){return L(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Mt(this)?pt(this).show():pt(this).hide()})}}),(pt.Tween=H).prototype={constructor:H,init:function(t,e,i,n,s,r){this.elem=t,this.prop=i,this.easing=s||pt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=r||(pt.cssNumber[i]?"":"px")},cur:function(){var t=H.propHooks[this.prop];return t&&t.get?t.get(this):H.propHooks._default.get(this)},run:function(t){var e,i=H.propHooks[this.prop];return this.options.duration?this.pos=e=pt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=pt.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){pt.fx.step[t.prop]?pt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[pt.cssProps[t.prop]]&&!pt.cssHooks[t.prop]?t.elem[t.prop]=t.now:pt.style(t.elem,t.prop,t.now+t.unit)}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},pt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},pt.fx=H.prototype.init,pt.fx.step={};var ke,Re,Se,Ae,Ne,De,Le,Fe=/^(?:toggle|show|hide)$/,Ie=/queueHooks$/;pt.Animation=pt.extend(W,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return h(i.elem,t,Ot.exec(e),i),i}]},tweener:function(t,e){pt.isFunction(t)?(e=t,t=["*"]):t=t.match(At);for(var i,n=0,s=t.length;n<s;n++)i=t[n],W.tweeners[i]=W.tweeners[i]||[],W.tweeners[i].unshift(e)},prefilters:[M],prefilter:function(t,e){e?W.prefilters.unshift(t):W.prefilters.push(t)}}),pt.speed=function(t,e,i){var n=t&&"object"==typeof t?pt.extend({},t):{complete:i||!i&&e||pt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!pt.isFunction(e)&&e};return n.duration=pt.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in pt.fx.speeds?pt.fx.speeds[n.duration]:pt.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){pt.isFunction(n.old)&&n.old.call(this),n.queue&&pt.dequeue(this,n.queue)},n},pt.fn.extend({fadeTo:function(t,e,i,n){return this.filter(Mt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(e,t,i,n){var s=pt.isEmptyObject(e),r=pt.speed(t,i,n),o=function(){var t=W(this,pt.extend({},e),r);(s||pt._data(this,"finish"))&&t.stop(!0)};return o.finish=o,s||!1===r.queue?this.each(o):this.queue(r.queue,o)},stop:function(s,t,r){var o=function(t){var e=t.stop;delete t.stop,e(r)};return"string"!=typeof s&&(r=t,t=s,s=undefined),t&&!1!==s&&this.queue(s||"fx",[]),this.each(function(){var t=!0,e=null!=s&&s+"queueHooks",i=pt.timers,n=pt._data(this);if(e)n[e]&&n[e].stop&&o(n[e]);else for(e in n)n[e]&&n[e].stop&&Ie.test(e)&&o(n[e]);for(e=i.length;e--;)i[e].elem!==this||null!=s&&i[e].queue!==s||(i[e].anim.stop(r),t=!1,i.splice(e,1));!t&&r||pt.dequeue(this,s)})},finish:function(o){return!1!==o&&(o=o||"fx"),this.each(function(){var t,e=pt._data(this),i=e[o+"queue"],n=e[o+"queueHooks"],s=pt.timers,r=i?i.length:0;for(e.finish=!0,pt.queue(this,o,[]),n&&n.stop&&n.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===o&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<r;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete e.finish})}}),pt.each(["toggle","show","hide"],function(t,n){var s=pt.fn[n];pt.fn[n]=function(t,e,i){return null==t||"boolean"==typeof t?s.apply(this,arguments):this.animate(O(n,!0),t,e,i)}}),pt.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,n){pt.fn[t]=function(t,e,i){return this.animate(n,t,e,i)}}),pt.timers=[],pt.fx.tick=function(){var t,e=pt.timers,i=0;for(ke=pt.now();i<e.length;i++)(t=e[i])()||e[i]!==t||e.splice(i--,1);e.length||pt.fx.stop(),ke=undefined},pt.fx.timer=function(t){pt.timers.push(t),t()?pt.fx.start():pt.timers.pop()},pt.fx.interval=13,pt.fx.start=function(){Re||(Re=$.setInterval(pt.fx.tick,pt.fx.interval))},pt.fx.stop=function(){$.clearInterval(Re),Re=null},pt.fx.speeds={slow:600,fast:200,_default:400},pt.fn.delay=function(n,t){return n=pt.fx&&pt.fx.speeds[n]||n,t=t||"fx",this.queue(t,function(t,e){var i=$.setTimeout(t,n);e.stop=function(){$.clearTimeout(i)}})},Ae=nt.createElement("input"),Ne=nt.createElement("div"),De=nt.createElement("select"),Le=De.appendChild(nt.createElement("option")),(Ne=nt.createElement("div")).setAttribute("className","t"),Ne.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",Se=Ne.getElementsByTagName("a")[0],Ae.setAttribute("type","checkbox"),Ne.appendChild(Ae),(Se=Ne.getElementsByTagName("a")[0]).style.cssText="top:1px",ht.getSetAttribute="t"!==Ne.className,ht.style=/top/.test(Se.getAttribute("style")),ht.hrefNormalized="/a"===Se.getAttribute("href"),ht.checkOn=!!Ae.value,ht.optSelected=Le.selected,ht.enctype=!!nt.createElement("form").enctype,De.disabled=!0,ht.optDisabled=!Le.disabled,(Ae=nt.createElement("input")).setAttribute("value",""),ht.input=""===Ae.getAttribute("value"),Ae.value="t",Ae.setAttribute("type","radio"),ht.radioValue="t"===Ae.value;var Be=/\r/g,He=/[\x20\t\r\n\f]+/g;pt.fn.extend({val:function(i){var n,t,s,e=this[0];return arguments.length?(s=pt.isFunction(i),this.each(function(t){var e;1===this.nodeType&&(null==(e=s?i.call(this,t,pt(this).val()):i)?e="":"number"==typeof e?e+="":pt.isArray(e)&&(e=pt.map(e,function(t){return null==t?"":t+""})),(n=pt.valHooks[this.type]||pt.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&n.set(this,e,"value")!==undefined||(this.value=e))})):e?(n=pt.valHooks[e.type]||pt.valHooks[e.nodeName.toLowerCase()])&&"get"in n&&(t=n.get(e,"value"))!==undefined?t:"string"==typeof(t=e.value)?t.replace(Be,""):null==t?"":t:void 0}}),pt.extend({valHooks:{option:{get:function(t){var e=pt.find.attr(t,"value");return null!=e?e:pt.trim(pt.text(t)).replace(He," ")}},select:{get:function(t){for(var e,i,n=t.options,s=t.selectedIndex,r="select-one"===t.type||s<0,o=r?null:[],a=r?s+1:n.length,l=s<0?a:r?s:0;l<a;l++)if(((i=n[l]).selected||l===s)&&(ht.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!pt.nodeName(i.parentNode,"optgroup"))){if(e=pt(i).val(),r)return e;o.push(e)}return o},set:function(t,e){for(var i,n,s=t.options,r=pt.makeArray(e),o=s.length;o--;)if(n=s[o],-1<pt.inArray(pt.valHooks.option.get(n),r))try{n.selected=i=!0}catch(a){n.scrollHeight}else n.selected=!1;return i||(t.selectedIndex=-1),s}}}}),pt.each(["radio","checkbox"],function(){pt.valHooks[this]={set:function(t,e){if(pt.isArray(e))return t.checked=-1<pt.inArray(pt(t).val(),e)}},ht.checkOn||(pt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var je,Oe,Pe=pt.expr.attrHandle,Me=/^(?:checked|selected)$/i,ze=ht.getSetAttribute,We=ht.input;pt.fn.extend({attr:function(t,e){return zt(this,pt.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){pt.removeAttr(this,t)})}}),pt.extend({attr:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return"undefined"==typeof t.getAttribute?pt.prop(t,e,i):(1===r&&pt.isXMLDoc(t)||(e=e.toLowerCase(),s=pt.attrHooks[e]||(pt.expr.match.bool.test(e)?Oe:je)),i!==undefined?null===i?void pt.removeAttr(t,e):s&&"set"in s&&(n=s.set(t,i,e))!==undefined?n:(t.setAttribute(e,i+""),i):s&&"get"in s&&null!==(n=s.get(t,e))?n:null==(n=pt.find.attr(t,e))?undefined:n)},attrHooks:{type:{set:function(t,e){if(!ht.radioValue&&"radio"===e&&pt.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,s=0,r=e&&e.match(At);if(r&&1===t.nodeType)for(;i=r[s++];)n=pt.propFix[i]||i,pt.expr.match.bool.test(i)?We&&ze||!Me.test(i)?t[n]=!1:t[pt.camelCase("default-"+i)]=t[n]=!1:pt.attr(t,i,""),t.removeAttribute(ze?i:n)}}),Oe={set:function(t,e,i){return!1===e?pt.removeAttr(t,i):We&&ze||!Me.test(i)?t.setAttribute(!ze&&pt.propFix[i]||i,i):t[pt.camelCase("default-"+i)]=t[i]=!0,i}},pt.each(pt.expr.match.bool.source.match(/\w+/g),function(t,e){var r=Pe[e]||pt.find.attr;We&&ze||!Me.test(e)?Pe[e]=function(t,e,i){var n,s;return i||(s=Pe[e],Pe[e]=n,n=null!=r(t,e,i)?e.toLowerCase():null,Pe[e]=s),n}:Pe[e]=function(t,e,i){if(!i)return t[pt.camelCase("default-"+e)]?e.toLowerCase():null}}),We&&ze||(pt.attrHooks.value={set:function(t,e,i){if(!pt.nodeName(t,"input"))return je&&je.set(t,e,i);t.defaultValue=e}}),ze||(je={set:function(t,e,i){var n=t.getAttributeNode(i);if(n||t.setAttributeNode(n=t.ownerDocument.createAttribute(i)),n.value=e+="","value"===i||e===t.getAttribute(i))return e}},Pe.id=Pe.name=Pe.coords=function(t,e,i){var n;if(!i)return(n=t.getAttributeNode(e))&&""!==n.value?n.value:null},pt.valHooks.button={get:function(t,e){var i=t.getAttributeNode(e);if(i&&i.specified)return i.value},set:je.set},pt.attrHooks.contenteditable={set:function(t,e,i){je.set(t,""!==e&&e,i)}},pt.each(["width","height"],function(t,i){pt.attrHooks[i]={set:function(t,e){if(""===e)return t.setAttribute(i,"auto"),e}}})),ht.style||(pt.attrHooks.style={get:function(t){return t.style.cssText||undefined},set:function(t,e){return t.style.cssText=e+""}});var qe=/^(?:input|select|textarea|button|object)$/i,Ue=/^(?:a|area)$/i;pt.fn.extend({prop:function(t,e){return zt(this,pt.prop,t,e,1<arguments.length)},removeProp:function(e){return e=pt.propFix[e]||e,this.each(function(){try{this[e]=undefined,delete this[e]}catch(t){}})}}),pt.extend({prop:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&pt.isXMLDoc(t)||(e=pt.propFix[e]||e,s=pt.propHooks[e]),i!==undefined?s&&"set"in s&&(n=s.set(t,i,e))!==undefined?n:t[e]=i:s&&"get"in s&&null!==(n=s.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=pt.find.attr(t,"tabindex");return e?parseInt(e,10):qe.test(t.nodeName)||Ue.test(t.nodeName)&&t.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),ht.hrefNormalized||pt.each(["href","src"],function(t,e){pt.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),ht.optSelected||(pt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),pt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){pt.propFix[this.toLowerCase()]=this}),ht.enctype||(pt.propFix.enctype="encoding");var Ke=/[\t\r\n\f]/g;pt.fn.extend({addClass:function(e){var t,i,n,s,r,o,a,l=0;if(pt.isFunction(e))return this.each(function(t){pt(this).addClass(e.call(this,t,q(this)))});if("string"==typeof e&&e)for(t=e.match(At)||[];i=this[l++];)if(s=q(i),n=1===i.nodeType&&(" "+s+" ").replace(Ke," ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");s!==(a=pt.trim(n))&&pt.attr(i,"class",a)}return this},removeClass:function(e){var t,i,n,s,r,o,a,l=0;if(pt.isFunction(e))return this.each(function(t){pt(this).removeClass(e.call(this,t,q(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(At)||[];i=this[l++];)if(s=q(i),n=1===i.nodeType&&(" "+s+" ").replace(Ke," ")){for(o=0;r=t[o++];)for(;-1<n.indexOf(" "+r+" ");)n=n.replace(" "+r+" "," ");s!==(a=pt.trim(n))&&pt.attr(i,"class",a)}return this},toggleClass:function(s,e){var r=typeof s;return"boolean"==typeof e&&"string"===r?e?this.addClass(s):this.removeClass(s):pt.isFunction(s)?this.each(function(t){pt(this).toggleClass(s.call(this,t,q(this),e),e)}):this.each(function(){var t,e,i,n;if("string"===r)for(e=0,i=pt(this),n=s.match(At)||[];t=n[e++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else s!==undefined&&"boolean"!==r||((t=q(this))&&pt._data(this,"__className__",t),pt.attr(this,"class",t||!1===s?"":pt._data(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&-1<(" "+q(i)+" ").replace(Ke," ").indexOf(e))return!0;return!1}}),pt.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,i){pt.fn[i]=function(t,e){return 0<arguments.length?this.on(i,null,t,e):this.trigger(i)}}),pt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}});var Ve=$.location,Xe=pt.now(),Ge=/\?/,Ye=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;pt.parseJSON=function(t){if($.JSON&&$.JSON.parse)return $.JSON.parse(t+"");var s,r=null,e=pt.trim(t+"");return e&&!pt.trim(e.replace(Ye,function(t,e,i,n){return s&&e&&(r=0),0===r?t:(s=i||e,r+=!n-!i,"")}))?Function("return "+e)():pt.error("Invalid JSON: "+t)},pt.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{$.DOMParser?e=(new $.DOMParser).parseFromString(t,"text/xml"):((e=new $.ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(i){e=undefined}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||pt.error("Invalid XML: "+t),e};var Qe=/#.*$/,Je=/([?&])_=[^&]*/,Ze=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,ti=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ei=/^(?:GET|HEAD)$/,ii=/^\/\//,ni=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,si={},ri={},oi="*/".concat("*"),ai=Ve.href,li=ni.exec(ai.toLowerCase())||[];pt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ai,type:"GET",isLocal:ti.test(li[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":oi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":pt.parseJSON,"text xml":pt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?V(V(t,pt.ajaxSettings),e):V(pt.ajaxSettings,t)},ajaxPrefilter:U(si),ajaxTransport:U(ri),ajax:function(t,e){function i(t,e,i,n){var s,r,o,a,l,c=e;2!==x&&(x=2,u&&$.clearTimeout(u),f=undefined,h=n||"",C.readyState=0<t?4:0,s=200<=t&&t<300||304===t,i&&(a=X(m,C,i)),a=G(m,a,C,s),s?(m.ifModified&&((l=C.getResponseHeader("Last-Modified"))&&(pt.lastModified[d]=l),(l=C.getResponseHeader("etag"))&&(pt.etag[d]=l)),204===t||"HEAD"===m.type?c="nocontent":304===t?c="notmodified":(c=a.state,r=a.data,s=!(o=a.error))):(o=c,!t&&c||(c="error",t<0&&(t=0))),C.status=t,C.statusText=(e||c)+"",s?b.resolveWith(g,[r,c,C]):b.rejectWith(g,[C,c,o]),C.statusCode(_),_=undefined,p&&v.trigger(s?"ajaxSuccess":"ajaxError",[C,m,s?r:o]),y.fireWith(g,[C,c]),p&&(v.trigger("ajaxComplete",[C,m]),--pt.active||pt.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=undefined),e=e||{};var n,s,d,h,u,p,f,r,m=pt.ajaxSetup({},e),g=m.context||m,v=m.context&&(g.nodeType||g.jquery)?pt(g):pt.event,b=pt.Deferred(),y=pt.Callbacks("once memory"),_=m.statusCode||{},o={},a={},x=0,l="canceled",C={readyState:0,getResponseHeader:function(t){var e;if(2===x){if(!r)for(r={};e=Ze.exec(h);)r[e[1].toLowerCase()]=e[2];e=r[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===x?h:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return x||(t=a[i]=a[i]||t,o[t]=e),this},overrideMimeType:function(t){return x||(m.mimeType=t),this},statusCode:function(t){var e;if(t)if(x<2)for(e in t)_[e]=[_[e],t[e]];else C.always(t[C.status]);return this},abort:function(t){var e=t||l;return f&&f.abort(e),i(0,e),this}};if(b.promise(C).complete=y.add,C.success=C.done,C.error=C.fail,m.url=((t||m.url||ai)+"").replace(Qe,"").replace(ii,li[1]+"//"),m.type=e.method||e.type||m.method||m.type,m.dataTypes=pt.trim(m.dataType||"*").toLowerCase().match(At)||[""],null==m.crossDomain&&(n=ni.exec(m.url.toLowerCase()),m.crossDomain=!(!n||n[1]===li[1]&&n[2]===li[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(li[3]||("http:"===li[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=pt.param(m.data,m.traditional)),K(si,m,e,C),2===x)return C;for(s in(p=pt.event&&m.global)&&0==pt.active++&&pt.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!ei.test(m.type),d=m.url,m.hasContent||(m.data&&(d=m.url+=(Ge.test(d)?"&":"?")+m.data,delete m.data),!1===m.cache&&(m.url=Je.test(d)?d.replace(Je,"$1_="+Xe++):d+(Ge.test(d)?"&":"?")+"_="+Xe++)),m.ifModified&&(pt.lastModified[d]&&C.setRequestHeader("If-Modified-Since",pt.lastModified[d]),pt.etag[d]&&C.setRequestHeader("If-None-Match",pt.etag[d])),(m.data&&m.hasContent&&!1!==m.contentType||e.contentType)&&C.setRequestHeader("Content-Type",m.contentType),C.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+oi+"; q=0.01":""):m.accepts["*"]),m.headers)C.setRequestHeader(s,m.headers[s]);if(m.beforeSend&&(!1===m.beforeSend.call(g,C,m)||2===x))return C.abort();for(s in l="abort",{success:1,error:1,complete:1})C[s](m[s]);if(f=K(ri,m,e,C)){if(C.readyState=1,p&&v.trigger("ajaxSend",[C,m]),2===x)return C;m.async&&0<m.timeout&&(u=$.setTimeout(function(){C.abort("timeout")},m.timeout));try{x=1,f.send(o,i)}catch(c){if(!(x<2))throw c;i(-1,c)}}else i(-1,"No Transport");return C},getJSON:function(t,e,i){return pt.get(t,e,i,"json")},getScript:function(t,e){return pt.get(t,undefined,e,"script")}}),pt.each(["get","post"],function(t,s){pt[s]=function(t,e,i,n){return pt.isFunction(e)&&(n=n||i,i=e,e=undefined),pt.ajax(pt.extend({url:t,type:s,dataType:n,data:e,success:i},pt.isPlainObject(t)&&t))}}),pt._evalUrl=function(t){return pt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},pt.fn.extend({wrapAll:function(e){if(pt.isFunction(e))return this.each(function(t){pt(this).wrapAll(e.call(this,t))});if(this[0]){var t=pt(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(i){return pt.isFunction(i)?this.each(function(t){pt(this).wrapInner(i.call(this,t))}):this.each(function(){var t=pt(this),e=t.contents();e.length?e.wrapAll(i):t.append(i)})},wrap:function(e){var i=pt.isFunction(e);return this.each(function(t){pt(this).wrapAll(i?e.call(this,t):e)})},unwrap:function(){return this.parent().each(function(){pt.nodeName(this,"body")||pt(this).replaceWith(this.childNodes)}).end()}}),pt.expr.filters.hidden=function(t){return ht.reliableHiddenOffsets()?t.offsetWidth<=0&&t.offsetHeight<=0&&!t.getClientRects().length:Q(t)},pt.expr.filters.visible=function(t){return!pt.expr.filters.hidden(t)};var ci=/%20/g,di=/\[\]$/,hi=/\r?\n/g,ui=/^(?:submit|button|image|reset|file)$/i,pi=/^(?:input|select|textarea|keygen)/i;pt.param=function(t,e){var i,n=[],s=function(t,e){e=pt.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(e===undefined&&(e=pt.ajaxSettings&&pt.ajaxSettings.traditional),pt.isArray(t)||t.jquery&&!pt.isPlainObject(t))pt.each(t,function(){s(this.name,this.value)});else for(i in t)J(i,t[i],e,s);return n.join("&").replace(ci,"+")},pt.fn.extend({serialize:function(){return pt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=pt.prop(this,"elements");return t?pt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!pt(this).is(":disabled")&&pi.test(this.nodeName)&&!ui.test(t)&&(this.checked||!Wt.test(t))}).map(function(t,e){var i=pt(this).val();return null==i?null:pt.isArray(i)?pt.map(i,function(t){return{name:e.name,value:t.replace(hi,"\r\n")}}):{name:e.name,value:i.replace(hi,"\r\n")}}).get()}}),pt.ajaxSettings.xhr=$.ActiveXObject!==undefined?function(){return this.isLocal?tt():8<nt.documentMode?Z():/^(get|post|head|put|delete|options)$/i.test(this.type)&&Z()||tt()}:Z;var fi=0,mi={},gi=pt.ajaxSettings.xhr();$.attachEvent&&$.attachEvent("onunload",function(){for(var t in mi)mi[t](undefined,!0)}),ht.cors=!!gi&&"withCredentials"in gi,(gi=ht.ajax=!!gi)&&pt.ajaxTransport(function(c){var d;if(!c.crossDomain||ht.cors)return{send:function(t,o){var e,a=c.xhr(),l=++fi;if(a.open(c.type,c.url,c.async,c.username,c.password),c.xhrFields)for(e in c.xhrFields)a[e]=c.xhrFields[e];for(e in c.mimeType&&a.overrideMimeType&&a.overrideMimeType(c.mimeType),c.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)t[e]!==undefined&&a.setRequestHeader(e,t[e]+"");a.send(c.hasContent&&c.data||null),d=function(t,e){var i,n,s;if(d&&(e||4===a.readyState))if(delete mi[l],d=undefined,a.onreadystatechange=pt.noop,e)4!==a.readyState&&a.abort();else{s={},i=a.status,"string"==typeof a.responseText&&(s.text=a.responseText);try{n=a.statusText}catch(r){n=""}i||!c.isLocal||c.crossDomain?1223===i&&(i=204):i=s.text?200:404}s&&o(i,n,s,a.getAllResponseHeaders())},c.async?4===a.readyState?$.setTimeout(d):a.onreadystatechange=mi[l]=d:d()},abort:function(){d&&d(undefined,!0)}}}),pt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return pt.globalEval(t),t}}}),pt.ajaxPrefilter("script",function(t){t.cache===undefined&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),pt.ajaxTransport("script",function(e){if(e.crossDomain){var n,s=nt.head||pt("head")[0]||nt.documentElement;return{send:function(t,i){(n=nt.createElement("script")).async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(t,e){(e||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,e||i(200,"success"))},s.insertBefore(n,s.firstChild)},abort:function(){n&&n.onload(undefined,!0)}}}});var vi=[],bi=/(=)\?(?=&|$)|\?\?/;pt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=vi.pop()||pt.expando+"_"+Xe++;return this[t]=!0,t}}),pt.ajaxPrefilter("json jsonp",function(t,e,i){var n,s,r,o=!1!==t.jsonp&&(bi.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&bi.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=pt.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(bi,"$1"+n):!1!==t.jsonp&&(t.url+=(Ge.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return r||pt.error(n+" was not called"),r[0]},t.dataTypes[0]="json",s=$[n],$[n]=function(){r=arguments},i.always(function(){s===undefined?pt($).removeProp(n):$[n]=s,t[n]&&(t.jsonpCallback=e.jsonpCallback,vi.push(n)),r&&pt.isFunction(s)&&s(r[0]),r=s=undefined}),"script"}),pt.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||nt;var n=Ct.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=m([t],e,s),s&&s.length&&pt(s).remove(),pt.merge([],n.childNodes))};var yi=pt.fn.load;pt.fn.load=function(t,e,i){if("string"!=typeof t&&yi)return yi.apply(this,arguments);var n,s,r,o=this,a=t.indexOf(" ");return-1<a&&(n=pt.trim(t.slice(a,t.length)),t=t.slice(0,a)),pt.isFunction(e)?(i=e,e=undefined):e&&"object"==typeof e&&(s="POST"),0<o.length&&pt.ajax({url:t,type:s||"GET",dataType:"html",data:e}).done(function(t){r=arguments,o.html(n?pt("<div>").append(pt.parseHTML(t)).find(n):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,r||[t.responseText,e,t])})}),this},pt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){pt.fn[e]=function(t){return this.on(e,t)}}),pt.expr.filters.animated=function(e){return pt.grep(pt.timers,function(t){return e===t.elem}).length},pt.offset={setOffset:function(t,e,i){var n,s,r,o,a,l,c=pt.css(t,"position"),d=pt(t),h={};"static"===c&&(t.style.position="relative"),a=d.offset(),r=pt.css(t,"top"),l=pt.css(t,"left"),("absolute"===c||"fixed"===c)&&-1<pt.inArray("auto",[r,l])?(o=(n=d.position()).top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(l)||0),pt.isFunction(e)&&(e=e.call(t,i,pt.extend({},a))),null!=e.top&&(h.top=e.top-a.top+o),null!=e.left&&(h.left=e.left-a.left+s),"using"in e?e.using.call(t,h):d.css(h)}},pt.fn.extend({offset:function(e){if(arguments.length)return e===undefined?this:this.each(function(t){pt.offset.setOffset(this,e,t)});var t,i,n={top:0,left:0},s=this[0],r=s&&s.ownerDocument;return r?(t=r.documentElement,pt.contains(t,s)?("undefined"!=typeof s.getBoundingClientRect&&(n=s.getBoundingClientRect()),i=et(r),{top:n.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0),left:n.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):n):void 0},position:function(){if(this[0]){var t,e,i={top:0,left:0},n=this[0];return"fixed"===pt.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),pt.nodeName(t[0],"html")||(i=t.offset()),i.top+=pt.css(t[0],"borderTopWidth",!0),i.left+=pt.css(t[0],"borderLeftWidth",!0)),{top:e.top-i.top-pt.css(n,"marginTop",!0),left:e.left-i.left-pt.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&!pt.nodeName(t,"html")&&"static"===pt.css(t,"position");)t=t.offsetParent;return t||me})}}),pt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,s){var r=/Y/.test(s);pt.fn[e]=function(t){return zt(this,function(t,e,i){var n=et(t);if(i===undefined)return n?s in n?n[s]:n.document.documentElement[e]:t[e];n?n.scrollTo(r?pt(n).scrollLeft():i,r?i:pt(n).scrollTop()):t[e]=i},e,t,arguments.length,null)}}),pt.each(["top","left"],function(t,i){pt.cssHooks[i]=N(ht.pixelPosition,function(t,e){if(e)return e=ve(t,i),pe.test(e)?pt(t).position()[i]+"px":e})}),pt.each({Height:"height",Width:"width"},function(r,o){pt.each({padding:"inner"+r,content:o,"":"outer"+r},function(n,t){pt.fn[t]=function(t,e){var i=arguments.length&&(n||"boolean"!=typeof t),s=n||(!0===t||!0===e?"margin":"border");return zt(this,function(t,e,i){var n;return pt.isWindow(t)?t.document.documentElement["client"+r]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+r],n["scroll"+r],t.body["offset"+r],n["offset"+r],n["client"+r])):i===undefined?pt.css(t,e,s):pt.style(t,e,i,s)},o,i?t:undefined,i,null)}})}),pt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),pt.fn.size=function(){return this.length},pt.fn.andSelf=pt.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return pt});var _i=$.jQuery,xi=$.$;return pt.noConflict=function(t){return $.$===pt&&($.$=xi),t&&$.jQuery===pt&&($.jQuery=_i),pt},t||($.jQuery=$.$=pt),pt}),function(d,l){"use strict";var c;d.rails!==l&&d.error("jquery-ujs has already been loaded!");var t=d(document);d.rails=c={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",
inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return d("meta[name=csrf-token]").attr("content")},csrfParam:function(){return d("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=c.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){d('form input[name="'+c.csrfParam()+'"]').val(c.csrfToken())},fire:function(t,e,i){var n=d.Event(e);return t.trigger(n,i),!1!==n.result},confirm:function(t){return confirm(t)},ajax:function(t){return d.ajax(t)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==l&&!1!==t.data("remote")},handleRemote:function(n){var t,e,i,s,r,o;if(c.fire(n,"ajax:before")){if(s=n.data("with-credentials")||null,r=n.data("type")||d.ajaxSettings&&d.ajaxSettings.dataType,n.is("form")){t=n.data("ujs:submit-button-formmethod")||n.attr("method"),e=n.data("ujs:submit-button-formaction")||n.attr("action"),i=d(n[0]).serializeArray();var a=n.data("ujs:submit-button");a&&(i.push(a),n.data("ujs:submit-button",null)),n.data("ujs:submit-button-formmethod",null),n.data("ujs:submit-button-formaction",null)}else n.is(c.inputChangeSelector)?(t=n.data("method"),e=n.data("url"),i=n.serialize(),n.data("params")&&(i=i+"&"+n.data("params"))):n.is(c.buttonClickSelector)?(t=n.data("method")||"get",e=n.data("url"),i=n.serialize(),n.data("params")&&(i=i+"&"+n.data("params"))):(t=n.data("method"),e=c.href(n),i=n.data("params")||null);return o={type:t||"GET",data:i,dataType:r,beforeSend:function(t,e){if(e.dataType===l&&t.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script),!c.fire(n,"ajax:beforeSend",[t,e]))return!1;n.trigger("ajax:send",t)},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:c.isCrossDomain(e)},s&&(o.xhrFields={withCredentials:s}),e&&(o.url=e),c.ajax(o)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var i=document.createElement("a");try{return i.href=t,i.href=i.href,!((!i.protocol||":"===i.protocol)&&!i.host||e.protocol+"//"+e.host==i.protocol+"//"+i.host)}catch(n){return!0}},handleMethod:function(t){var e=c.href(t),i=t.data("method"),n=t.attr("target"),s=c.csrfToken(),r=c.csrfParam(),o=d('<form method="post" action="'+e+'"></form>'),a='<input name="_method" value="'+i+'" type="hidden" />';r===l||s===l||c.isCrossDomain(e)||(a+='<input name="'+r+'" value="'+s+'" type="hidden" />'),n&&o.attr("target",n),o.hide().append(a).appendTo("body"),o.submit()},formElements:function(t,e){return t.is("form")?d(t[0].elements).filter(e):t.find(e)},disableFormElements:function(t){c.formElements(t,c.disableSelector).each(function(){c.disableFormElement(d(this))})},disableFormElement:function(t){var e,i;e=t.is("button")?"html":"val",(i=t.data("disable-with"))!==l&&(t.data("ujs:enable-with",t[e]()),t[e](i)),t.prop("disabled",!0),t.data("ujs:disabled",!0)},enableFormElements:function(t){c.formElements(t,c.enableSelector).each(function(){c.enableFormElement(d(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")!==l&&(t[e](t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.prop("disabled",!1),t.removeData("ujs:disabled")},allowAction:function(t){var e,i=t.data("confirm"),n=!1;if(!i)return!0;if(c.fire(t,"confirm")){try{n=c.confirm(i)}catch(s){(console.error||console.log).call(console,s.stack||s)}e=c.fire(t,"confirm:complete",[n])}return n&&e},blankInputs:function(t,e,i){var n,s,r,o=d(),a=e||"input,textarea",l=t.find(a),c={};return l.each(function(){(n=d(this)).is("input[type=radio]")?(r=n.attr("name"),c[r]||(0===t.find('input[type=radio]:checked[name="'+r+'"]').length&&(s=t.find('input[type=radio][name="'+r+'"]'),o=o.add(s)),c[r]=r)):(n.is("input[type=checkbox],input[type=radio]")?n.is(":checked"):!!n.val())===i&&(o=o.add(n))}),!!o.length&&o},nonBlankInputs:function(t,e){return c.blankInputs(t,e,!0)},stopEverything:function(t){return d(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(t){var e=t.data("disable-with");e!==l&&(t.data("ujs:enable-with",t.html()),t.html(e)),t.bind("click.railsDisable",function(t){return c.stopEverything(t)}),t.data("ujs:disabled",!0)},enableElement:function(t){t.data("ujs:enable-with")!==l&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable"),t.removeData("ujs:disabled")}},c.fire(t,"rails:attachBindings")&&(d.ajaxPrefilter(function(t,e,i){t.crossDomain||c.CSRFProtection(i)}),d(window).on("pageshow.rails",function(){d(d.rails.enableSelector).each(function(){var t=d(this);t.data("ujs:disabled")&&d.rails.enableFormElement(t)}),d(d.rails.linkDisableSelector).each(function(){var t=d(this);t.data("ujs:disabled")&&d.rails.enableElement(t)})}),t.on("ajax:complete",c.linkDisableSelector,function(){c.enableElement(d(this))}),t.on("ajax:complete",c.buttonDisableSelector,function(){c.enableFormElement(d(this))}),t.on("click.rails",c.linkClickSelector,function(t){var e=d(this),i=e.data("method"),n=e.data("params"),s=t.metaKey||t.ctrlKey;if(!c.allowAction(e))return c.stopEverything(t);if(!s&&e.is(c.linkDisableSelector)&&c.disableElement(e),c.isRemote(e)){if(s&&(!i||"GET"===i)&&!n)return!0;var r=c.handleRemote(e);return!1===r?c.enableElement(e):r.fail(function(){c.enableElement(e)}),!1}return i?(c.handleMethod(e),!1):void 0}),t.on("click.rails",c.buttonClickSelector,function(t){var e=d(this);if(!c.allowAction(e)||!c.isRemote(e))return c.stopEverything(t);e.is(c.buttonDisableSelector)&&c.disableFormElement(e);var i=c.handleRemote(e);return!1===i?c.enableFormElement(e):i.fail(function(){c.enableFormElement(e)}),!1}),t.on("change.rails",c.inputChangeSelector,function(t){var e=d(this);return c.allowAction(e)&&c.isRemote(e)?(c.handleRemote(e),!1):c.stopEverything(t)}),t.on("submit.rails",c.formSubmitSelector,function(t){var e,i,n=d(this),s=c.isRemote(n);if(!c.allowAction(n))return c.stopEverything(t);if(n.attr("novalidate")===l)if(n.data("ujs:formnovalidate-button")===l){if((e=c.blankInputs(n,c.requiredInputSelector,!1))&&c.fire(n,"ajax:aborted:required",[e]))return c.stopEverything(t)}else n.data("ujs:formnovalidate-button",l);if(s){if(i=c.nonBlankInputs(n,c.fileInputSelector)){setTimeout(function(){c.disableFormElements(n)},13);var r=c.fire(n,"ajax:aborted:file",[i]);return r||setTimeout(function(){c.enableFormElements(n)},13),r}return c.handleRemote(n),!1}setTimeout(function(){c.disableFormElements(n)},13)}),t.on("click.rails",c.formInputClickSelector,function(t){var e=d(this);if(!c.allowAction(e))return c.stopEverything(t);var i=e.attr("name"),n=i?{name:i,value:e.val()}:null,s=e.closest("form");0===s.length&&(s=d("#"+e.attr("form"))),s.data("ujs:submit-button",n),s.data("ujs:formnovalidate-button",e.attr("formnovalidate")),s.data("ujs:submit-button-formaction",e.attr("formaction")),s.data("ujs:submit-button-formmethod",e.attr("formmethod"))}),t.on("ajax:send.rails",c.formSubmitSelector,function(t){this===t.target&&c.disableFormElements(d(this))}),t.on("ajax:complete.rails",c.formSubmitSelector,function(t){this===t.target&&c.enableFormElements(d(this))}),d(function(){c.refreshCSRFTokens()}))}(jQuery),$(document).on("ready page:load",function(){var t,e=$("meta[name=csrf-token]").attr("content"),i=$("meta[name=csrf-param]").attr("content");i!==undefined&&e!==undefined&&(t=i+"="+encodeURIComponent(e)),$R.options={imageUpload:"/redactor3_rails/images?"+t,imageManagerJson:"/redactor3_rails/images",fileUpload:"/redactor3_rails/files?"+t,fileManagerJson:"/redactor3_rails/files"},$(".redactor").redactor()}),function(){var Ajax={settings:{},post:function(t){return new AjaxRequest("post",t)},get:function(t){return new AjaxRequest("get",t)}},AjaxRequest=function(t,e){var i={method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}};this.p=this.extend(i,e),this.p=this.extend(this.p,Ajax.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),!1!==("function"!=typeof this.p.before||this.p.before(this.xhr))&&this.send()};AjaxRequest.prototype={extend:function(t,e){if(e)for(var i in e)t[i]=e[i];return t},prepareData:function(){"POST"!==this.p.method||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),"object"!=typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data)),"GET"===this.p.method&&(this.p.url=this.p.data?this.p.url+"?"+this.p.data:this.p.url)},setHeaders:function(){for(var t in this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),this.p.headers)this.xhr.setRequestHeader(t,this.p.headers[t])},isFormData:function(){return"undefined"!=typeof window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||300<=this.xhr.status&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){if(this.isComplete()){var t=this.xhr.response,e=this.parseJson(t);t=e||t,"function"==typeof this.p.success&&this.p.success(t,this.xhr)}else"function"==typeof this.p.error&&this.p.error(this.xhr.statusText)},parseJson:function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(i){}return!1},toParams:function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}};var DomCache=[0],DomExpando="data"+(new Date).getTime(),DomHClass="is-hidden",DomHMClass="is-hidden-mobile",Dom=function(t,e){return this.parse(t,e)};Dom.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)},Dom.prototype={get sdom(){return!0},get length(){return this.nodes.length},parse:function(t,e){var i,n=/^\s*<(\w+|!)[^>]*>/;if(t){if(t.sdom)return this.nodes=t.nodes,t;i="string"!=typeof t?t.nodeType&&11===t.nodeType?t.childNodes:t.nodeType||t===window?[t]:t:n.test(t)?this.create(t):this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div"),n=i.childNodes;i.innerHTML=t;for(var s=0,r=n.length;s<r;s++)e.push(n[s]);return e},add:function(t){this.nodes=this.nodes.concat(this._toArray(t))},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new Dom(this.nodes[t])},first:function(){return new Dom(this.nodes[0])},last:function(){return new Dom(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,this.nodes[i].sdom?this.nodes[i].get():this.nodes[i],i);return this},is:function(t){return 0<this.filter(t).length},filter:function(e){var t;return e===undefined?this:(t="function"==typeof e?e:function(t){return e instanceof Node?e===t:e&&e.sdom?-1!==e.nodes.indexOf(t):(t.matches=t.matches||t.msMatchesSelector||t.webkitMatchesSelector,1===t.nodeType&&t.matches(e||"*"))},new Dom(this.nodes.filter(t)))},not:function(e){return this.filter(function(t){return!new Dom(t).is(e||!0)})},find:function(n){var s=[];return this.each(function(t){for(var e=this._query(n||"*",t),i=0;i<e.length;i++)s.push(e[i])}),new Dom(s)},children:function(t){var n=[];return this.each(function(t){if(t.children)for(var e=t.children,i=0;i<e.length;i++)n.push(e[i])}),new Dom(n).filter(t)},parent:function(t){var e=[];return this.each(function(t){t.parentNode&&e.push(t.parentNode)}),new Dom(e).filter(t)},parents:function(i,n){n=this._getContext(n);var s=[];return this.each(function(t){for(var e=t.parentNode;e&&e!==n;)i?new Dom(e).is(i)&&s.push(e):s.push(e),e=e.parentNode}),new Dom(s)},closest:function(e,i){i=this._getContext(i),e=e.sdom?e.get():e;var n=[],s=e&&e.nodeType;return this.each(function(t){do{if(s&&t===e||new Dom(t).is(e))return n.push(t)}while((t=t.parentNode)&&t!==i)}),new Dom(n)},next:function(t){return this._getSibling(t,"nextSibling")},nextElement:function(t){return this._getSibling(t,"nextElementSibling")},prev:function(t){return this._getSibling(t,"previousSibling")},prevElement:function(t){return this._getSibling(t,"previousElementSibling")},css:function(n,s){if(s!==undefined||"object"==typeof n)return this.each(function(t){var e={};for(var i in"object"==typeof n?e=n:e[n]=s,e)t.style&&(t.style[i]=e[i])});var t=this.get();return"width"===n||"height"===n?t.style?this._getHeightOrWidth(n,t,!1)+"px":undefined:t.style?getComputedStyle(t,null)[n]:undefined},attr:function(n,s,r){if(r=r?"data-":"",s!==undefined||"object"==typeof n)return this.each(function(t){var e={};for(var i in"object"==typeof n?e=n:e[n]=s,e)3!==t.nodeType&&("checked"===i?t.checked=e[i]:t.setAttribute(r+i,e[i]))});var t=this.get();return t&&3!==t.nodeType?"checked"===n?t.checked:this._getBooleanFromStr(t.getAttribute(r+n)):void 0},data:function(t,e){if(t!==undefined)return this.attr(t,e,!0);var i=/^data\-(.+)$/,n=this.get().attributes,s={},r=function(t){return t[1].toUpperCase()};for(var o in n)if(n[o]&&i.test(n[o].nodeName)){var a=n[o].nodeName.match(i)[1],l=n[o].value;a=a.replace(/-([a-z])/g,r),l=this._isObjectString(l)?this._toObject(l):this._isNumber(l)?parseFloat(l):this._getBooleanFromStr(l),s[a]=l}return s},val:function(e){if(e!==undefined)return this.each(function(t){t.value=e});var t=this.get();return t.type&&"checkbox"===t.type?t.checked:t.value},removeAttr:function(i){return this.each(function(e){var t=function(t){3!==e.nodeType&&e.removeAttribute(t)};i.split(" ").forEach(t)})},removeData:function(i){return this.each(function(e){var t=function(t){3!==e.nodeType&&e.removeAttribute("data-"+t)};i.split(" ").forEach(t)})},dataset:function(e,i){return this.each(function(t){DomCache[this.dataindex(t)][e]=i})},dataget:function(t){return DomCache[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[DomExpando],i=DomCache.length;return e||(e=t[DomExpando]=i,DomCache[e]={}),e},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(e){return this.nodes.some(function(t){return!!t.classList&&t.classList.contains(e)})},empty:function(){return this.each(function(t){t.innerHTML=""})},html:function(t){return t===undefined?this.get().innerHTML||"":this.empty().append(t)},text:function(e){return e===undefined?this.get().textContent||"":this.each(function(t){t.textContent=e})},after:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("afterend",t);else for(var i=t instanceof Node?[t]:this._toArray(t).reverse(),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e.nextSibling);return e})},before:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("beforebegin",t);else for(var i=t instanceof Node?[t]:this._toArray(t),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e);return e})},append:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("beforeend",t);else for(var i=t instanceof Node?[t]:this._toArray(t),n=0;n<i.length;n++)e.appendChild(i[n]);return e})},prepend:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("afterbegin",t);else for(var i=t instanceof Node?[t]:this._toArray(t).reverse(),n=0;n<i.length;n++)e.insertBefore(i[n],e.firstChild);return e})},wrap:function(t){return this._inject(t,function(t,e){var i="string"==typeof t||"number"==typeof t?this.create(t)[0]:t instanceof Node?t:this._toArray(t)[0];return e.parentNode&&e.parentNode.insertBefore(i,e),i.appendChild(e),new Dom(i)})},unwrap:function(){return this.each(function(t){var e=new Dom(t);return e.replaceWith(e.contents())})},replaceWith:function(t){return this._inject(t,function(t,e){for(var i=document.createDocumentFragment(),n="string"==typeof t||"number"==typeof t?this.create(t):t instanceof Node?[t]:this._toArray(t),s=0;s<n.length;s++)i.appendChild(n[s]);var r=i.childNodes[0];return e.parentNode.replaceChild(i,e),r})},remove:function(){return this.each(function(t){t.parentNode&&t.parentNode.removeChild(t)})},clone:function(i){var n=[];return this.each(function(t){var e=this._clone(t);i&&(e=this._cloneEvents(t,e)),n.push(e)}),new Dom(n)},show:function(){return this.each(function(t){if(t.style&&this._hasDisplayNone(t)){var e,i=t.getAttribute("domTargetShow"),n=!!t.classList&&t.classList.contains(DomHClass),s=!!t.classList&&t.classList.contains(DomHMClass);n?(e=DomHClass,t.classList.remove(DomHClass)):s?(e=DomHMClass,t.classList.remove(DomHMClass)):t.style.display=i||"block",e&&t.setAttribute("domTargetHide",e),t.removeAttribute("domTargetShow")}}.bind(this))},hide:function(){return this.each(function(t){if(t.style&&!this._hasDisplayNone(t)){var e=t.style.display,i=t.getAttribute("domTargetHide");i===DomHClass?t.classList.add(DomHClass):i===DomHMClass?t.classList.add(DomHMClass):("block"!==e&&t.setAttribute("domTargetShow",e),t.style.display="none"),t.removeAttribute("domTargetHide")}})},scrollTop:function(t){var e=this.get(),i=e===window,n=9===e.nodeType,s=n?document.scrollingElement||document.body.parentNode||document.body||document.documentElement:e;if(t===undefined)return n?"undefined"!=typeof window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0:i?window.pageYOffset:s.scrollTop;i?window.scrollTo(0,t):s.scrollTop=t},offset:function(){return this._getDim("Offset")},position:function(){return this._getDim("Position")},width:function(t,e){return this._getSize("width","Width",t,e)},height:function(t,e){return this._getSize("height","Height",t,e)},outerWidth:function(){return this._getInnerOrOuter("width","outer")},outerHeight:function(){return this._getInnerOrOuter("height","outer")},innerWidth:function(){return this._getInnerOrOuter("width","inner")},innerHeight:function(){return this._getInnerOrOuter("height","inner")},click:function(){return this._triggerEvent("click")},focus:function(){return this._triggerEvent("focus")},trigger:function(o){return this.each(function(t){for(var e=o.split(" "),i=0;i<e.length;i++){var n,s={bubbles:!0,cancelable:!0};try{n=new window.CustomEvent(e[i],s)}catch(r){(n=document.createEvent("CustomEvent")).initCustomEvent(e[i],!0,!0)}t.dispatchEvent(n)}})},on:function(r,o,a){return this.each(function(t){for(var e=r.split(" "),i=0;i<e.length;i++){var n=this._getEventName(e[i]),s=this._getEventNamespace(e[i]);o=a?this._getOneHandler(o,r):o,t.addEventListener(n,o),t._e=t._e||{},t._e[s]=t._e[s]||{},t._e[s][n]=t._e[s][n]||[],t._e[s][n].push(o)}})},one:function(t,e){return this.on(t,e,!0)},off:function(r,o){var a=function(t,e,i){return t===i},l=function(t,e,i,n){return e===n},c=function(t,e,i,n){return t===i&&e===n},e=function(){return!0};return r===undefined?this.each(function(t){this._offEvent(t,!1,!1,o,e)}):this.each(function(t){for(var e=r.split(" "),i=0;i<e.length;i++){var n=this._getEventName(e[i]),s=this._getEventNamespace(e[i]);"_events"===s?this._offEvent(t,n,s,o,a):n||"_events"===s?this._offEvent(t,n,s,o,c):this._offEvent(t,n,s,o,l)}})},serialize:function(t){for(var e={},i=this.get().elements,n=0;n<i.length;n++){var s=i[n];if((!/(checkbox|radio)/.test(s.type)||s.checked)&&(s.name&&!s.disabled&&"file"!==s.type)){if("select-multiple"===s.type)for(var r=0;r<s.options.length;r++){var o=s.options[r];o.selected&&(e[s.name]=o.value)}e[s.name]=this._isNumber(s.value)?parseFloat(s.value):this._getBooleanFromStr(s.value)}}return t?e:this._toParams(e)},ajax:function(t,e){if(void 0!==AjaxRequest){var i=this.attr("method")||"post",n={url:this.attr("action"),data:this.serialize(),success:t,error:e};return new AjaxRequest(i,n)}},_queryContext:function(t,e){return 3!==(e=this._getContext(e)).nodeType&&"function"==typeof e.querySelectorAll?e.querySelectorAll(t):[]},_query:function(t,e){if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if("#"!==t[0])return"."===t[0]?document.getElementsByClassName(t.slice(1)):document.getElementsByTagName(t);var i=document.getElementById(t.slice(1));return i?[i]:[]}return document.querySelectorAll(t)},_getContext:function(t){return(t="string"==typeof t?document.querySelector(t):t)&&t.sdom?t.get():t||document},_inject:function(t,e){for(var i=this.nodes.length,n=[];i--;){var s="function"==typeof t?t.call(this,this.nodes[i]):t,r=0===i?s:this._clone(s),o=e.call(this,r,this.nodes[i]);o&&(o.sdom?n.push(o.get()):n.push(o))}return new Dom(n)},_cloneEvents:function(t,e){var i=t._e;if(i)for(var n in(e._e=i)._events)for(var s=0;s<i._events[n].length;s++)e.addEventListener(n,i._events[n][s]);return e},_clone:function(t){if(void 0!==t)return"string"==typeof t?t:t instanceof Node||t.nodeType?t.cloneNode(!0):"length"in t?[].map.call(this._toArray(t),function(t){return t.cloneNode(!0)}):void 0},_slice:function(t){return t&&0!==t.length?t.length?[].slice.call(t.nodes||t):[t]:[]},_eachClass:function(i,n){return this.each(function(e){if(i){var t=function(t){e.classList&&e.classList[n](t)};i.split(" ").forEach(t)}})},_triggerEvent:function(t){var e=this.get();return e&&3!==e.nodeType&&e[t](),this},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,n,s){for(var r in t._e)for(var o in t._e[r])if(s(o,r,e,i))for(var a=t._e[r][o],l=0;l<a.length;l++)void 0!==n&&a[l].toString()!==n.toString()||(t.removeEventListener(o,a[l]),t._e[r][o].splice(l,1),0===t._e[r][o].length&&delete t._e[r][o],0===Object.keys(t._e[r]).length&&delete t._e[r])},_getInnerOrOuter:function(t,e){return this[t](undefined,e)},_getDocSize:function(t,e){var i=t.body,n=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],n["client"+e],n["scroll"+e],n["offset"+e])},_getSize:function(e,t,i,n){if(i!==undefined)return this.each(function(t){i=parseFloat(i),i+=this._adjustResultHeightOrWidth(e,t,n||"normal"),new Dom(t).css(e,i+"px")}.bind(this));var s=this.get();return i=3===s.nodeType?0:9===s.nodeType?this._getDocSize(s,t):s===window?window["inner"+t]:this._getHeightOrWidth(e,s,n||"normal"),Math.round(i)},_getHeightOrWidth:function(t,e,i){if(!e)return 0;var n=t.charAt(0).toUpperCase()+t.slice(1),s=0,r=getComputedStyle(e,null),o=new Dom(e),a=o.parents().filter(function(t){return 1===t.nodeType&&"none"===getComputedStyle(t,null).display&&t});if("none"===r.display&&a.add(e),0!==a.length){var l="visibility: hidden !important; display: block !important;",c=[];a.each(function(t){var e=new Dom(t),i=e.attr("style");null!==i&&c.push(i),e.attr("style",null!==i?i+";"+l:l)}),s=o.get()["offset"+n]-this._adjustResultHeightOrWidth(t,e,i),a.each(function(t,e){var i=new Dom(t);c[e]===undefined?i.removeAttr("style"):i.attr("style",c[e])})}else s=e["offset"+n]-this._adjustResultHeightOrWidth(t,e,i);return s},_adjustResultHeightOrWidth:function(t,e,i){if(!e||!1===i)return 0;var n=0,s=getComputedStyle(e,null),r="border-box"===s.boxSizing;return"height"===t?(("inner"===i||"normal"===i&&r)&&(n+=(parseFloat(s.borderTopWidth)||0)+(parseFloat(s.borderBottomWidth)||0)),"outer"===i&&(n-=(parseFloat(s.marginTop)||0)+(parseFloat(s.marginBottom)||0))):(("inner"===i||"normal"===i&&r)&&(n+=(parseFloat(s.borderLeftWidth)||0)+(parseFloat(s.borderRightWidth)||0)),"outer"===i&&(n-=(parseFloat(s.marginLeft)||0)+(parseFloat(s.marginRight)||0))),n},_getDim:function(t){var e=this.get();return 3===e.nodeType?{top:0,left:0}:this["_get"+t](e)},_getPosition:function(t){return{top:t.offsetTop,left:t.offsetLeft}},_getOffset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.documentElement,s=i.defaultView;return{top:e.top+s.pageYOffset-n.clientTop,left:e.left+s.pageXOffset-n.clientLeft}},_getSibling:function(e,i){var n,s=(e=e&&e.sdom?e.get():e)&&e.nodeType;return this.each(function(t){for(;t=t[i];)if(s&&t===e||new Dom(t).is(e))return void(n=t)}),new Dom(n)},_toArray:function(t){if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return t===undefined?[]:t.sdom?t.nodes:t},_toParams:function(t){var e="";for(var i in t)e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i]);return e.replace(/^&/,"")},_toObject:function(t){return new Function("return "+t)()},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_isNumber:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_isObjectString:function(t){return-1!==t.search(/^{/)},_getBooleanFromStr:function(t){return"true"===t||"false"!==t&&t},_hasDisplayNone:function(t){return"none"===t.style.display||"none"===(t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display)}};var uuid=0,$R=function(t,e){return RedactorApp(t,e,[].slice.call(arguments,2))};$R.app=[],$R.version="3.3.5",$R.options={},$R.modules={},$R.services={},$R.classes={},$R.plugins={},$R.mixins={},$R.modals={},$R.lang={},$R.dom=function(t,e){return new Dom(t,e)},$R.ajax=Ajax,$R.Dom=Dom,$R.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},$R.env={plugin:"plugins",module:"modules",service:"services","class":"classes",mixin:"mixins"},"undefined"!=typeof jQuery&&(jQuery.fn.redactor=function(t){return RedactorApp(this.toArray(),t,[].slice.call(arguments,1))});var RedactorApp=function(t,e,i){for(var n,s="redactor",r=Array.isArray(t)?t:t&&t.nodeType?[t]:document.querySelectorAll(t),o="string"==typeof e||"function"==typeof e,a=[],l=0;l<r.length;l++){var c=r[l],d=$R.dom(c);if((n=d.dataget(s))||o||(n=new App(c,e,uuid),d.dataset(s,n),$R.app[uuid]=n,uuid++),n&&o){var h,u="destroy"===e;"function"==typeof(e=u?"stop":e)?h=e.apply(n,i):(i.unshift(e),h=n.api.apply(n,i)),h!==undefined&&a.push(h),u&&d.dataset(s,!1)}}return 0===a.length||1===a.length?0===a.length?n:a[0]:a};$R.add=function(t,e,i){if("undefined"!=typeof $R.env[t])if(i.translations&&($R.lang=$R.extend(!0,{},$R.lang,i.translations)),i.modals&&($R.modals=$R.extend(!0,{},$R.modals,i.modals)),"mixin"===t)$R[$R.env[t]][e]=i;else{var n=function(){};if((n.prototype=i).mixins)for(var s=0;s<i.mixins.length;s++)$R.inherit(n,$R.mixins[i.mixins[s]]);$R[$R.env[t]][e]=n}},$R.addLang=function(t,e){"undefined"==typeof $R.lang[t]&&($R.lang[t]={}),$R.lang[t]=$R.extend($R.lang[t],e)},$R.create=function(t){var e=t.split("."),i=[].slice.call(arguments,1),n="classes";"undefined"!=typeof $R.env[e[0]]&&(n=$R.env[e[0]],t=e.slice(1).join("."));var s=new $R[n][t];if(s.init){var r=s.init.apply(s,i);return r||s}return s},$R.inherit=function(t,e){var i=function(){};i.prototype=e;var n=new i;for(var s in t.prototype)t.prototype.__lookupGetter__(s)?n.__defineGetter__(s,t.prototype.__lookupGetter__(s)):n[s]=t.prototype[s];return t.prototype=n,t.prototype["super"]=e,t},$R.error=function(t){throw t},$R.extend=function(t){var i={},n=!1,e=0,s=arguments.length;"[object Boolean]"===Object.prototype.toString.call(t)&&(n=t,e++);for(var r=function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n&&"[object Object]"===Object.prototype.toString.call(t[e])?i[e]=$R.extend(!0,i[e],t[e]):i[e]=t[e])};e<s;e++){r(arguments[e])}return i},$R.opts={animation:!0,lang:"en",direction:"ltr",spellcheck:!0,structure:!1,scrollTarget:!1,styles:!0,stylesClass:"redactor-styles",placeholder:!1,source:!0,showSource:!1,inline:!1,breakline:!1,markup:"p",enterKey:!0,clickToEdit:!1,clickToSave:!1,clickToCancel:!1,focus:!1,focusEnd:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:[],callbacks:{},preClass:!1,preSpaces:4,tabindex:!1,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveData:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarContext:!0,air:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,formattingHide:!1,buttons:["html","format","bold","italic","deleted","lists","image","file","link"],buttonsTextLabeled:!1,buttonsAdd:[],buttonsAddFirst:[],buttonsAddAfter:!1,buttonsAddBefore:!1,buttonsHide:[],buttonsHideOnMobile:[],imageUpload:!1,imageUploadParam:"file",imageData:!1,imageEditable:!0,imageCaption:!0,imageLink:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",imageFigure:!0,imageObserve:!0,fileUpload:!1,fileUploadParam:"file",fileData:!1,fileAttachment:!1,uploadData:!1,dragUpload:!0,multipleUpload:!0,clipboardUpload:!0,uploadBase64:!1,linkTarget:!1,linkTitle:!1,linkNewTab:!0,linkNofollow:!1,linkSize:30,linkValidation:!0,cleanOnEnter:!0,cleanInlineOnEnter:!1,paragraphize:!0,removeScript:!0,removeNewLines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},pastePlainText:!1,pasteLinkTarget:!1,pasteImages:!0,pasteLinks:!0,pasteClean:!0,pasteKeepStyle:[],pasteKeepClass:[],pasteKeepAttrs:["td","th"],pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["a","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"],activeButtons:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",u:"underline"},activeButtonsAdd:{},activeButtonsObservers:{},autoparse:!0,autoparseStart:!0,autoparsePaste:!0,autoparseLinks:!0,autoparseImages:!0,autoparseVideo:!0,shortcodes:{"p.":{format:"p"},"quote.":{format:"blockquote"},"pre.":{format:"pre"},"h1.":{format:"h1"},"h2.":{format:"h2"},"h3.":{format:"h3"},"h4.":{format:"h4"},"h5.":{format:"h5"},"h6.":{format:"h6"},"*.":{format:"ul"}},shortcodesAdd:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{api:"module.inline.clearformat"},"ctrl+b, meta+b":{api:"module.inline.format",args:"b"},"ctrl+i, meta+i":{api:"module.inline.format",args:"i"},"ctrl+u, meta+u":{api:"module.inline.format",args:"u"},"ctrl+h, meta+h":{api:"module.inline.format",args:"sup"},"ctrl+l, meta+l":{api:"module.inline.format",args:"sub"},"ctrl+k, meta+k":{api:"module.link.open"},"ctrl+alt+0, meta+alt+0":{api:"module.block.format",args:"p"},"ctrl+alt+1, meta+alt+1":{api:"module.block.format",args:"h1"},"ctrl+alt+2, meta+alt+2":{api:"module.block.format",args:"h2"},"ctrl+alt+3, meta+alt+3":{api:"module.block.format",args:"h3"},"ctrl+alt+4, meta+alt+4":{api:"module.block.format",args:"h4"},"ctrl+alt+5, meta+alt+5":{api:"module.block.format",args:"h5"},"ctrl+alt+6, meta+alt+6":{api:"module.block.format",args:"h6"},"ctrl+shift+7, meta+shift+7":{api:"module.list.toggle",args:"ol"},"ctrl+shift+8, meta+shift+8":{api:"module.list.toggle",args:"ul"}},shortcutsAdd:!1,grammarly:!0,notranslate:!1,bufferLimit:100,emptyHtml:"<p></p>",markerChar:"\ufeff",imageTypes:["image/png","image/jpeg","image/gif"],imageAttrs:["alt","title","src","class","width","height","srcset"],inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],regex:{
youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/(http|https)?:\/\/(?:www.|player.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_-]+)?/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/gi},input:!0,zindex:!1,modes:{inline:{pastePlainText:!0,pasteImages:!1,enterKey:!1,toolbar:!1,autoparse:!1,source:!1,showSource:!1,styles:!1,air:!1},original:{styles:!1}}},$R.lang.en={format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline",superscript:"Superscript",subscript:"Subscript","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U","superscript-abbr":"Sup","subscript-abbr":"Sub",lists:"Lists","link-insert":"Insert Link","link-edit":"Edit Link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save","delete":"Delete",text:"Text",edit:"Edit",title:"Alt",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line",upload:"Upload","upload-label":"Drop files here or click to upload","accessibility-help-label":"Rich text editor",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center",undo:"Undo",redo:"Redo"},$R.buttons={html:{title:"HTML",icon:!0,api:"module.source.toggle"},undo:{title:"## undo ##",icon:!0,api:"module.buffer.undo"},redo:{title:"## redo ##",icon:!0,api:"module.buffer.redo"},format:{title:"## format ##",icon:!0,dropdown:{p:{title:"## paragraph ##",api:"module.block.format",args:{tag:"p"}},blockquote:{title:"## quote ##",api:"module.block.format",args:{tag:"blockquote"}},pre:{title:"## code ##",api:"module.block.format",args:{tag:"pre"}},h1:{title:"## heading1 ##",api:"module.block.format",args:{tag:"h1"}},h2:{title:"## heading2 ##",api:"module.block.format",args:{tag:"h2"}},h3:{title:"## heading3 ##",api:"module.block.format",args:{tag:"h3"}},h4:{title:"## heading4 ##",api:"module.block.format",args:{tag:"h4"}},h5:{title:"## heading5 ##",api:"module.block.format",args:{tag:"h5"}},h6:{title:"## heading6 ##",api:"module.block.format",args:{tag:"h6"}}}},bold:{title:"## bold-abbr ##",icon:!0,tooltip:"## bold ##",api:"module.inline.format",args:{tag:"b"}},italic:{title:"## italic-abbr ##",icon:!0,tooltip:"## italic ##",api:"module.inline.format",args:{tag:"i"}},deleted:{title:"## deleted-abbr ##",icon:!0,tooltip:"## deleted ##",api:"module.inline.format",args:{tag:"del"}},underline:{title:"## underline-abbr ##",icon:!0,tooltip:"## underline ##",api:"module.inline.format",args:{tag:"u"}},sup:{title:"## superscript-abbr ##",icon:!0,tooltip:"## superscript ##",api:"module.inline.format",args:{tag:"sup"}},sub:{title:"## subscript-abbr ##",icon:!0,tooltip:"## subscript ##",api:"module.inline.format",args:{tag:"sub"}},lists:{title:"## lists ##",icon:!0,observe:"list",dropdown:{observe:"list",unorderedlist:{title:"&bull; ## unorderedlist ##",api:"module.list.toggle",args:"ul"},orderedlist:{title:"1. ## orderedlist ##",api:"module.list.toggle",args:"ol"},outdent:{title:"< ## outdent ##",api:"module.list.outdent"},indent:{title:"> ## indent ##",api:"module.list.indent"}}},ul:{title:"&bull; ## bulletslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ul"},ol:{title:"1. ## numberslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ol"},outdent:{title:"## outdent ##",icon:!0,api:"module.list.outdent",observe:"list"},indent:{title:"## indent ##",icon:!0,api:"module.list.indent",observe:"list"},image:{title:"## image ##",icon:!0,api:"module.image.open"},file:{title:"## file ##",icon:!0,api:"module.file.open"},link:{title:"## link ##",icon:!0,observe:"link",dropdown:{observe:"link",link:{title:"## link-insert ##",api:"module.link.open"},unlink:{title:"## unlink ##",api:"module.link.unlink"}}},line:{title:"## horizontalrule ##",icon:!0,api:"module.line.insert"}};var App=function(t,e,i){this.module={},this.plugin={},this.instances={},this.started=!1,this.stopped=!1,this.uuid=i,this.rootElement=t,this.rootOpts=e,this.dragInside=!1,this.dragComponentInside=!1,this.keycodes=$R.keycodes,this.namespace="redactor",this.$win=$R.dom(window),this.$doc=$R.dom(document),this.$body=$R.dom("body"),this.editorReadOnly=!1,this.opts=$R.create("service.options",e,t),this.lang=$R.create("service.lang",this),this.buildServices(),this.buildModules(),this.buildPlugins(),this.start()};App.prototype={start:function(){this.stopped=!1,this.broadcast("start"),this.broadcast("startcode"),this.opts.clickToEdit?this.broadcast("startclicktoedit"):(this.broadcast("enable"),this.opts.showSource&&this.broadcast("startcodeshow"),this.broadcast("enablefocus")),this.broadcast("started"),this.started=!0},stop:function(){this.started=!1,this.stopped=!0,this.broadcast("stop"),this.broadcast("disable"),this.broadcast("stopped")},isStarted:function(){return this.started},isStopped:function(){return this.stopped},buildServices:function(){var t=["options","lang"],e=["uuid","keycodes","opts","lang","$win","$doc","$body"],i=[];for(var n in $R.services)-1===t.indexOf(n)&&(this[n]=$R.create("service."+n,this),i.push(n),e.push(n));for(var s=0;s<i.length;s++)for(var r=i[s],o=0;o<e.length;o++){var a=e[o];r!==a&&(this[r][a]=this[a])}},buildModules:function(){for(var t in $R.modules)this.module[t]=$R.create("module."+t,this),this.instances[t]=this.module[t]},buildPlugins:function(){for(var t=this.opts.plugins,e=0;e<t.length;e++){var i=t[e];"undefined"!=typeof $R.plugins[i]&&(this.plugin[i]=$R.create("plugin."+i,this),this.instances[i]=this.plugin[i])}},isDragInside:function(){return this.dragInside},setDragInside:function(t){this.dragInside=t},isDragComponentInside:function(){return this.dragComponentInside},setDragComponentInside:function(t){this.dragComponentInside=t},getDragComponentInside:function(){return this.dragComponentInside},isReadOnly:function(){return this.editorReadOnly},enableReadOnly:function(){this.editorReadOnly=!0,this.broadcast("enablereadonly"),this.component.clearActive(),this.toolbar.disableButtons()},disableReadOnly:function(){this.editorReadOnly=!1,this.broadcast("disablereadonly"),this.toolbar.enableButtons()},callMessageHandler:function(t,e,i){var n=e.split(".");if(1===n.length)"function"==typeof t["on"+e]&&t["on"+e].apply(t,i);else{n[0]="on"+n[0];var s=this.utils.checkProperty(t,n);"function"==typeof s&&s.apply(t,i)}},broadcast:function(t){var e=[].slice.call(arguments,1);for(var i in this.instances)this.callMessageHandler(this.instances[i],t,e);return this.callback.trigger(t,e)},on:function(t,e){this.callback.add(t,e)},off:function(t,e){this.callback.remove(t,e)},api:function(t){if((this.isStarted()||"start"===t)&&(!this.isReadOnly()||"disableReadOnly"===t)){this.broadcast("state");var e=[].slice.call(arguments,1),i=t.split("."),n=1===i.length,s="on"===i[0]||"off"===i[0],r=!s&&2===i.length,o="plugin"===i[0],a="module"===i[0];if(n){if("function"==typeof this[i[0]])return this.callInstanceMethod(this,i[0],e)}else{if(s)return"on"===i[0]?this.on(i[1],e[0]):this.off(i[1],e[0]||undefined);if(r){if(this.isInstanceExists(this,i[0]))return this.callInstanceMethod(this[i[0]],i[1],e);$R.error(new Error('Service "'+i[0]+'" not found'))}else if(o){if(this.isInstanceExists(this.plugin,i[1]))return this.callInstanceMethod(this.plugin[i[1]],i[2],e);$R.error(new Error('Plugin "'+i[1]+'" not found'))}else if(a){if(this.isInstanceExists(this.module,i[1]))return this.callInstanceMethod(this.module[i[1]],i[2],e);$R.error(new Error('Module "'+i[1]+'" not found'))}}}},isInstanceExists:function(t,e){return"undefined"!=typeof t[e]},callInstanceMethod:function(t,e,i){if("function"==typeof t[e])return t[e].apply(t,i)}},$R.add("mixin","formatter",{buildArgs:function(t){this.args={"class":t["class"]||!1,style:t.style||!1,attr:t.attr||!1},this.args["class"]||this.args.style||this.args.attr||(this.args=!1)},applyArgs:function(t,e){return t=this.args?this[this.type](this.args,!1,t,e):this._clearAll(t,e)},clearClass:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return i.removeAttr("class"),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},clearStyle:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return i.removeAttr("style"),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},clearAttr:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return this._removeAllAttr(i),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},set:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);return t["class"]&&(s.removeAttr("class"),s.addClass(t["class"])),t.style&&(s.removeAttr("style"),s.css(t.style),s.each(function(t){var e=$R.dom(t);e.attr("data-redactor-style-cache",e.attr("style"))})),t.attr&&(this._removeAllAttr(s),s.attr(t.attr)),!1!==n&&this.selection.restore(),s.getAll()},toggle:function(t,e,i,n){!1!==n&&this.selection.save();var r,s=i?$R.dom(i):this.getElements(e);return t["class"]&&(s.toggleClass(t["class"]),s.each(function(t){""===t.className&&t.removeAttribute("class")})),t.style&&(r=t.style,s.each(function(t){var e=$R.dom(t);for(var i in r){var n=r[i],s=e.css(i);s=this.utils.isRgb(s)?this.utils.rgb2hex(s):s.replace(/"/g,""),n=this.utils.isRgb(n)?this.utils.rgb2hex(n):n.replace(/"/g,""),s=this.utils.hex2long(s),("string"==typeof(n=this.utils.hex2long(n))?n.toLowerCase():n)===("string"==typeof s?s.toLowerCase():s)?e.css(i,""):e.css(i,n)}this._convertStyleQuotes(e),this.utils.removeEmptyAttr(t,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))}.bind(this))),t.attr&&(r=t.attr,s.each(function(t){var e=$R.dom(t);for(var i in r)e.attr(i)?e.removeAttr(i):e.attr(i,r[i])})),!1!==n&&this.selection.restore(),s.getAll()},add:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);if(t["class"]&&s.addClass(t["class"]),t.style){var r=t.style;s.each(function(t){var e=$R.dom(t);e.css(r),e.attr("data-redactor-style-cache",e.attr("style")),this._convertStyleQuotes(e)}.bind(this))}return t.attr&&s.attr(t.attr),!1!==n&&this.selection.restore(),s.getAll()},remove:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);if(t["class"]&&(s.removeClass(t["class"]),s.each(function(t){""===t.className&&t.removeAttribute("class")})),t.style){var r=t.style;s.each(function(t){var e=$R.dom(t);e.css(r,""),this.utils.removeEmptyAttr(t,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))}.bind(this))}return t.attr&&s.removeAttr(t.attr),i=this._unwrapSpanWithoutAttr(s.getAll()),!1!==n&&this.selection.restore(),i},_removeAllAttr:function(t){t.each(function(t){for(var e=t.attributes.length;0<e--;){var i=t.attributes[e],n=i.name;"style"!==n&&"class"!==n&&t.removeAttributeNode(i)}})},_convertStyleQuotes:function(t){var e=t.attr("style");e&&t.attr("style",e.replace(/"/g,"'"))},_clearAll:function(t,e){!1!==e&&this.selection.save();for(var i=0;i<t.length;i++)for(var n=t[i];0<n.attributes.length;)n.removeAttribute(n.attributes[0].name);return t=this._unwrapSpanWithoutAttr(t),!1!==e&&this.selection.restore(),t},_unwrapSpanWithoutAttr:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];n.attributes.length<=0&&3!==n.nodeType&&"SPAN"===n.tagName?$R.dom(n).unwrap():e.push(n)}return e}}),$R.add("mixin","dom",$R.Dom.prototype),$R.add("mixin","component",{get cmnt(){return!0}}),$R.add("service","options",{init:function(t,e){var i=$R.dom(e),n=$R.extend({},$R.opts,e?i.data():{},$R.options);return n=$R.extend(!0,n,t)}}),$R.add("service","lang",{init:function(t){this.app=t,this.opts=t.opts,this.vars=this._build(this.opts.lang)},rebuild:function(t){this.opts.lang=t,this.vars=this._build(t)},extend:function(t){this.vars=$R.extend(this.vars,t)},parse:function(t){if(t===undefined)return"";var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var n=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(n))}return t},get:function(t){var e="";return"undefined"!=typeof this.vars[t]?e=this.vars[t]:"en"!==this.opts.lang&&"undefined"!=typeof $R.lang.en[t]&&(e=$R.lang.en[t]),e},_build:function(t){var e=$R.lang.en;return"en"!==t&&(e=$R.lang[t]!==undefined?$R.lang[t]:e),e}}),$R.add("service","callback",{init:function(t){this.app=t,this.opts=t.opts,this.callbacks={},this.opts.callbacks&&this._set(this.opts.callbacks,"")},stop:function(){this.callbacks={}},add:function(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)},remove:function(t,e){if(e===undefined)delete this.callbacks[t];else{for(var i=0;i<this.callbacks[t].length;i++)this.callbacks[t].splice(i,1);0===Object.keys(this.callbacks[t]).length&&delete this.callbacks[t]}},trigger:function(t,e){var i=this._loop(t,e,this.callbacks);return void 0===i&&e&&!1!==e[0]?e[0]:i},_set:function(t,e){for(var i in t){var n=""===e?i:e+"."+i;"object"==typeof t[i]?this._set(t[i],n):(this.callbacks[n]=[],this.callbacks[n].push(t[i]))}},_loop:function(t,e,i){var n;for(var s in i)if(t===s)for(var r=0;r<i[s].length;r++)n=i[s][r].apply(this.app,e);return n}}),$R.add("service","animate",{init:function(t){this.animationOpt=t.opts.animation},start:function(t,e,i,n){var s={duration:!1,iterate:!1,delay:!1,timing:!1,prefix:"redactor-"};return s="function"==typeof i?s:$R.extend(s,i),n="function"==typeof i?i:n,new $R.AnimatePlay(t,e,s,n,this.animationOpt)},stop:function(t){this.$el=$R.dom(t),this.$el.removeClass("redactor-animated");var e=this.$el.attr("redactor-animate-effect");this.$el.removeClass(e),this.$el.removeAttr("redactor-animate-effect");var i=this.$el.attr("redactor-animate-hide");i&&this.$el.addClass(i).removeAttr("redactor-animate-hide"),this.$el.off("animationend webkitAnimationEnd")}}),$R.AnimatePlay=function(t,e,i,n,s){return this.hidableEffects=["fadeOut","flipOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"],this.prefixes=["","-webkit-"],this.$el=$R.dom(t),this.$body=$R.dom("body"),this.callback=n,this.animation=s?e:this.buildAnimationOff(e),this.defaults=i,"slideUp"===this.animation&&this.$el.height(this.$el.height()),this.isInanimate()?this.inanimate():this.animate()},$R.AnimatePlay.prototype={buildAnimationOff:function(t){return this.isHidable(t)?"hide":"show"},buildHideClass:function(){return"redactor-animate-hide"},isInanimate:function(){return"show"===this.animation||"hide"===this.animation},isAnimated:function(){return this.$el.hasClass("redactor-animated")},isHidable:function(t){return-1!==this.hidableEffects.indexOf(t)},inanimate:function(){var t;return this.defaults.timing="linear","show"===this.animation?(t=this.buildHideClass(),this.$el.attr("redactor-animate-hide",t),this.$el.removeClass(t)):(t=this.$el.attr("redactor-animate-hide"),this.$el.addClass(t).removeAttr("redactor-animate-hide")),"function"==typeof this.callback&&this.callback(this),this},animate:function(){var t=this.defaults.delay?this.defaults.delay:0;return setTimeout(function(){if(this.$body.addClass("no-scroll-x"),this.$el.addClass("redactor-animated"),!this.$el.attr("redactor-animate-hide")){var t=this.buildHideClass();this.$el.attr("redactor-animate-hide",t),this.$el.removeClass(t)}this.$el.addClass(this.defaults.prefix+this.animation),this.$el.attr("redactor-animate-effect",this.defaults.prefix+this.animation),this.set(this.defaults.duration+"s",this.defaults.iterate,this.defaults.timing),this.complete()}.bind(this),1e3*t),this},set:function(t,e,i){for(var n=this.prefixes.length;n--;)!1===t&&""!==t||this.$el.css(this.prefixes[n]+"animation-duration",t),!1===e&&""!==e||this.$el.css(this.prefixes[n]+"animation-iteration-count",e),!1===i&&""!==i||this.$el.css(this.prefixes[n]+"animation-timing-function",i)},clean:function(){this.$body.removeClass("no-scroll-x"),this.$el.removeClass("redactor-animated"),this.$el.removeClass(this.defaults.prefix+this.animation),this.$el.removeAttr("redactor-animate-effect"),this.set("","","")},complete:function(){this.$el.one("animationend webkitAnimationEnd",function(){if(this.$el.hasClass(this.defaults.prefix+this.animation)&&this.clean(),this.isHidable(this.animation)){var t=this.$el.attr("redactor-animate-hide");this.$el.addClass(t).removeAttr("redactor-animate-hide")}"slideUp"===this.animation&&this.$el.height(""),"function"==typeof this.callback&&this.callback(this.$el)}.bind(this))}},$R.add("service","caret",{init:function(t){this.app=t},setStart:function(t){this._setCaret("Start",t)},setEnd:function(t){this._setCaret("End",t)},setBefore:function(t){this._setCaret("Before",t)},setAfter:function(t){this._setCaret("After",t)},isStart:function(t){return this._isStartOrEnd(t,"First")},isEnd:function(t){return this._isStartOrEnd(t,"Last")},setAtEnd:function(t){var e=this.inspector.parse(t).getTag(),i=document.createRange();if(this._isInPage(t)){if("a"===e){var n=this.utils.createInvisibleChar();$R.dom(t).after(n),i.selectNodeContents(n),i.collapse(!0)}else i.selectNodeContents(t),i.collapse(!1);this.selection.setRange(i)}},setAtStart:function(t){var e=document.createRange(),i=this.inspector.parse(t);if(this._isInPage(t)){if(e.setStart(t,0),e.collapse(!0),i.isInline()||this.utils.isEmpty(t)){var n=this.utils.createInvisibleChar();e.insertNode(n),e.selectNodeContents(n),e.collapse(!1)}this.selection.setRange(e)}},setAtBefore:function(t){var e=this.inspector.parse(t),i=document.createRange();if(this._isInPage(t)){if(i.setStartBefore(t),i.collapse(!0),e.isInline()){var n=this.utils.createInvisibleChar();t.parentNode.insertBefore(n,t),i.selectNodeContents(n),i.collapse(!1)}this.selection.setRange(i)}},setAtAfter:function(t){var e=document.createRange();if(this._isInPage(t)){e.setStartAfter(t),e.collapse(!0);var i=this.utils.createInvisibleChar();e.insertNode(i),e.selectNodeContents(i),e.collapse(!1),this.selection.setRange(e)}},setAtPrev:function(t){var e=t.previousSibling;e&&(e=3===e.nodeType&&this._isEmptyTextNode(e)?e.previousElementSibling:e)&&this.setEnd(e)},setAtNext:function(t){var e=t.nextSibling;e&&(e=3===e.nodeType&&this._isEmptyTextNode(e)?e.nextElementSibling:e)&&this.setStart(e)},_setCaret:function(t,e){var i=this.inspector.parse(e),n=i.getNode();n&&(this.component.clearActive(),this["_set"+t](n,i,i.getTag()))},_setStart:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtStart(t);if("ul"===i||"ol"===i){t=e.findFirstNode("li");var n=this.utils.getFirstElement(t),s=this.inspector.parse(n);if(n&&s.isComponent())return this.setStart(s.getComponent())}else if("dl"===i)t=e.findFirstNode("dt");else{if("br"===i||"hr"===i)return this.setBefore(t);if("td"===i||"th"===i){var r=e.getFirstElement(t);if(r)return this.setStart(r)}else{if("table"===i||"tr"===i)return this.setStart(e.findFirstNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var o=e.findLastNode("pre, code");return this.editor.focus(),this.setAtStart(o)}if("figure"===i&&e.isComponentType("table")){var a=e.getTable(),l=this.inspector.parse(a);return this.setStart(l.findFirstNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}this.editor.focus(),this._setInline(t,"Start")||this.setAtStart(t)},_setEnd:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtEnd(t);if("ul"===i||"ol"===i){t=e.findLastNode("li");var n=this.utils.getLastElement(t),s=this.inspector.parse(n);if(n&&s.isComponent())return this.setEnd(s.getComponent())}else if("dl"===i)t=e.findLastNode("dd");else{if("br"===i||"hr"===i)return this.setAfter(t);if("td"===i||"th"===i){var r=e.getLastElement();if(r)return this.setEnd(r)}else{if("table"===i||"tr"===i)return this.setEnd(e.findLastNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var o=e.findLastNode("pre, code");return this.editor.focus(),this.setAtEnd(o)}if("figure"===i&&e.isComponentType("table")){var a=e.getTable(),l=this.inspector.parse(a);return this.setEnd(l.findLastNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}if(this.editor.focus(),!this._setInline(t,"End")){if(this.utils.isEmpty(t))return this.setStart(t);this.setAtEnd(t)}},_setBefore:function(t,e,i){return 3===t.nodeType?this.setAtBefore(t):e.isInline()?this.setAtBefore(t):e.isFirstTableCell()?this.setAtPrev(e.getComponent()):"td"===i||"th"===i?this.setAtPrev(t):e.isFirstListItem()?this.setAtPrev(e.getList()):e.isFigcaption()?this.setStart(e.getComponent()):!e.isComponentType("table")&&e.isComponent()?this.setAtPrev(e.getComponent()):e.isBlock()?this.setAtPrev(t):(this.editor.focus(),void this.setAtBefore(t))},_setAfter:function(t,e,i){return 3===t.nodeType?this.setAtAfter(t):e.isInline()?this.setAtAfter(t):e.isLastTableCell()?this.setAtNext(e.getComponent()):"td"===i||"th"===i?this.setAtNext(t):e.isFirstListItem()?this.setAtNext(e.getList()):!e.isComponentType("table")&&e.isComponent()?this.setAtNext(e.getComponent()):e.isBlock()?this.setAtNext(t):(this.editor.focus(),void this.setAtAfter(t))},_setInline:function(t,e){var i=this._hasInlineChild(t,"Start"===e?"first":"last");if(i)return"Start"===e?this.setStart(i):this.setEnd(i),!0},_isStartOrEnd:function(t,e){var i=this.utils.getNode(t);if(!i)return!1;var n=this.inspector.parse(i);if((i=this._getStartEndNode(i,n,e))&&3!==i.nodeType&&"LI"!==i.tagName){var s=3===i.nodeType?i.textContent:i.innerHTML;if(""===(s=this.utils.trimSpaces(s)))return!0}if(!n.isFigcaption()&&n.isComponent()&&!n.isComponentEditable())return!0;var r=this.offset.get(i,!0);return!!r&&("First"===e?0===r.start:r.end===this.offset.size(i,!0))},_isInPage:function(t){return!(!t||!t.nodeType)&&(t!==document.body&&document.body.contains(t))},_hasInlineChild:function(t,e){var i=this.inspector.parse(t),n="first"===e?i.getFirstNode():i.getLastNode(),s=$R.dom(n);if(n&&3!==n.nodeType&&this.inspector.isInlineTag(n.tagName)&&!s.hasClass("redactor-component")&&!s.hasClass("non-editable"))return n},_isEmptyTextNode:function(t){var e=t.textContent.trim().replace(/\n/,"");return""===(e=this.utils.removeInvisibleChars(e))},_getStartEndNode:function(t,e,i){return e.isFigcaption()?t=e.getFigcaption():e.isTable()?t=e["find"+i+"Node"]("th, td"):e.isList()?t=e["find"+i+"Node"]("li"):e.isComponentType("code")&&(t=e.findLastNode("pre, code")),t}});var containsNode=function containsNode(t){return document.getSelection().containsNode(t,!0)};"containsNode"in Selection.prototype||(containsNode=containsNodePolyfill);var containsNodePolyfill=function polyfill(t){var e=document.getSelection(),i=e.anchorNode.parentNode,n=e.focusNode.parentNode,s=e.getRangeAt(0).getBoundingClientRect(),r=t.getBoundingClientRect();return!!$R.dom(i).closest(t).length||(!!$R.dom(n).closest(t).length||s.top<r.top&&s.height>r.height)};$R.add("service","selection",{init:function(t){this.app=t},is:function(){var t=this.get();if(t){var e=t.anchorNode,i=this.inspector.parse(e);return i.isInEditor()||i.isEditor()}return!1},isCollapsed:function(){var t=this.get(),e=this.getRange();return!(!t||!t.isCollapsed)||!(!e||0!==e.toString().length)},isBackwards:function(){var t=!1,e=this.get();if(e&&!e.isCollapsed){var i=document.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset),t=i.collapsed,i.detach()}return t},isIn:function(t){var e=$R.dom(t).get(),i=this.getCurrent();return!(!i||!e)&&e.contains(i)},isText:function(){var t=this.get();if(t){var e=t.anchorNode,i=this.getBlock(e),n=this.getBlocks();if(i&&this.inspector.isTableCellTag(i.tagName)||!1===i&&0===n.length)return!0}return!1},isAll:function(t){var e=this.utils.getNode(t);if(!e)return!1;var i=this.editor.isEditor(e),n=this.inspector.parse(e);if(!n.isFigcaption()&&this.component.isNonEditable(e)&&this.component.isActive(e))return!0;if(i){var s=this.editor.getElement().html().replace(/<p><\/p>$/i,"");if(this.getHtml(!1).length!==s.length)return!1}if(i&&this.editor.isEmpty()||this.isCollapsed())return!1;var r=this.offset.get(e,!0),o=this.offset.size(e,!0);return!i&&n.isComponentType("code")&&(o=this.getText().trim().length),!(!r||0!==r.start||r.end!==o)},hasNonEditable:function(){var t=this.getHtml(),e=$R.dom("<div>").html(t);return!this.isCollapsed()&&0!==e.find(".non-editable").length},setRange:function(t){var e=window.getSelection();e.removeAllRanges(),e.addRange(t)},setAll:function(t){var e=this.utils.getNode(t);if(e){var i=this.inspector.parse(e);if(this.component.clearActive(),this.editor.focus(),this.editor.saveScroll(),this.editor.disableNonEditables(),e&&"TABLE"===e.tagName){var n=i.findFirstNode("td, th"),s=i.findLastNode("td, th");$R.dom(n).prepend(this.marker.build("start")),$R.dom(s).append(this.marker.build("end")),this.restoreMarkers()}else if(!i.isFigcaption()&&this.component.isNonEditable(e))this.component.setActive(e);else{i.isComponentType("code")&&(e=i.getComponentCodeElement()).focus();var r=document.createRange();r.selectNodeContents(e),this.setRange(r)}this.editor.enableNonEditables(),this.editor.restoreScroll()}},get:function(){var t=window.getSelection();return 0<t.rangeCount?t:null},getRange:function(){var t=this.get();return t&&t.getRangeAt(0)?t.getRangeAt(0):null},getTextBeforeCaret:function(t){t=void 0===t?1:t;var e=this.editor.getElement().get(),i=this.getRange(),n=!1;return i&&((i=i.cloneRange()).collapse(!0),i.setStart(e,0),n=i.toString().slice(-t)),n},getTextAfterCaret:function(t){t=void 0===t?1:t;var e=this.editor.getElement().get(),i=this.getRange(),n=!1;if(i){var s=i.cloneRange();s.selectNodeContents(e),s.setStart(i.endContainer,i.endOffset),n=s.toString().slice(0,t)}return n},getPosition:function(){var t=this.getRange(),e={top:0,left:0,width:0,height:0};if(window.getSelection&&t.getBoundingClientRect){var i=(t=t.cloneRange()).startOffset-1;t.setStart(t.startContainer,i<0?0:i);var n=t.getBoundingClientRect();e={top:n.top,left:n.left,width:n.right-n.left,height:n.bottom-n.top}}return e},getCurrent:function(){var t=!1,e=this.get(),i=this.component.getActive();if(i)t=i;else if(e&&this.is()){t=!this.inspector.parse(e.anchorNode).isEditor()&&e.anchorNode}return t},getParent:function(){var t=!1,e=this.getCurrent();if(e){var i=e.parentNode;t=!this.inspector.parse(i).isEditor()&&i}return t},getElement:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(i.isElement()&&i.isInEditor())return e;e=e.parentNode}return!1},getInline:function(t){for(var e=t||this.getCurrent(),i=!1;e;)this._isInlineNode(e)&&(i=e),e=e.parentNode;return i},getInlineFirst:function(t){for(var e=t||this.getCurrent();e;){if(this._isInlineNode(e))return e;e=e.parentNode}return!1},getInlineAll:function(t){for(var e=t||this.getCurrent(),i=[];e;)this._isInlineNode(e)&&i.push(e),e=e.parentNode;return i},getBlock:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(this.inspector.isBlockTag(e.tagName)&&i.isInEditor(e))return e;e=e.parentNode}return!1},getInlinesAllSelected:function(t){if(this.isAll())return[];var e=this.getInlines({all:!0}),i=this.getNodes({textnodes:!0,inline:!1}),n=this.getText().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=[];if(0!==i.length)return s;if(""===n)s=e;else if(1<e.length)for(var r=0;r<e.length;r++)this._isTextSelected(e[r],n)&&s.push(e[r]);else 1===e.length&&this._isTextSelected(e[0],n)&&(s=e);return s=t&&t.tags?this._filterNodesByTags(s,t.tags):s},getInlines:function(t){for(var e=this.getNodes(),i=[],n=0;n<e.length;n++){var s;if(t&&t.all)for(s=e[n];s;)this._isInlineNode(s)&&!this._isInNodesArray(i,s)&&i.push(s),s=s.parentNode;else(s=this.getInline(e[n]))&&!this._isInNodesArray(i,s)&&i.push(s)}return i=t&&t.tags?this._filterNodesByTags(i,t.tags):i,i=t&&t.inside?this._filterInlinesInside(i,t):i},getBlocks:function(t){var e=this.getNodes(),i=this.getBlock();e=0===e.length&&i?[i]:e;for(var n=[],s=0;s<e.length;s++){var r=this.getBlock(e[s]);$R.dom(r).hasClass("non-editable")||r&&!this._isInNodesArray(n,r)&&n.push(r)}return n=t&&t.tags?this._filterNodesByTags(n,t.tags):n,n=t&&t.first?this._filterBlocksFirst(n,t):n},getElements:function(t){var e=this.getNodes({textnodes:!1}),i=this.getBlock();e=0===e.length&&i?[i]:e;for(var n=[],s=0;s<e.length;s++)this._isInNodesArray(n,e[s])||n.push(e[s]);return n=t&&t.tags?this._filterNodesByTags(n,t.tags):n},getNodes:function(t){var e=[],i=this.component.getActive();if(i)e=this._getNodesComponent(i);else if(this.isCollapsed()){var n=this.getCurrent();e=n?[n]:[]}else this.is()&&!i&&(e=this._getRangeSelectedNodes());return e=this._filterServicesNodes(e),e=this._filterEditor(e),e=t&&t.tags?this._filterNodesByTags(e,t.tags):e,e=t&&t.textnodes?this._filterNodesTexts(e,t):e,e=t&&!t.textnodes?this._filterNodesElements(e):e},getText:function(){var t=this.get();return t?this.utils.removeInvisibleChars(t.toString()):""},getHtml:function(t){var e="",i=this.get();if(i){for(var n=document.createElement("div"),s=i.rangeCount,r=0;r<s;++r)n.appendChild(i.getRangeAt(r).cloneContents());e=n.innerHTML,e=(e=!1!==t?this.cleaner.output(e):e).replace(/<p><\/p>$/i,"")}return e},clear:function(){this.component.clearActive(),this.get().removeAllRanges()},collapseToStart:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToStart()},collapseToEnd:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToEnd()},saveActiveComponent:function(){var t=this.component.getActive();return!!t&&(this.savedComponent=t,!0)},restoreActiveComponent:function(){return!!this.savedComponent&&(this.component.setActive(this.savedComponent),!0)},save:function(){this._clearSaved();var t=this.getElement();!t||-1===["TD","TH","P","DIV","PRE","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE"].indexOf(t.tagName)||""!==t.innerHTML&&"<br>"!==t.innerHTML?this.saveActiveComponent()||(this.saved=this.offset.get()):this.savedElement=t},restore:function(){(this.saved||this.savedComponent||this.savedElement)&&(this.editor.saveScroll(),this.savedElement?this.caret.setStart(this.savedElement):this.restoreActiveComponent()||this.offset.set(this.saved),this._clearSaved(),this.editor.restoreScroll())},saveMarkers:function(){this._clearSaved(),this.saveActiveComponent()||this.marker.insert()},restoreMarkers:function(){this.editor.saveScroll(),this.restoreActiveComponent()||this.marker.restore(),this._clearSaved(),this.editor.restoreScroll()},_getNextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},_getNodesComponent:function(t){var e=this.getCurrent(),i=this.inspector.parse(e);return i.isFigcaption()?[i.getFigcaption()]:[t]},_getRangeSelectedNodes:function(){var t=[],e=this.getRange(),i=e.startContainer,n=e.startContainer,s=e.endContainer,r=this.editor.getElement();if(n===r.get()&&this.isAll())t=this.utils.getChildNodes(r);else if(i==s)t=[i];else{for(;i&&i!=s;)t.push(i=this._getNextNode(i));for(i=e.startContainer;i&&i!=e.commonAncestorContainer;)t.unshift(i),i=i.parentNode}return t},_isInNodesArray:function(t,e){return-1!==t.indexOf(e)},_filterEditor:function(t){for(var e=[],i=0;i<t.length;i++){this.inspector.parse(t[i]).isInEditor()&&e.push(t[i])}return e},_filterServicesNodes:function(t){for(var e=[],i=0;i<t.length;i++){var n=$R.dom(t[i]),s=!1;t[i]&&3===t[i].nodeType&&this.utils.isEmpty(t[i])&&(s=!0),(n.hasClass("redactor-script-tag")||n.hasClass("redactor-component-caret")||n.hasClass("redactor-selection-marker")||n.hasClass("non-editable"))&&(s=!0),s||e.push(t[i])}return e},_filterNodesTexts:function(t,e){for(var i=[],n=0;n<t.length;n++){if(3===t[n].nodeType||e.keepbr&&"BR"===t[n].tagName)this.getInline(t[n])&&e&&!1===e.inline||i.push(t[n])}return i},_filterNodesElements:function(t){for(var e=[],i=0;i<t.length;i++)3!==t[i].nodeType&&e.push(t[i]);return e},_filterNodesByTags:function(t,e,i){for(var n=[],s=0;s<t.length;s++)if(i&&3===t[s].nodeType)n.push(t[s]);else if(3!==t[s].nodeType){var r=t[s].tagName.toLowerCase();-1!==e.indexOf(r.toLowerCase())&&n.push(t[s])}return n},_filterBlocksFirst:function(t){for(var e=[],i=0;i<t.length;i++){var n=$R.dom(t[i]),s=n.parent().get(),r=n.parent().hasClass("redactor-in"),o=s&&("TD"===s.tagName||"TH"===s.tagName);(r||o)&&e.push(t[i])}return e},_filterInlinesInside:function(t){for(var e=[],i=0;i<t.length;i++)containsNode(t[i],!0)&&e.push(t[i]);return e},
_isTextSelected:function(t,e){var i=this.utils.removeInvisibleChars(t.textContent);return e===i||-1!==i.search(e)||-1!==e.search(new RegExp("^"+this.utils.escapeRegExp(i)))||-1!==e.search(new RegExp(this.utils.escapeRegExp(i)+"$"))},_isInlineNode:function(t){var e=this.inspector.parse(t);return this.inspector.isInlineTag(t.tagName)&&e.isInEditor()},_clearSaved:function(){this.saved=!1,this.savedComponent=!1,this.savedElement=!1}}),$R.add("service","element",{init:function(t){this.app=t,this.rootElement=t.rootElement,this.$element={},this.type="inline"},start:function(){this._build(),this._buildType()},isType:function(t){return t===this.type},getType:function(){return this.type},getElement:function(){return this.$element},_build:function(){this.$element=$R.dom(this.rootElement)},_buildType:function(){var t=this.$element.get().tagName;this.type="TEXTAREA"===t?"textarea":this.type,this.type="DIV"===t?"div":this.type,this.type=this.opts.inline?"inline":this.type}}),$R.add("service","editor",{init:function(t){this.app=t,this.scrolltop=!1,this.pasting=!1},start:function(){this._build()},focus:function(){this.isFocus()||this._isContenteditableFocus()||(this.saveScroll(),this.$editor.focus(),this.restoreScroll())},startFocus:function(){this.caret.setStart(this.getFirstNode())},endFocus:function(){this.caret.setEnd(this.getLastNode())},isPasting:function(){return this.pasting},enablePasting:function(){this.pasting=!0},disablePasting:function(){this.pasting=!1},saveScroll:function(){this.scrolltop=this._getScrollTarget().scrollTop()},restoreScroll:function(){!1!==this.scrolltop&&(this._getScrollTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},disableNonEditables:function(){this.$noneditables=this.$editor.find("[contenteditable=false]"),this.$noneditables.attr("contenteditable",!0)},enableNonEditables:function(){this.$noneditables&&setTimeout(function(){this.$noneditables.attr("contenteditable",!1)}.bind(this),1)},getFirstNode:function(){return this.$editor.contents()[0]},getLastNode:function(){var t=this.$editor.contents();return t[t.length-1]},isSourceMode:function(){return this.source.getElement().hasClass("redactor-source-open")},isEditor:function(t){return $R.dom(t).get()===this.$editor.get()},isEmpty:function(t){return this.utils.isEmptyHtml(this.$editor.html(),!1,t)},isFocus:function(){var t=$R.dom(document.activeElement);return 0!==this.$editor.find(".redactor-component-active").length||0!==t.closest(".redactor-in-"+this.uuid).length},setEmpty:function(){this.$editor.html(this.opts.emptyHtml)},getElement:function(){return this.$editor},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?"<div>":t.get();this.$editor=$R.dom(e)},_getScrollTarget:function(){var t=this.$doc;return t=this.opts.toolbarFixedTarget!==document?$R.dom(this.opts.toolbarFixedTarget):this.opts.scrollTarget?$R.dom(this.opts.scrollTarget):t},_isContenteditableFocus:function(){var t=this.selection.getBlock();return 0!==(t?$R.dom(t).closest("[contenteditable=true]").not(".redactor-in"):[]).length}}),$R.add("service","container",{init:function(t){this.app=t},start:function(){this._build()},getElement:function(){return this.$container},_build:function(){var t=this.element.isType("inline")?"<span>":"<div>";this.$container=$R.dom(t)}}),$R.add("service","source",{init:function(t){this.app=t,this.$source={},this.content=""},start:function(){this._build(),this._buildName(),this._buildStartedContent()},getElement:function(){return this.$source},getCode:function(){return this.$source.val()},getName:function(){return this.$source.attr("name")},getStartedContent:function(){return this.content},setCode:function(t){return this.insertion.set(t,!0,!1)},isNameGenerated:function(){return this.name},rebuildStartedContent:function(){this._buildStartedContent()},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.get():"<textarea>";this.$source=$R.dom(e)},_buildName:function(){var t=this.element.getElement();this.name=t.attr("name"),this.$source.attr("name",this.name?this.name:"content-"+this.uuid)},_buildStartedContent:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.val():t.html();this.content=e.trim()}}),$R.add("service","statusbar",{init:function(t){this.app=t,this.$statusbar={},this.items=[]},start:function(){this.$statusbar=$R.dom("<ul>"),this.$statusbar.attr("dir",this.opts.direction)},add:function(t,e){return this.update(t,e)},update:function(t,e){var i;return"undefined"!=typeof this.items[t]?i=this.items[t]:(i=$R.dom("<li>"),this.$statusbar.append(i),this.items[t]=i),i.html(e)},get:function(t){return!!this.items[t]&&this.items[t]},remove:function(t){this.items[t]&&(this.items[t].remove(),delete this.items[t])},getItems:function(){return this.items},removeItems:function(){this.items={},this.$statusbar.html("")},getElement:function(){return this.$statusbar}}),$R.add("service","toolbar",{init:function(t){this.app=t,this.buttons=[],this.dropdownOpened=!1,this.buttonsObservers={}},start:function(){this.is()&&(this.opts.activeButtons=this.opts.activeButtonsAdd?this._extendActiveButtons():this.opts.activeButtons,this.create())},stopObservers:function(){this.buttonsObservers={}},create:function(){this.$wrapper=$R.dom("<div>"),this.$toolbar=$R.dom("<div>")},observe:function(){if(this.is()){var t,e;for(var i in this.setButtonsInactive(),this.buttonsObservers)e=this.buttonsObservers[i],t=this.getButton(i),this.app.broadcast("button."+e+".observe",t);var n=this.opts.activeButtons,s=this.selection.getInlinesAllSelected(),r=this.selection.getInline();this.selection.isCollapsed()&&r&&s.push(r);var o=this._inlinesToTags(s);for(var a in n)-1!==o.indexOf(a)&&(t=this.getButton(n[a]))&&t.setActive()}},is:function(){return!(!this.opts.toolbar||this.detector.isMobile()&&this.opts.air)},isAir:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-air")},isFixed:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-toolbar-fixed")},isContextBar:function(){return this.$body.find("#redactor-context-toolbar-"+this.uuid).hasClass("open")},isTarget:function(){return this.opts.toolbarFixedTarget!==document},getElement:function(){return this.$toolbar},getWrapper:function(){return this.$wrapper},getDropdown:function(){return this.dropdownOpened},getTargetElement:function(){return $R.dom(this.opts.toolbarFixedTarget)},getButton:function(t){var e=this._findButton(".re-"+t);return 0!==e.length&&e.dataget("data-button-instance")},getButtons:function(){var i=[];return this._findButtons().each(function(t){var e=$R.dom(t);i.push(e.dataget("data-button-instance"))}),i},getButtonsKeys:function(){var i=[];return this._findButtons().each(function(t){var e=$R.dom(t);i.push(e.attr("data-re-name"))}),i},addButton:function(t,e,i,n){i=i||"end";var s=$R.create("toolbar.button",this.app,t,e);return e.observe&&(this.opts.activeButtonsObservers[t]={observe:e.observe,button:s}),this.is()&&("first"===i?this.$toolbar.prepend(s):"after"===i?n.after(s):"before"===i?n.before(s):this.$toolbar.append(s)),s},addButtonFirst:function(t,e){return this.addButton(t,e,"first")},addButtonAfter:function(t,e,i){var n=this.getButton(t);return n?this.addButton(e,i,"after",n):this.addButton(e,i)},addButtonBefore:function(t,e,i){var n=this.getButton(t);return n?this.addButton(e,i,"before",n):this.addButton(e,i)},addButtonObserver:function(t,e){this.buttonsObservers[t]=e},setButtons:function(t){this.buttons=t},setDropdown:function(t){this.dropdownOpened=t},setButtonsInactive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setInactive()},setButtonsActive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setActive()},disableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].disable()},enableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].enable()},_findButton:function(t){return this.is()?this.$toolbar.find(t):$R.dom()},_findButtons:function(){return this.is()?this.$toolbar.find(".re-button"):$R.dom()},_extendActiveButtons:function(){return $R.extend({},this.opts.activeButtons,this.opts.activeButtonsAdd)},_inlinesToTags:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].tagName.toLowerCase());return e}}),$R.add("class","toolbar.button",{mixins:["dom"],init:function(t,e,i){this.app=t,this.opts=t.opts,this.lang=t.lang,this.$body=t.$body,this.toolbar=t.toolbar,this.detector=t.detector,this.obj=i,this.name=e,this.dropdown=!1,this.tooltip=!1,this._init()},isActive:function(){return this.hasClass("redactor-button-active")},isDisabled:function(){return this.hasClass("redactor-button-disabled")},hasIcon:function(){return this.obj.icon&&!this.opts.buttonsTextLabeled},setDropdown:function(t){this.obj.dropdown=t,this.obj.message=!1,this.dropdown=$R.create("toolbar.dropdown",this.app,this.name,this.obj.dropdown),this.attr("data-dropdown",!0)},setMessage:function(t,e){this.obj.message=t,this.obj.args=e,this.obj.dropdown=!1},setApi:function(t,e){this.obj.api=t,this.obj.args=e,this.obj.dropdown=!1},setTitle:function(t){this.obj.title=this.lang.parse(t),this.obj.tooltip=this.obj.title,this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip}),this.attr("data-re-icon")||this.html(this.obj.title)},setTooltip:function(t){this.obj.tooltip=this.lang.parse(t),this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip})},setIcon:function(t){this.opts.buttonsTextLabeled||(this.obj.icon=!0,this.$icon=$R.dom(t),this.html(""),this.append(this.$icon),this.attr("data-re-icon",!0),this.addClass("re-button-icon"),this.setTooltip(this.obj.title),this._buildTooltip())},setActive:function(){this.addClass("redactor-button-active")},setInactive:function(){this.removeClass("redactor-button-active")},hideTooltip:function(){this.$body.find(".re-button-tooltip").remove()},getDropdown:function(){return this.dropdown},disable:function(){this.addClass("redactor-button-disabled")},enable:function(){this.removeClass("redactor-button-disabled")},toggle:function(t){t&&t.preventDefault(),this.isDisabled()||(this.obj.dropdown?this.dropdown.toggle(t):this.obj.api?this.app.api(this.obj.api,this.obj.args,this.name):this.obj.message&&this.app.broadcast(this.obj.message,this.obj.args,this.name),this.hideTooltip())},_init:function(){this._parseTitle(),this._parseTooltip(),this._build(),this._buildCallback(),this._buildAttributes(),this._buildObserver(),this.hasIcon()?(this._buildIcon(),this._buildTooltip()):this.html(this.obj.title)},_parseTooltip:function(){this.obj.tooltip=this.obj.tooltip?this.lang.parse(this.obj.tooltip):this.obj.title},_parseTitle:function(){this.obj.title=this.lang.parse(this.obj.title)},_build:function(){this.parse("<a>"),this.addClass("re-button re-"+this.name),this.attr("data-re-name",this.name),this.dataset("data-button-instance",this),this.obj.dropdown&&this.setDropdown(this.obj.dropdown)},_buildCallback:function(){this.on("click",this.toggle.bind(this))},_buildAttributes:function(){var t={href:"#",alt:this.obj.tooltip,rel:this.name,role:"button","aria-label":this.obj.tooltip,tabindex:"-1"};this.attr(t)},_buildObserver:function(){"undefined"!=typeof this.obj.observe&&this.toolbar.addButtonObserver(this.name,this.obj.observe)},_buildIcon:function(){var t=this.obj.icon,e=/(<([^>]+)>)/gi.test(t);this.$icon=e?$R.dom(t):$R.dom("<i>"),e||this.$icon.addClass("re-icon-"+this.name),this.append(this.$icon),this.attr("data-re-icon",!0),this.addClass("re-button-icon")},_buildTooltip:function(){this.detector.isDesktop()&&(this.tooltip=$R.create("toolbar.button.tooltip",this.app,this))}}),$R.add("class","toolbar.button.tooltip",{mixins:["dom"],init:function(t,e){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$body=t.$body,this.toolbar=t.toolbar,this.$button=e,this.created=!1,this._init()},open:function(){if(!this.$button.hasClass("redactor-button-disabled")&&!this.$button.hasClass("redactor-button-active")){this.created=!0,this.parse("<span>"),this.addClass("re-button-tooltip re-button-tooltip-"+this.uuid),this.$body.append(this),this.html(this.$button.attr("alt"));var t=this.$button.offset(),e="absolute",i=this.$button.height(),n=this.$button.width(),s=4;this.css({top:t.top+i+s+"px",left:t.left+n/2-this.width()/2+"px",position:e}),this.show()}},close:function(){this.created&&!this.$button.hasClass("redactor-button-disabled")&&(this.remove(),this.created=!1)},_init:function(){this.$button.on("mouseover",this.open.bind(this)),this.$button.on("mouseout",this.close.bind(this))}}),$R.add("class","toolbar.dropdown",{mixins:["dom"],init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$win=t.$win,this.$doc=t.$doc,this.$body=t.$body,this.animate=t.animate,this.toolbar=t.toolbar,this.name=e,this.started=!1,this.items="format"===e?$R.extend({},!0,i):i,this.$items=[]},toggle:function(t){this.started||this._build(),this.isOpened()&&this.isActive()?this.close(!1):this.open(t)},isOpened:function(){var t=this.$body.find(".redactor-dropdown-"+this.uuid+".open");return 0!==t.length&&t.attr("data-re-name")===this.name},isActive:function(){return 0!==this.$body.find("#redactor-dropdown-"+this.uuid+"-"+this.name+".open").length},getName:function(){return this.attr("data-re-name")},getItem:function(t){return this.$items[t]},getItemsByClass:function(t){var e=[];for(var i in this.$items){var n=this.$items[i];"object"==typeof n&&n.attr("data-re-name")&&n.hasClass(t)&&e.push(n)}return e},open:function(t){this._closeAll(),this.$btn=this.toolbar.getButton(this.name),this.app.broadcast("dropdown.open",t,this,this.$btn),this.toolbar.setDropdown(this),this.show(),this.removeClass("redactor-animate-hide"),this.addClass("open"),this._observe(),this.$btn.hideTooltip(),this.$btn.setActive(),this.$doc.on("keyup.redactor.dropdown-"+this.uuid,this._handleKeyboard.bind(this)),this.$doc.on("click.redactor.dropdown-"+this.uuid,this.close.bind(this)),this.updatePosition(),this.app.broadcast("dropdown.opened",t,this,this.$btn)},close:function(t,e){if(t){var i=$R.dom(t.target);if(this._isButton(t)||i.hasClass("redactor-dropdown-not-close")||i.hasClass("redactor-dropdown-item-disabled"))return void t.preventDefault()}this.app.broadcast("dropdown.close",this,this.$btn),this.toolbar.setDropdown(!1),this.$btn.setInactive(),!1===e?this._close():this.animate.start(this,"fadeOut",this._close.bind(this))},updatePosition:function(){var t=this.toolbar.isFixed(),e=this.toolbar.isTarget(),i=this.$btn.height(),n=this.$btn.width(),s=this.$btn.offset(),r="absolute",o=2;t&&(s.top=e?this.$btn.offset().top:this.$btn.position().top,r="fixed",o+=this.opts.toolbarFixedTopOffset);var a=0,l=s.left+a,c=parseFloat(this.css("width")),d=l-(this.$win.width()<l+c?c-n:0),h=s.top+i+o;d=d<0?4:d,this.css({maxHeight:"",position:r,top:h+"px",left:d+"px"});var u=10,p=this.$win.height()-(h-this.$doc.scrollTop())-u;this.css("max-height",p+"px")},_build:function(){this.parse("<div>"),this.attr("dir",this.opts.direction),this.attr("id","redactor-dropdown-"+this.uuid+"-"+this.name),this.attr("data-re-name",this.name),this.addClass("redactor-dropdown redactor-dropdown-"+this.uuid+" redactor-dropdown-"+this.name),this.dataset("data-dropdown-instance",this),this.items.sdom||"string"==typeof this.items?this._buildDom():this._buildItems(),this.$body.append(this),this.started=!0},_buildDom:function(){this.html("").append($R.dom(this.items))},_buildItems:function(){for(var t in this.items="format"===this.name?this._buildFormattingItems():this.items,this.items){var e=this.items[t];if("observe"===t)this.attr("data-observe",this.items[t]);else{var i=$R.create("toolbar.dropdown.item",this.app,t,e,this);this.$items[t]=i,this.append(i)}}},_buildFormattingItems:function(){for(var t in this.items)-1===this.opts.formatting.indexOf(t)&&delete this.items[t];if(this.opts.formattingHide)for(var t in this.items)-1!==this.opts.formattingHide.indexOf(t)&&delete this.items[t];if(this.opts.formattingAdd)for(var t in this.opts.formattingAdd)this.items[t]=this.opts.formattingAdd[t];return this.items},_handleKeyboard:function(t){27===t.which&&this.close()},_isButton:function(t){return $R.dom(t.target).closest(".re-button").get()===this.$btn.get()},_close:function(){this.$btn.setInactive(),this.$doc.off(".redactor.dropdown-"+this.uuid),this.removeClass("open"),this.addClass("redactor-animate-hide"),this.app.broadcast("dropdown.closed",this,this.$btn)},_closeAll:function(){this.$body.find(".redactor-dropdown-"+this.uuid+".open").each(function(t){$R.dom(t).dataget("data-dropdown-instance")._close()})},_observe:function(){var t=this.attr("data-observe");t&&this.app.broadcast("dropdown."+t+".observe",this)}}),$R.add("class","toolbar.dropdown.item",{mixins:["dom"],init:function(t,e,i,n){this.app=t,this.lang=t.lang,this.dropdown=n,this.name=e,this.obj=i,this._init()},setTitle:function(t){this.$span.html(t)},getTitle:function(){return this.$span.html()},enable:function(){this.removeClass("redactor-dropdown-item-disabled")},disable:function(){this.addClass("redactor-dropdown-item-disabled")},toggle:function(t){t&&t.preventDefault(),this.hasClass("redactor-dropdown-item-disabled")||(this.obj.message?this.app.broadcast(this.obj.message,this.obj.args,this.name):this.obj.api&&this.app.api(this.obj.api,this.obj.args,this.name))},_init:function(){this.parse("<a>"),this.attr("href","#"),this.addClass("redactor-dropdown-item-"+this.name),this.obj.classname&&this.addClass(this.obj.classname),this.attr("data-re-name",this.name),this.on("click",this.toggle.bind(this)),this.$span=$R.dom("<span>"),this.append(this.$span),this.setTitle(this.lang.parse(this.obj.title))}}),$R.add("service","cleaner",{init:function(t){this.app=t,this.opts=t.opts,this.storedComponents=[],this.storedImages=[],this.storedLinks=[],this.deniedTags=["font","html","head","link","title","body","meta","applet"],this.convertRules={},this.unconvertRules={},this.reComments=/<!--[\s\S]*?-->\n?/g,this.reSpacedEmpty=/^(||\s||<br\s?\/?>||&nbsp;)$/i,this.reScriptTag=/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi},addConvertRules:function(t,e){this.convertRules[t]=e},addUnconvertRules:function(t,e){this.unconvertRules[t]=e},input:function(t,e){t=(t=(t=this.encodePreCode(t)).replace(/\$/g,"&#36;")).replace(/&amp;/g,"&"),t=$R.create("cleaner.figure",this.app).convert(t,this.convertRules),t=this.storeComponents(t),t=this.replaceTags(t,this.opts.replaceTags),t=this._setSpanAttr(t),t=this._setStyleCache(t),t=this.removeTags(t,this.deniedTags),t=this.opts.removeScript?this._removeScriptTag(t):this._replaceScriptTag(t),t=this.opts.removeComments?this.removeComments(t):t,t=this._isSpacedEmpty(t)?this.opts.emptyHtml:t,t=this.restoreComponents(t),t=this._cleanWrapped(t);var i=this.utils.buildWrapper(t);i.find("img, svg").removeAttr("onload");var n=["alt","title","src","class","width","height","srcset","style"];return i.find("img").each(function(t){if(0<t.attributes.length)for(var e=t.attributes,i=e.length-1;0<=i;i--)-1===e[i].name.search(/^data\-/)&&-1===n.indexOf(e[i].name)&&t.removeAttribute(e[i].name)}),t=this.utils.getWrapperHtml(i),t=e?this.paragraphize(t):t},output:function(t,e){return t=(t=this.removeInvisibleSpaces(t)).replace(/&#36;/g,"$"),this._isSpacedEmpty(t)?"":this._isParagraphEmpty(t)?"":(t=this.removeServiceTagsAndAttrs(t,e),t=this.storeComponents(t),t=this.removeSpanWithoutAttributes(t),t=this.removeFirstBlockBreaklineInHtml(t),t=this.opts.removeScript?t:this._unreplaceScriptTag(t),t=this.opts.preClass?this._setPreClass(t):t,t=this.opts.linkNofollow?this._setLinkNofollow(t):t,t=this.opts.removeNewLines?this.cleanNewLines(t):t,t=this.restoreComponents(t),t=$R.create("cleaner.figure",this.app).unconvert(t,this.unconvertRules),t=this.removeEmptyAttributes(t,["style","class","rel","alt","title"]),t=this.cleanSpacesInPre(t),t=(t=this.tidy(t)).replace(/&amp;/g,"&"),this.opts.breakline&&(t=(t=t.replace(/<br\s?\/?>/gi,"<br>\n")).replace(/<br\s?\/?>\n+/gi,"<br>\n")),t=""===t.replace(/\n/g,"")?"":t)},paste:function(t){t=this.storeComponents(t);var e=this.deniedTags.concat(["iframe"]);t=(t=(t=(t=this.removeTags(t,e)).replace(new RegExp("<!doctype([\\s\\S]+?)>","gi"),"")).replace(new RegExp("<style([\\s\\S]+?)</style>","gi"),"")).replace(new RegExp("</p><br /><p","gi"),"</p><p");var i=this._isHtmlMsWord(t);if(t=this._cleanGDocs(t),t=i?this._cleanMsWord(t):t,!this.opts.pasteClean)return t=this.restoreComponents(t);if(this.opts.pastePlainText)return t=this.restoreComponents(t),this.pastePlainText(t);(s=this.utils.buildWrapper(t)).find("*").removeAttr("style"),s.find("[data-redactor-tag]").each(function(t){var e=$R.dom(t);e.removeAttr("data-redactor-tag"),this.utils.isEmptyHtml(e.html())?e.html("<br>").unwrap():t.lastChild&&"BR"===t.lastChild.tagName?e.unwrap():e.append("<br>").unwrap()}.bind(this)),t=(t=(t=this.utils.getWrapperHtml(s)).replace(/<br\s?\/?>$/,"")).replace(/<br\s?\/?><\/(td|th)>/,"</$1>");var n=this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);t=this.removeTagsExcept(t,n),t=this.opts.pasteLinks?t:this.removeTags(t,["a"]),t=this.opts.pasteImages?t:this.removeTags(t,["img"]);var s,r=(s=this.utils.buildWrapper(t)).find("*"),o=0!==this.opts.pasteKeepStyle.length?","+this.opts.pasteKeepStyle.join(","):"";r.not("[data-redactor-style-cache]"+o).removeAttr("style");var a=0!==this.opts.pasteKeepClass.length?","+this.opts.pasteKeepClass.join(","):"";r.not("[data-redactor-style-cache], span.redactor-component"+a).removeAttr("class");var l=0!==this.opts.pasteKeepAttrs.length?","+this.opts.pasteKeepAttrs.join(","):"";r.not("img, a, span.redactor-component, [data-redactor-style-cache]"+l).each(function(t){for(var e=t.attributes,i=e.length-1;0<=i;i--)"class"!==t.attributes[0].name&&t.removeAttribute(e[i].name)}),this.opts.pasteLinks&&!1!==this.opts.pasteLinkTarget&&s.find("a").attr("target",this.opts.pasteLinkTarget),s.find("[data-redactor-style-cache]").each(function(t){var e=t.getAttribute("data-redactor-style-cache");t.setAttribute("style",e)});var c=this.opts.imageAttrs;return s.find("img").each(function(t){if(0<t.attributes.length)for(var e=t.attributes,i=e.length-1;0<=i;i--)-1===c.indexOf(e[i].name)&&t.removeAttribute(e[i].name)}),s.find("span").each(function(t){0===t.attributes.length&&$R.dom(t).unwrap()}),s.find(this.opts.inlineTags.join(",")).each(function(t){0===t.attributes.length&&this.utils.isEmptyHtml(t.innerHTML)&&$R.dom(t).unwrap()}.bind(this)),s.find("ul, ol").each(function(t){var e=t.previousSibling;if(e&&"LI"===e.tagName){var i=$R.dom(e);i.find("p").unwrap(),i.append(t)}}),t=(t=(t=this.utils.getWrapperHtml(s)).replace(/<li><p>/gi,"<li>")).replace(/<\/p><\/li>/gi,"</li>"),this.opts.breakline&&(t=t.replace(/\n/g,"<br>")),t=(t=t.replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>"),i&&(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),t=this.restoreComponents(t)},pastePlainText:function(t){return t=this.opts.pasteLinks?this.storeLinks(t):t,t=this.opts.pasteImages?this.storeImages(t):t,t=this.getPlainText(t),t=this._replaceNlToBr(t),t=this.opts.pasteLinks?this.restoreLinks(t):t,t=this.opts.pasteImages?this.restoreImages(t):t},tidy:function(t){return t},paragraphize:function(t){return t=$R.create("cleaner.paragraphize",this.app).convert(t)},getFlatText:function(t){var e=$R.dom("<div>");return t.nodeType||t.dom?e.append(t):(t=(t=t.toString()).trim(),e.html(t)),(t=e.get().textContent||e.get().innerText||"")===undefined?"":t},getPlainText:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var e=document.createElement("div");return e.innerHTML=t,(t=e.textContent||e.innerText).trim()},replaceTags:function(t,e){if(e){var i=this,n=Object.keys(e),s=this.utils.buildWrapper(t);s.find(n.join(",")).each(function(t){i.utils.replaceToTag(t,e[t.tagName.toLowerCase()])}),t=this.utils.getWrapperHtml(s)}return t},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBlocksToBr:function(t){return t=t.replace(/<\/div>|<\/li>|<\/td>|<\/p>|<\/H[1-6]>/gi,"<br>")},cleanNewLines:function(t){return t.replace(/\r?\n/g,"")},cleanSpacesInPre:function(t){return t.replace("&nbsp;&nbsp;&nbsp;&nbsp;","    ")},removeInvisibleSpaces:function(t){return t=(t=this.utils.removeInvisibleChars(t)).replace(/&#65279;/gi,"")},removeNl:function(t){return t=(t=t.replace(/\n/g," ")).replace(/\s+/g,"s")},removeBrAtEnd:function(t){return t=(t=t.replace(/<br\s?\/?>$/gi," ")).replace(/<br\s?\/?><li/gi,"<li")},removeTags:function(t,i){var e=i?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,n=i?function(t,e){return-1===i.indexOf(e.toLowerCase())?t:""}:"";return t.replace(e,n)},removeTagsExcept:function(t,i){if(i===undefined)return t.replace(/(<([^>]+)>)/gi,"");var e=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t.replace(e,function(t,e){return-1===i.indexOf(e.toLowerCase())?"":t})},removeComments:function(t){return t.replace(this.reComments,"")},removeServiceTagsAndAttrs:function(t,e){var i=this.utils.buildWrapper(t),n=this;return!1!==e&&i.find(".redactor-selection-marker").each(function(t){var e=$R.dom(t);return""===n.utils.removeInvisibleChars(e.text())?e.remove():e.unwrap()}),i.find("[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),this.utils.getWrapperHtml(i)},removeSpanWithoutAttributes:function(t){var e=this.utils.buildWrapper(t);return e.find("span").removeAttr("data-redactor-span data-redactor-style-cache").each(function(t){0===t.attributes.length&&$R.dom(t).unwrap()}),this.utils.getWrapperHtml(e)},removeFirstBlockBreaklineInHtml:function(t){return t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")},removeEmptyAttributes:function(t,e){for(var i=this.utils.buildWrapper(t),n=0;n<e.length;n++)i.find("["+e[n]+'=""]').removeAttr(e[n]);return this.utils.getWrapperHtml(i)},encodeHtml:function(t){return t=(t=(t=(t=(t=(t=t.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," ")).replace(/\u201d/g,'"')).replace(/\u201c/g,'"')).replace(/\u2018/g,"'")).replace(/\u2019/g,"'"),t=(t=this.encodeEntities(t)).replace(/\$/g,"&#36;"),this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),t},encodePreCode:function(t){var e=t.match(new RegExp("<code(.*?)>(.*?)<pre(.*?)>(.*?)</pre>(.*?)</code>","gi"));if(null!==e)for(var i=0;i<e.length;i++){var n=e[i].match(new RegExp("<pre(.*?)>([\\w\\W]*?)</pre>","i"));t=t.replace(n[0],this.encodeEntities(n[0]))}var s=this.utils.buildWrapper(t);return s.find("code code").replaceWith(this._encodeOuter.bind(this)),s.find("code pre").replaceWith(this._encodeOuter.bind(this)),s.find("pre pre").replaceWith(this._encodeOuter.bind(this)),s.find("code, pre").each(this._encodePreCodeLine.bind(this)),t=this.utils.getWrapperHtml(s),t=this._decodeMarkers(t)},encodeEntities:function(t){return t=(t=this.decodeEntities(t)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodePhpCode:function(t){return t=(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},storeComponents:function(t){var e=this.utils.getElementsFromHtml(t,"figure","table");return this._storeMatched(t,e,"Components","figure")},restoreComponents:function(t){return this._restoreMatched(t,"Components","figure")},storeLinks:function(t){var e=this.utils.getElementsFromHtml(t,"a");return this._storeMatched(t,e,"Links","a")},storeImages:function(t){var e=this.utils.getElementsFromHtml(t,"img");return this._storeMatched(t,e,"Images","img")},restoreLinks:function(t){return this._restoreMatched(t,"Links","a")},restoreImages:function(t){return this._restoreMatched(t,"Images","img")},_cleanWrapped:function(t){return t=t.replace(new RegExp("<p><figure([\\w\\W]*?)</figure></p>","gi"),"<figure$1</figure>")},_cleanGDocs:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?bold|font-weight:\s?bold;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?600|font-weight:\s?600;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?700|font-weight:\s?700;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style:\s?italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight:\s?bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight:\s?700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight:\s?600[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")},_cleanMsWord:function(t){t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(t,e){return 0<e.length?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join("\xa0"):""});var e=this.utils.buildWrapper(t);e.find(".MsoFootnoteText").each(function(t){var e=$R.dom(t),i=e.parent();0!==i.length&&-1!==i.attr("style").search(/mso-element:footnote/)&&e.find("a").attr("id","_"+i.attr("id"))}),e.find(".MsoFootnoteReference").each(function(t){var e=$R.dom(t).parent();0!==e.length&&"A"===e.get().tagName&&e.attr("id",e.attr("name"))}),e.find("p").each(function(t){var e=$R.dom(t),i=e.attr("style"),n=/mso-list:\w+ \w+([0-9]+)/.exec(i);n&&e.attr("data-listLevel",parseInt(n[1],10))}),this._parseWordLists(e),e.find("[align]").removeAttr("align"),e.find("[name]").removeAttr("name"),e.find("span").each(function(t){var e=$R.dom(t),i=e.attr("style");/mso-list:Ignore/.exec(i)?e.remove():e.unwrap()}),e.find("[style]").removeAttr("style"),e.find("[class^='Mso']").removeAttr("class"),e.find("a").filter(function(t){return!t.hasAttribute("href")}).unwrap();for(var i="",n=(t=(t=(t=(t=(t=this.utils.getWrapperHtml(e)).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>\xb7/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,"/$1>\n<$2")).split(/\n/),s=0;s<n.length;s++){var r=""!==n[s]&&-1===n[s].search(/>$/)?" ":"\n";i+=n[s]+r}return i},_parseWordLists:function(t){var a=0,l=null,c=null,d=null;t.find("p").each(function(t){var e=$R.dom(t),i=e.attr("data-listLevel");if(null===i&&e.hasClass("MsoListParagraphCxSpMiddle")&&(i=1),null!==i){var n=e.text(),s=/^\s*\w+\./.test(n)?"<ol></ol>":"<ul></ul>";if(e.hasClass("MsoListParagraphCxSpFirst")||e.hasClass("MsoNormal")?(c=$R.dom(s),e.before(c)):a<i&&0!==a&&(d=$R.dom(s),l.append(d),c=d),i<a)for(var r=a-i+1,o=0;o<r;o++)c=c.parent();e.find("span").first().unwrap(),l=$R.dom("<li>"+e.html().trim()+"</li>"),null===c&&(e.before(s),c=e.prev()),c.append(l),e.remove(),a=i}else c=null,a=0})},_isSpacedEmpty:function(t){return-1!==t.search(this.reSpacedEmpty)},_isParagraphEmpty:function(t){return-1!==t.search(/^<p><\/p>$/i)},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_setSpanAttr:function(t){var e=this.utils.buildWrapper(t);return e.find("span").attr("data-redactor-span",!0),this.utils.getWrapperHtml(e)},_setStyleCache:function(t){var e=this.utils.buildWrapper(t);return e.find("[style]").each(function(t){var e=$R.dom(t);e.attr("data-redactor-style-cache",e.attr("style"))}),this.utils.getWrapperHtml(e)},_setPreClass:function(t){var e=this.utils.buildWrapper(t);return e.find("pre").addClass(this.opts.preClass),this.utils.getWrapperHtml(e)},_setLinkNofollow:function(t){var e=this.utils.buildWrapper(t);return e.find("a").attr("rel","nofollow"),this.utils.getWrapperHtml(e)},_replaceScriptTag:function(t){return t.replace(this.reScriptTag,'<script class="redactor-script-tag" $1>$2</script>')},_unreplaceScriptTag:function(t){return t.replace(/<script class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/script>/gi,"<script$1>$2</script>")},_replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},_removeScriptTag:function(t){return t.replace(this.reScriptTag,"")},_storeMatched:function(t,e,i,n){if(this["stored"+i]=[],e)for(var s=0;s<e.length;s++)this["stored"+i][s]=e[s],t=t.replace(e[s],"####"+n+s+"####");return t},_restoreMatched:function(t,e,i){if(this["stored"+e])for(var n=0;n<this["stored"+e].length;n++)t=t.replace("####"+i+n+"####",this["stored"+e][n]);return t},_decodeMarkers:function(t){var e='<span id="selection-marker-$1" class="redactor-selection-marker">\u200b</span>';return t.replace(
/&lt;span\sid="selection-marker-(start|end)"\sclass="redactor-selection-marker"&gt;(.*?[^>]?)&lt;\/span&gt;/g,e)},_encodeOuter:function(t){return this.encodeEntities(t.outerHTML)},_encodePreCodeLine:function(t){var e=t.firstChild;if("PRE"!=t.tagName||!e||"CODE"!==e.tagName){var i=this.decodeEntities(t.innerHTML);i=i.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),i=this.opts.preSpaces?i.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" ")):i,t.textContent=i}}}),$R.add("class","cleaner.figure",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.detector=t.detector},convert:function(t,e){var i=this.utils.buildWrapper(t);return i.find("img").each(this._convertImage.bind(this)),i.find("hr").each(this._convertLine.bind(this)),i.find("iframe").each(this._convertIframe.bind(this)),i.find("table").each(this._convertTable.bind(this)),i.find("form").each(this._convertForm.bind(this)),i.find("figure pre").each(this._convertCode.bind(this)),i.find("[data-redactor-type=variable]").addClass("redactor-component"),i.find("figure").not(".redactor-component, .redactor-figure-code").each(this._convertWidget.bind(this)),i.find("figure pre").each(this._setContenteditableCode.bind(this)),i.find(".redactor-component, .non-editable").attr("contenteditable",!1),this.detector.isIe()&&i.find("[data-redactor-type=table]").removeAttr("contenteditable"),i.find("figcaption, td, th").attr("contenteditable",!0),i.find(".redactor-component, figcaption").attr("tabindex","-1"),this._acceptExtraRules(i,e),this.utils.getWrapperHtml(i)},unconvert:function(t,e){t=(t=t.replace(/<\/([^>]+)><div data-redactor-tag/g,"</$1>\n<div data-redactor-tag")).replace(/<\/([^>]+)><p/g,"</$1>\n<p");var i=this.utils.buildWrapper(t);return i.find("th, td, figcaption, figure, pre, code, .redactor-component").removeAttr("contenteditable tabindex"),i.find("figure").removeClass("redactor-component redactor-component-active redactor-uploaded-figure"),i.find("[data-redactor-type=variable]").removeClass("redactor-component redactor-component-active"),i.find("figure[data-redactor-type=line]").unwrap(),i.find("figure[data-redactor-type=widget]").each(this._unconvertWidget.bind(this)),i.find("figure[data-redactor-type=form]").each(this._unconvertForm.bind(this)),i.find("figure[data-redactor-type=table]").each(this._unconvertTable.bind(this)),i.find("figure[data-redactor-type=image]").removeAttr("rel").each(this._unconvertImages.bind(this)),i.find("img").removeAttr("data-redactor-type").removeClass("redactor-component"),i.find(".non-editable").removeAttr("contenteditable"),i.find("figure").each(this._removeTypes.bind(this)),i.find("span.redactor-component-caret").remove(),i=this._unconvertBreakTag(i),this._acceptExtraRules(i,e),t=(t=(t=this.utils.getWrapperHtml(i)).replace(/<br\s?\/?>$/,"")).replace(/<br\s?\/?><\/(td|th)>/,"</$1>")},_convertImage:function(t){var e=$R.dom(t);if(!this._isNonEditable(e)){this.opts.imageObserve&&!e.attr("data-image")&&e.attr("data-image",this.utils.getRandomId());var i=e.closest("a"),n=e.closest("figure");if(0===n.children().not("a, img, br, figcaption").length){if(0===n.length){var s=0!==i.length?i.closest("p"):e.closest("p");if(!1===this.opts.imageFigure&&0!==s.length)(n=this.utils.replaceToTag(s,"figure")).addClass("redactor-replace-figure");else 0!==s.length&&s.unwrap(),n=0!==i.length?i.wrap("<figure>"):e.wrap("<figure>")}else n.hasClass("redactor-uploaded-figure")?n.removeClass("redactor-uploaded-figure"):n.addClass("redactor-keep-figure");this._setFigure(n,"image")}}},_convertTable:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"table")}},_convertLine:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"line")}},_convertForm:function(t){if(!this._isNonEditable(t)){var e=this.utils.replaceToTag(t,"figure");this._setFigure(e,"form")}},_convertIframe:function(t){if(!this._isNonEditable(t)&&0===$R.dom(t).closest(".redactor-component").length){var e=t.getAttribute("src"),i=e&&(e.match(this.opts.regex.youtube)||e.match(this.opts.regex.vimeo)),n=this._wrapFigure(t);i&&this._setFigure(n,"video")}},_convertCode:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"code")}},_convertWidget:function(t){if(!this._isNonEditable(t)){var e=$R.dom(t);e.addClass("redactor-component"),e.attr("data-redactor-type","widget"),e.attr("data-widget-code",encodeURI(t.innerHTML.trim()))}},_unconvertBreakTag:function(t){return t.find("[data-redactor-tag]").each(function(t){var e=$R.dom(t);if(e.removeAttr("data-redactor-tag"),this.utils.isEmptyHtml(e.html()))e.unwrap();else if(t.lastChild&&"BR"===t.lastChild.tagName)e.unwrap();else{var i=e.nextElement();0!==i.length&&i.attr("data-redactor-tag")&&t.appendChild(document.createElement("br")),e.unwrap()}}.bind(this)),t},_unconvertForm:function(t){this.utils.replaceToTag(t,"form")},_unconvertTable:function(t){$R.dom(t).unwrap()},_unconvertWidget:function(t){var e=$R.dom(t);e.html(decodeURI(e.attr("data-widget-code"))),e.removeAttr("data-widget-code")},_unconvertImages:function(t){var e=$R.dom(t);e.removeClass("redactor-component");var i=0!==e.closest("li").length,n=0!==e.closest("table").length,s=0!==e.find("figcaption").length,r=e.attr("style"),o=!(null===r||""===r),a=""!==e.attr("class");(i||n&&!s&&!o&&!a)&&e.unwrap()},_removeTypes:function(t){var e=$R.dom(t),i=e.attr("data-redactor-type");if(i&&-1!==["image","widget","line","video","code","form","table"].indexOf(i)&&e.removeAttr("data-redactor-type"),e.hasClass("redactor-keep-figure"))e.removeClass("redactor-keep-figure");else if("image"===i&&!1===this.opts.imageFigure){0!==e.find("figcaption").length||(e.hasClass("redactor-replace-figure")?(e.removeClass("redactor-replace-figure"),this.utils.replaceToTag(e,"p")):e.unwrap())}e.removeClass("redactor-replace-figure")},_wrapFigure:function(t){var e=$R.dom(t),i=e.closest("figure");return 0===i.length?e.wrap("<figure>"):i},_setFigure:function(t,e){t.addClass("redactor-component"),t.attr("data-redactor-type",e)},_setContenteditableCode:function(t){if(!this._isNonEditable(t)){var e=$R.dom(t),i=e.children("code").first();(0!==i.length?i:e).attr("contenteditable",!0).attr("tabindex","-1")}},_acceptExtraRules:function(t,e){for(var i in e)"function"==typeof e[i]&&e[i](t)},_isNonEditable:function(t){return 0!==$R.dom(t).closest(".non-editable").length}}),$R.add("class","cleaner.paragraphize",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.element=t.element,this.stored=[],this.storedComments=[],this.remStart="#####replace",this.remEnd="#####",this.paragraphizeTags=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"]},convert:function(t){var e=this._isConverted(t);return e=!0===e?this._convert(t):e,e=this._convertTable(e)},_convert:function(t,e){var i=this.opts.breakline||e?"sdivtag":this.opts.markup,n=e?"tbr":"br";t=this._storeTags(t),t=(t=this._storeComments(t)).trim(),t=(t=(t=(t=(t=this._trimLinks(t)).replace(/xparagraphmarkerz(?:\r\n|\r|\n)$/g,"")).replace(/xparagraphmarkerz$/g,"")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)/g,"\n")).replace(/xparagraphmarkerz/g,"\n");for(var s="",r=(t=this.opts.breakline?(t=t.replace(/<br\s?\/?>(?:\r\n|\r|\n)/gi,"xbreakmarkerz\n")).replace(/<br\s?\/?>/gi,"xbreakmarkerz\n"):t.replace(/[\n]+/g,"\n")).split("\n"),o=0;o<r.length;o++)s+="<"+i+">"+r[o]+"</"+i+">\n";return t=(t=(t=(t=s.replace(/\n$/,"")).replace(new RegExp("<"+i+">\\s+#####","gi"),"#####")).replace(new RegExp("<"+i+">#####","gi"),"#####")).replace(new RegExp("#####</"+i+">","gi"),"#####"),t=this.opts.breakline?t.replace(/xbreakmarkerz/gi,"<br>"):t,t=this._restoreTags(t),t=this._restoreComments(t),t=(t=(t=(t=this.opts.breakline?t.replace(new RegExp("<"+i+"></"+i+">","gi"),"<"+i+"><br></"+i+">"):(t=t.replace(new RegExp("<"+i+"><br\\s?/?></"+i+">","gi"),"")).replace(new RegExp("<"+i+"></"+i+">","gi"),"")).replace(new RegExp("<sdivtag>","gi"),'<div data-redactor-tag="'+n+'">')).replace(new RegExp("sdivtag","gi"),"div")).replace(/<\/([^>]+)><div data-redactor-tag/g,"</$1>\n<div data-redactor-tag")},_convertTable:function(t){var e=this.utils.buildWrapper(t);return e.find("td, th").each(this._convertCell.bind(this)),t=this.utils.getWrapperHtml(e)},_convertCell:function(t){var e=$R.dom(t);this.stored=[];var i=this._convert(e.html(),!0);e.html(i)},_storeTags:function(t){var n=this,e=this.utils.buildWrapper(t);return e.find(this.paragraphizeTags.join(", ")).each(function(t,e){var i=document.createTextNode(n.remStart+e+n.remEnd+"xparagraphmarkerz");n.stored.push(t.outerHTML),t.parentNode.replaceChild(i,t)}),this.utils.getWrapperHtml(e)},_storeComments:function(t){var e=t.match(new RegExp("<!--([\\w\\W]*?)-->","gi"));if(null!==e)for(var i=0;i<e.length;i++)t=t.replace(e[i],"#####xstarthtmlcommentzz"+i+"xendhtmlcommentzz#####"),this.storedComments.push(e[i]);return t},_restoreTags:function(t){for(var e=0;e<this.stored.length;e++)this.stored[e]=this.stored[e].replace(/\$/g,"&#36;"),t=t.replace(this.remStart+e+this.remEnd,this.stored[e]);return t},_restoreComments:function(t){for(var e=0;e<this.storedComments.length;e++)t=t.replace("#####xstarthtmlcommentzz"+e+"xendhtmlcommentzz#####",this.storedComments[e]);return t},_trimLinks:function(t){var e=this.utils.buildWrapper(t);return e.find("a").each(this._trimLink.bind(this)),t=this.utils.getWrapperHtml(e)},_trimLink:function(t){var e=$R.dom(t);e.html(e.html().trim())},_isConverted:function(t){return this._isDisabled(t)?t:!this._isEmptyHtml(t)||this.opts.emptyHtml},_isDisabled:function(){return!1===this.opts.paragraphize||this.element.isType("inline")},_isEmptyHtml:function(t){return""===t||"<p></p>"===t||"<div></div>"===t}}),$R.add("service","detector",{init:function(t){this.app=t,this.userAgent=navigator.userAgent.toLowerCase()},isWebkit:function(){return/webkit/.test(this.userAgent)},isFirefox:function(){return-1<this.userAgent.indexOf("firefox")},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((e=RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent))||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e);var e},isMobile:function(){return/(iPhone|iPod|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}),$R.add("service","offset",{init:function(t){this.app=t},get:function(t,e){var i={start:0,end:0},n=this.utils.getNode(t);if(!n)return!1;var s=this.editor.isEditor(n),r=!!s||this.selection.isIn(n),o=this.selection.getRange();if(s||r){if(this.selection.is()&&r){var a=$R.dom(o.startContainer).hasClass("redactor-component")?o.startOffset:0,l=o.cloneRange();l.selectNodeContents(n),l.setEnd(o.startContainer,o.startOffset);var c=this._getString(o,e);i.start=this._getString(l,e).length-a,i.end=i.start+c.length+a}}else i=!1;return i},set:function(t,e){if(!this._setComponentOffset(e)){this.component.clearActive();var i=this.utils.getNode(e);if(i){var n=this.size(i),s=0,r=document.createRange();t.end=t.end>n?n:t.end,r.setStart(i,0),r.collapse(!0);for(var o=[i],a=!1,l=!1;!l&&(i=o.pop());)if(3==i.nodeType){var c=s+i.length;!a&&!this._isFigcaptionNext(i)&&t.start>=s&&t.start<=c&&(r.setStart(i,t.start-s),a=!0),a&&t.end>=s&&t.end<=c&&(r.setEnd(i,t.end-s),l=!0),s=c}else for(var d=i.childNodes.length;d--;)o.push(i.childNodes[d]);this.selection.setRange(r)}}},size:function(t,e){var i=this.utils.getNode(t);if(i){var n=document.createRange().cloneRange();return n.selectNodeContents(i),this._getString(n,e).length}return 0},_getString:function(t,e){var i=t.toString();return i=this.editor.isEmpty()?i.replace(/\uFEFF/g,""):i,i=e?i.trim():i},_setComponentOffset:function(t){return!!this.component.isNonEditable(t)&&this.component.setActive(t)},_isFigcaptionNext:function(t){var e=t.nextSibling;return""===t.nodeValue.trim()&&e&&"FIGCAPTION"===e.tagName}}),$R.add("service","inspector",{init:function(t){this.app=t},parse:function(t){return $R.create("inspector.parser",this.app,this,t)},isText:function(t){if("string"==typeof t&&!/^\s*<(\w+|!)[^>]*>/.test(t))return!0;var e=$R.dom(t).get();return e&&3===e.nodeType},isInlineTag:function(t,e){var i=this._extendTags(this.opts.inlineTags,e);return this._isTag(t)&&-1!==i.indexOf(t.toLowerCase())},isBlockTag:function(t,e){var i=this._extendTags(this.opts.blockTags,e);return this._isTag(t)&&-1!==i.indexOf(t.toLowerCase())},isTableCellTag:function(t){return-1!==["td","th"].indexOf(t.toLowerCase())},isHeadingTag:function(t){return-1!==["h1","h2","h3","h4","h5","h6"].indexOf(t.toLowerCase())},_isTag:function(t){return t!==undefined&&t},_extendTags:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t}}),$R.add("class","inspector.parser",{init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.editor=t.editor,this.selection=t.selection,this.inspector=e,this.el=i,this.$el=$R.dom(this.el,".redactor-in-"+this.uuid),this.node=this.$el.get(),this.node&&8===this.node.nodeType&&(this.node=!1),this.$component=this.$el.closest(".redactor-component",".redactor-in")},isEditor:function(){return this.node===this.editor.getElement().get()},isInEditor:function(){return 0!==this.$el.parents(".redactor-in-"+this.uuid).length},isComponent:function(){return 0!==this.$component.length},isComponentType:function(t){return this.getComponentType()===t},isComponentActive:function(){return this.isComponent()&&this.$component.hasClass("redactor-component-active")},isComponentEditable:function(){var t=["code","table"],e=this.getComponentType();return this.isComponent()&&-1!==t.indexOf(e)},isFigcaption:function(){return this.getFigcaption()},isPre:function(){return this.getPre()},isCode:function(){var t=this.$el.closest("code"),e=t.parent("pre");return 0!==t.length&&0===e.length},isList:function(){return this.getList()},isFirstListItem:function(){return this._getLastOrFirstListItem("first")},isLastListItem:function(){return this._getLastOrFirstListItem("last")},isFirstTableCell:function(){return this._getLastOrFirstTableCell("first")},isLastTableCell:function(){return this._getLastOrFirstTableCell("last")},isTable:function(){return this.isComponentType("table")||this.getTable()},isHeading:function(){return this.getHeading()},isBlockquote:function(){return this.getBlockquote()},isDl:function(){return this.getDl()},isParagraph:function(){return this.getParagraph()},isLink:function(){return this.getLink()},isFile:function(){return this.getFile()},isText:function(){return this.inspector.isText(this.el)},isInline:function(){var t=this.opts.inlineTags;return!!this.isElement()&&-1!==t.indexOf(this.node.tagName.toLowerCase())},isBlock:function(){var t=this.opts.blockTags;return!!this.isElement()&&-1!==t.indexOf(this.node.tagName.toLowerCase())},isElement:function(){return this.node&&this.node.nodeType&&3!==this.node.nodeType},hasParent:function(t){return 0!==this.$el.closest(t.join(",")).length},getNode:function(){return this.node},getTag:function(){return!!this.isElement()&&this.node.tagName.toLowerCase()},getComponent:function(){return!!this.isComponent()&&this.$component.get()},getComponentType:function(){return!!this.isComponent()&&this.$component.attr("data-redactor-type")},getFirstNode:function(){return this.utils.getFirstNode(this.node)},getLastNode:function(){return this.utils.getLastNode(this.node)},getFirstElement:function(){return this.utils.getFirstElement(this.node)},getLastElement:function(){return this.utils.getLastElement(this.node)},getFigcaption:function(){return this._getClosestNode("figcaption")},getPre:function(){return this._getClosestNode("pre")},getCode:function(){return this._getClosestNode("code")},getList:function(){return this._getClosestNode("ul, ol")},getParentList:function(){return this._getClosestUpNode("ul, ol")},getListItem:function(){return this._getClosestNode("li")},getTable:function(){return this.getComponentType("table")?this.$component.find("table").get():this._getClosestNode("table")},getTableCell:function(){var t=this.$el.closest("td, th");return 0!==t.length&&t.get()},getComponentCodeElement:function(){return!!this.isComponentType("code")&&this.$component.find("pre code, pre").last().get()},getImageElement:function(){return!!this.isComponentType("image")&&this.$component.find("img").get()},getParagraph:function(){return this._getClosestNode("p")},getHeading:function(){return this._getClosestNode("h1, h2, h3, h4, h5, h6")},getDl:function(){return this._getClosestNode("dl")},getBlockquote:function(){return this._getClosestNode("blockquote")},getLink:function(){var t=this.isComponent()&&!this.isFigcaption();if(!this.isComponentType("table")&&t)return!1;var e=this._getClosestElement("a");return!(!e||e.attr("data-file"))&&e.get()},getFile:function(){var t=this.isComponent();if(!this.isComponentType("table")&&t)return!1;var e=this._getClosestElement("a");return!(!e||!e.attr("data-file"))&&e.get()},findFirstNode:function(t){return this.$el.find(t).first().get()},findLastNode:function(t){return this.$el.find(t).last().get()},_getLastOrFirstListItem:function(t){var e=this.getList(),i=this.getTag();if(e&&"li"===i){var n=$R.dom(e).find("li")[t]().get();if(n&&this.node===n)return!0}return!1},_getLastOrFirstTableCell:function(t){var e=this.getTable(),i=this.getTag();if(e&&("td"===i||"th"===i)){var n=$R.dom(e).find("td, th")[t]().get();if(n&&this.node===n)return!0}return!1},_getClosestUpNode:function(t){var e=this.$el.parents(t,".redactor-in-"+this.uuid).last();return 0!==e.length&&e.get()},_getClosestNode:function(t){var e=this.$el.closest(t,".redactor-in-"+this.uuid);return 0!==e.length&&e.get()},_getClosestElement:function(t){var e=this.$el.closest(t,".redactor-in-"+this.uuid);return 0!==e.length&&e}}),$R.add("service","marker",{init:function(t){this.app=t},build:function(t,e){var i=document.createElement("span");return i.id="selection-marker-"+this._getPos(t),i.className="redactor-selection-marker",i.innerHTML=this.opts.markerChar,e?i.outerHTML:i},buildHtml:function(t){return this.build(t,!0)},insert:function(t){this.remove();var e="both"!==t&&("start"===t||this.selection.isCollapsed());this.selection.is()||this.editor.focus();var i=this.selection.getRange();if(i){var n=this.build("start"),s=this.build("end"),r=i.cloneRange();return e||(r.collapse(!1),r.insertNode(s)),r.setStart(i.startContainer,i.startOffset),r.collapse(!0),r.insertNode(n),i.setStartAfter(n),e||i.setEndBefore(s),this.selection.setRange(i),n}},find:function(t,e){var i=this.editor.getElement(),n=(e||i).find("span#selection-marker-"+this._getPos(t));return 0!==n.length&&n.get()},restore:function(){var t=this.find("start"),e=this.find("end"),i=this.selection.getRange();if(i&&this.selection.is()||(this.editor.focus(),i=document.createRange()),t){var n=!!e&&e.previousSibling,s=t.nextSibling;s=(!s||3!==s.nodeType||""!==s.textContent.replace(/[\n\t]/g,""))&&s,e?s&&"selection-marker-end"===s.id?this._restoreInject(i,t):n&&s?(i.selectNodeContents(n),i.collapse(!1),i.setStart(s,0)):n&&!s?(i.selectNodeContents(n),i.collapse(!1),i.setStartAfter(t)):(i.setStartAfter(t),i.setEndBefore(e)):s?(i.selectNodeContents(s),i.collapse(!0)):this._restoreInject(i,t),this.selection.setRange(i),t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)}},remove:function(){var t=this.find("start"),e=this.find("end");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)},_getPos:function(t){return t===undefined?"start":t},_restoreInject:function(t,e){var i=this.utils.createInvisibleChar();$R.dom(e).after(i),t.selectNodeContents(i),t.collapse(!1)}}),$R.add("service","component",{init:function(t){this.app=t,this.activeClass="redactor-component-active"},create:function(t,e){return $R.create(t+".component",this.app,e)},build:function(t){var e,i=$R.dom(t).attr("data-redactor-type");return i&&(e=this.create(i,t)),e||t},remove:function(t,e){var i=$R.dom(t).closest(".redactor-component"),n=i.attr("data-redactor-type"),s=i.parent(),r=this.inspector.parse(s),o=this.utils.findSiblings(i,"prev"),a=this.utils.findSiblings(i,"next");if(!1!==this.app.broadcast(n+".delete",i)){if(i.remove(),this.app.broadcast(n+".deleted",i),this.app.broadcast("contextbar.close"),this.app.broadcast("imageresizer.stop"),!1!==e){var l=r.getTableCell();l&&this.utils.isEmptyHtml(l.innerHTML)?this.caret.setStart(l):a?this.caret.setStart(a):o?this.caret.setEnd(o):this.editor.startFocus()}this.editor.isEmpty()&&(this.editor.setEmpty(),this.editor.startFocus(),this.app.broadcast("empty"))}},isNonEditable:function(t){var e=this.inspector.parse(t);return e.isComponent()&&!e.isComponentEditable()},isActive:function(t){if(t){var e=this.inspector.parse(t);return $R.dom(e.getComponent()).hasClass(this.activeClass)}return 0!==this._find().length},getActive:function(t){var e=this._find();return 0!==e.length&&(t?e:e.get())},setActive:function(t){this.clearActive(),this.editor.focus();var e=this.inspector.parse(t),i=e.getComponent(),n=$R.dom(i);if(!e.isFigcaption()){var s=n.find(".redactor-component-caret");0===s.length&&(s=this._buildCaret(),n.prepend(s)),this.caret.setAtStart(s.get())}n.addClass(this.activeClass)},clearActive:function(){var t=this._find();t.removeClass(this.activeClass),t.find(".redactor-component-caret").remove(),this.app.broadcast("imageresizer.stop")},setOnEvent:function(t,e){this.clearActive();var i=this.inspector.parse(t.target);i.isFigcaption()||i.isComponentEditable()||i.isComponent()&&(this.setActive(t.target),!0!==e&&t.preventDefault())},executeScripts:function(scripts){if(scripts===undefined){var $editor=this.editor.getElement(),scripts=$editor.find("[data-redactor-type]").find("script").getAll();this.executeScripts.call(this,scripts)}else for(var i=0;i<scripts.length;i++){if(""!==scripts[i].src){var src=scripts[i].src;this.$doc.find('head script[src="'+src+'"]').remove();var $script=$R.dom("<script>");$script.attr("src",src),$script.attr("async defer"),$script.get().onload=function(){-1!==src.search("instagram")&&window.instgrm.Embeds.process(),this.executeScripts(scripts.slice(i+1))}.bind(this);var head=document.getElementsByTagName("head")[0];head&&head.appendChild($script.get());break}try{eval(scripts[i].innerHTML)}catch(e){}}},_find:function(){return this.editor.getElement().find("."+this.activeClass)},_buildCaret:function(){var t=$R.dom("<span>");return t.addClass("redactor-component-caret"),t.attr("contenteditable",!0),t}}),$R.add("service","insertion",{init:function(t){this.app=t},set:function(t,e,i){return null===t&&(t=""),t=!1!==e?this.cleaner.input(t):t,t=!1!==e?this.cleaner.paragraphize(t):t,this.editor.getElement().html(t),!1!==i&&this.editor.endFocus(),t},insertNode:function(t,e){this.editor.focus();var i=this.utils.isFragment(t)?t:this.utils.createFragment(t);return this._collapseSelection(),this._insertFragment(i),this._setCaret(e,i),this._sendNodes(i.nodes)},insertBreakLine:function(){return this.insertNode(document.createElement("br"),"after")},insertNewline:function(){return this.insertNode(document.createTextNode("\n"),"after")},insertText:function(t){return this.insertHtml(this.cleaner.getFlatText(t))},insertChar:function(t){return this.insertNode(t,"after")},insertRaw:function(t){return this.insertHtml(t,!1)},insertToEnd:function(t,e){if(t){3===t.nodeType&&-1!==t.nodeValue.search(/^\n/)&&(t=t.previousElementSibling);var i=$R.dom(t);if(i.attr("data-redactor-type")===e){var n=this.opts.breakline?"<br>":"<p>",s=$R.dom(n);i.after(s),this.caret.setStart(s)}}},insertPoint:function(t){var e,i=this.marker.build("start"),n=!1,s=t.clientX,r=t.clientY;if(document.caretPositionFromPoint){var o=document.caretPositionFromPoint(s,r),a=document.getSelection();this.inspector.parse(o.offsetNode).isInEditor()&&((e=a.getRangeAt(0)).setStart(o.offsetNode,o.offset),e.collapse(!0),e.insertNode(i),n=!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(s,r),this.inspector.parse(e.startContainer).isInEditor()&&(e.insertNode(i),n=!0));return n},insertToPoint:function(t,e,i,n){if(!(!0===i||this.insertPoint(t))){var s=this.editor.getLastNode();$R.dom(s).after(this.marker.build("start"))}return this.component.clearActive(),this.selection.restoreMarkers(),this.insertHtml(e,n)},insertToOffset:function(t,e){return this.offset.set({start:t,end:t}),this.insertHtml(e)},insertHtml:function(t,e){if(this.opts.input){var i=this.utils.parseHtml(t);if(this.selection.isAll())return this._insertToAllSelected(i);if(!this.selection.is()){var n=$R.dom("<p>");this.editor.getElement().append(n),this.caret.setStart(n)}var s=this.selection.isCollapsed(),r=this.selection.isText(),o=this.selection.getCurrent(),a=this.selection.getBlock(),l=this.inspector.parse(o);this._collapseSelection(),i=this._getCleanedInput(i,l,e);var c,d,h=this._isFigure(i.html),u=this._isComponentSpan(i.html),p=this.inspector.isText(i.html);if(this.editor.isEmpty())return this._insertToEmptyEditor(i.html);if(l.isComponent()&&!l.isComponentEditable())return this._insertToWidget(o,l,i.html);if(u)return this.insertNode(i.nodes,"end");if(h&&!r&&!l.isList())return l.isInline()?this._insertToInline(o,i):(c=this.utils.createFragment(i.html),this.utils.splitNode(o,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes));if(l.isCode())return this._insertToCode(i,o,e);if(l.isPre())return this._insertToPre(i,e);if(l.isHeading()||l.isFigcaption())return i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,["a"]):i.html,i.html=!1!==e?this.cleaner.replaceNbspToSpaces(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(this.opts.breakline&&a&&"DIV"===a.tagName)return i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.utils.splitNode(o,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes);if(p)return!r&&"br"!==this.opts.markup&&this._hasBlocksAndImages(i.nodes)?(i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.utils.splitNode(o,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes)):(i.html=!1!==e?i.html.replace(/\n/g,"<br>"):i.html,c=this.utils.createFragment(i.html),this.insertNode(c.nodes,"end"));if(!s&&!h)return i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(l.isInline()&&!this._isPlainHtml(i.html))return this._insertToInline(o,i);if(l.isBlockquote()||l.isDl())return(d=this.opts.inlineTags).concat(["br"]),i.html=!1!==e?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,d):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(l.isParagraph())return this._isPlainHtml(i.html)?this.insertNode(i.nodes,"end"):(i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.utils.splitNode(o,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes));if(l.isList()&&(d=(d=this.opts.inlineTags).concat(["br","li","ul","ol","img"]),i.html=!1!==e?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,d):i.html,i.html=!1!==e?this.cleaner.removeBrAtEnd(i.html):i.html,c=this.utils.createFragment(i.html),i.nodes=c.nodes,this._containsTags(i.html,["ul","ol","li"]))){var f=this.selection.getElement(o);if(f&&"LI"===f.tagName&&this.caret.isStart(f)){i.nodes=$R.dom(c.nodes).unwrap("ul, ol").getAll(),$R.dom(f).before(i.nodes);var m=i.nodes[i.nodes.length-1];return this.caret.setEnd(m),this._sendNodes(i.nodes)}return this._isPlainHtml(i.html)?this.insertNode(c,"end"):(c=this._buildList(i,f,c),this.utils.splitNode(o,c,!0),this.caret.setEnd(c.last),this._sendNodes(c.nodes))}return this.insertNode(i.nodes,"end")}},_insertToAllSelected:function(t){var e=this.set(t.html),i=this.utils.parseHtml(e);return this._sendNodes(i.nodes)},_insertToEmptyEditor:function(t){t=this.cleaner.paragraphize(t);var e=this.utils.createFragment(t),i=this.editor.getElement();return i.html(""),i.append(e.frag),this.caret.setEnd(e.last),this._sendNodes(e.nodes)},_insertToInline:function(t,e){var i=this.utils.createFragment(e.html);return this.utils.splitNode(t,i,!1,!0),this.caret.setEnd(i.last),this._sendNodes(i.nodes)},_insertToCode:function(t,e,i){t.html=!1!==i?this.cleaner.encodeHtml(t.html):t.html,t.html=!1!==i?this.cleaner.removeNl(t.html):t.html;var n=this.utils.createFragment(t.html),s=this.insertNode(n,"end");return this.utils.normalizeTextNodes(e),s},_insertToPre:function(t,e){t.html=!1!==e?this.cleaner.encodeHtml(t.html):t.html;var i=this.utils.createFragment(t.html);return this.insertNode(i,"end")},_insertToWidget:function(t,e,i){i=this._isComponentSpan(i)?i:this.cleaner.paragraphize(i);var n=this.utils.createFragment(i),s=e.getComponent(),r=$R.dom(s);return r.after(n.frag),r.remove(),this.caret.setEnd(n.last),this._sendNodes(n.nodes)},_insertFragment:function(t){var e=this.selection.getRange();if(e){if(this.selection.isCollapsed()){var i=e.startContainer;3!==i.nodeType&&"BR"===i.tagName&&(this.caret.setAfter(i),i.parentNode.removeChild(i))}else e.deleteContents();e.insertNode(t.frag)}},_sendNodes:function(t){for(var e=0;e<t.length;e++){var i=t[e],n=3!==i.nodeType&&"function"==typeof i.getAttribute&&i.getAttribute("data-redactor-type");n&&this.app.broadcast(n+".inserted",this.component.build(i))}return this.detector.isIe()&&this.editor.getElement().find("[data-redactor-type=table]").attr("contenteditable",!0),this.app.broadcast("inserted",t),this.component.executeScripts(),t},_setCaret:function(t,e){var i=this._isLastInline(e);t?(t=i&&"end"===t?"after":t,this.caret["set"+this.utils.ucfirst(t)](e.last)):!1!==t&&i&&this.caret.setAfter(e.last)},_isLastInline:function(t){return!!t.last&&this.inspector.parse(t.last).isInline()},_getCleanedInput:function(t,e,i){var n=e.isCode()||e.isPre();return t.html=t.html.replace(/&nbsp;/g," "),t.html=n||!1===i?t.html:this.cleaner.input(t.html),t=n||!1===i?t:this.utils.parseHtml(t.html)},_getContainer:function(t){return $R.dom(this.utils.createTmpContainer(t))},_buildList:function(t,e,i){var n=t.nodes[0];if(n&&3!==n.nodeType&&"li"===n.tagName){var s=$R.dom(e).get().tagName.toLowerCase(),r=$R.dom("<"+s+" />");return r.append(i.nodes),this.utils.createFragment(r.get().outerHTML)}return i},_containsTags:function(t,e){return 0!==this._getContainer(t).find(e.join(",")).length},_collapseSelection:function(){},_hasFigureOrTable:function(t){return 0!==this._getContainer(t).find("figure, table").length},_hasBlocks:function(t){return 0!==this._getContainer(t).find(this.opts.blockTags.join(",")).length},_hasBlocksAndImages:function(t){return 0!==this._getContainer(t).find(this.opts.blockTags.join(",")+",img").length},_isPlainHtml:function(t){return 0===this._getContainer(t).find(this.opts.blockTags.join(",")+", img").length},_isFigure:function(t){if(this._isHtmlString(t))return 0!==$R.dom(t).closest("figure").length},_isComponentSpan:function(t){if(this._isHtmlString(t))return 0!==$R.dom(t).closest("span.redactor-component").length},_isHtmlString:function(t){return!("string"==typeof t&&!/^\s*<(\w+|!)[^>]*>/.test(t))}}),$R.add("service","block",{init:function(t){this.app=t,this.tags=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6"]},format:function(t){return this.params={args:!1},this.params.type=t.type?t.type:"set",this.params.tag="string"==typeof t?t:t.tag||this.opts.markup,this.params.tag=this.params.tag.toLowerCase(),this.params.args={"class":t["class"]||!1,style:t.style||!1,attr:t.attr||!1},t["class"]||t.style||t.attr||(this.params.args=!1),this._format()},add:function(t,e){return this._apply("add",t,e)},set:function(t,e){return this._apply("set",t,e)},toggle:function(t,e){return this._apply("toggle",t,e)},remove:function(t,e){return this._apply("remove",t,e)},clearFormat:function(t){return this._clear(t,"all")},clearStyle:function(t){return this._clear(t,"style")},clearClass:function(){return this._clear(tags,"class")},clearAttr:function(){return this._clear(tags,"attr")},_format:function(){var t=[];this.collapsed=this.selection.isCollapsed(),this.selection.save();this.selection.getBlock();var e=this._getBlocks(),i=this._isToggleFormatType(e)?"toggle":"set",n=this._getReplacedTag(i);return t=this._replaceBlocks(e,n),t=this._buildNodes(t),this._restoreSelection(t),t},_clear:function(t,e,i,n){!1!==i&&this.selection.save();var s=this._getElements(t,n);return"all"===e?this._removeAllAttr(s,!1):"style"===e?(s.removeAttr("style"),s.removeAttr("data-redactor-style-cache")):"class"===e?s.removeAttr("class"):"attr"===e&&this._removeAllAttr(s),n=s.getAll(),!1!==i&&this._restoreSelection(n)
,n},_getElements:function(t,e){return e?$R.dom(e):$R.dom(this._getBlocks(t))},_getBlocks:function(t){for(var e=this.selection.getBlocks({tags:t||this.tags}),i=[],n=0;n<e.length;n++)("DIV"!==e[n].tagName||e[n].getAttribute("data-redactor-tag"))&&i.push(e[n]);return i},_getReplacedTag:function(t){return this.opts.breakline?"toggle"===t?"div":"p"===this.params.tag?"div":this.params.tag:"toggle"===t?this.opts.markup:this.params.tag},_isStandardParagraph:function(){return!this.opts.breakline&&"p"===this.opts.markup},_isStandardDiv:function(){return!this.opts.breakline&&"div"===this.opts.markup},_isBreaklineBlock:function(t){return t&&"DIV"===t.tagName&&"br"===t.getAttribute("data-redactor-tag")},_isToggleFormatType:function(t){for(var e=0,i=t.length,n=0;n<i;n++)t[n]&&this.params.tag===t[n].tagName.toLowerCase()&&e++;return e===i},_isCurrentBlockOneAndEmpty:function(t){return this.collapsed&&1===t.length&&this.utils.isEmpty(t[0])},_buildNodes:function(t){return 0<t.length&&(t=this._applyArgs(t,!1),t=this._combinePre(t),t=this._cleanBlocks(t)),t},_replaceBlocks:function(t,e){for(var i=[],n=0;n<t.length;n++){var s=this.utils.replaceToTag(t[n],e);i.push(s.get())}return i},_combinePre:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i].nextElementSibling;if(n&&"PRE"===t[i].tagName&&"PRE"===n.tagName){var s=$R.dom(t[i]),r=$R.dom(n),o=document.createTextNode("\n");s.append(o),s.append(r),r.unwrap("pre")}e.push(t[i])}return e},_cleanBlocks:function(t){for(var e=["h1","h2","h3","h4","h5","h6"],i=this.opts.inlineTags,n=0;n<t.length;n++){var s=t[n].tagName.toLowerCase(),r=$R.dom(t[n]);-1!==e.indexOf(s)?r.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker").unwrap():"pre"===s&&r.find(i.join(",")).not(".redactor-selection-marker").unwrap(),this.opts.breakline&&"div"===s?r.attr("data-redactor-tag","br"):r.removeAttr("data-redactor-tag"),this.utils.normalizeTextNodes(t[n])}return t},_cleanEmptyClass:function(t){t.each(function(t){""===t.className&&t.removeAttribute("class")})},_cleanEmptyStyle:function(t){this.utils.removeEmptyAttr(t.get(),"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style"))},_apply:function(t,e,i,n,s){!1!==n&&this.selection.save();var r=this._getElements(i,s);if(e["class"]&&("set"===t?(r.removeAttr("class"),r.addClass(e["class"])):"add"===t?r.addClass(e["class"]):"toggle"===t?r.toggleClass(e["class"]):"remove"===t&&r.removeClass(e["class"]),this._cleanEmptyClass(r)),e.attr&&("set"===t?(this._removeAllAttr(r),r.attr(e.attr)):"add"===t?r.attr(e.attr):"toggle"===t?(o=e.attr,r.each(function(t){var e=$R.dom(t);for(var i in o)e.attr(i)?e.removeAttr(i):e.attr(i,o[i])})):"remove"===t&&r.removeAttr(e.attr)),e.style)if("set"===t)r.removeAttr("style"),r.css(e.style),r.each(function(t){var e=$R.dom(t);e.attr("data-redactor-style-cache",e.attr("style"))});else if("add"===t){var o=e.style;r.each(function(t){var e=$R.dom(t);e.css(o),e.attr("data-redactor-style-cache",e.attr("style")),this._convertStyleQuotes(e)}.bind(this))}else if("toggle"===t){o=e.style;r.each(function(t){var e=$R.dom(t);for(var i in o){var n=o[i],s=e.css(i);s=this.utils.isRgb(s)?this.utils.rgb2hex(s):s.replace(/"/g,""),n=this.utils.isRgb(n)?this.utils.rgb2hex(n):n.replace(/"/g,""),s=this.utils.hex2long(s),("string"==typeof(n=this.utils.hex2long(n))?n.toLowerCase():n)===("string"==typeof s?s.toLowerCase():s)?e.css(i,""):e.css(i,n)}this._convertStyleQuotes(e),this._cleanEmptyStyle(e)}.bind(this))}else if("remove"===t){var a=e.style;r.each(function(t){var e=$R.dom(t);e.css(a,""),this._cleanEmptyStyle(e)}.bind(this))}return s=r.getAll(),!1!==n&&this._restoreSelection(s),s},_applyArgs:function(t){return t=this.params.args?this._apply(this.params.type,this.params.args,!1,!1,t):this._clear(!1,"all",!1,t)},_removeAllAttr:function(t,r){t.each(function(t){var e=["data-redactor-tag","data-redactor-style-cache"];!1===r&&(e.push("style"),e.push("class"));for(var i=t.attributes.length;0<i--;){var n=t.attributes[i],s=n.name;-1===e.indexOf(s)&&t.removeAttributeNode(n)}})},_restoreSelection:function(t){this._isCurrentBlockOneAndEmpty(t)?this.caret.setStart(t[0]):setTimeout(function(){this.selection.restore()}.bind(this),1)},_convertStyleQuotes:function(t){var e=t.attr("style");e&&t.attr("style",e.replace(/"/g,"'"))}}),$R.add("service","inline",{mixins:["formatter"],init:function(t){this.app=t,this.count=0},format:function(t){if(!this._isFormat())return[];this.type=t.type?t.type:"set",this.tag="string"==typeof t?t:t.tag,this.tag=this.tag.toLowerCase(),this.tag=this.arrangeTag(this.tag),"string"==typeof t?this.args=!1:this.buildArgs(t),this.detector.isIe()||this.editor.disableNonEditables();var e=this.selection.isCollapsed()?this.formatCollapsed():this.formatUncollapsed();return this.detector.isIe()||this.editor.enableNonEditables(),e},_isFormat:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=e.isComponent()&&!e.isComponentType("table")&&!e.isFigcaption();return!(!1!==t||!this.selection.isAll())||!(!t||e.isPre()||e.isCode()||i)},arrangeTag:function(t){var e=this.opts.replaceTags;for(var i in e)t===i&&(t=e[i]);return t},formatCollapsed:function(){var t,e,i,n,s=[],r=this.selection.getInlineFirst(),o=this.selection.getInlines({all:!0}),a=$R.dom(r);if(r){var l=this.inspector.parse(r);if(this.utils.isEmptyHtml(r.innerHTML))if(r.tagName.toLowerCase()===this.tag)if(this.hasSameArgs(r)){this.caret.setAfter(r),a.remove();var c=this.selection.getElement();this.utils.normalizeTextNodes(c)}else"span"===this.tag?(s=this.applyArgs([r],!1),this.caret.setStart(r)):s=this.insertInline(s);else l.hasParent([this.tag])?(e=(t=a.closest(this.tag)).get(),this.hasSameArgs(e)?(t.unwrap(),this.caret.setStart(r)):s=this.insertInline(s)):s=this.insertInline(s);else if(r.tagName.toLowerCase()===this.tag)this.hasSameArgs(r)?(n=this.utils.extractHtmlFromCaret(r),i=$R.dom("<"+this.tag+" />"),i=this.utils.cloneAttributes(r,i),a.after(i.append(n)),""===i.html().trim()&&i.remove(),this.caret.setAfter(r)):s=this.insertInline(s);else if(l.hasParent([this.tag]))if(e=(t=a.closest(this.tag)).get(),this.hasSameArgs(e)){var d,h;n=this.utils.extractHtmlFromCaret(e,e),i=$R.dom("<"+this.tag+" />"),i=this.utils.cloneAttributes(e,i);var u=0;o=o.reverse();for(var p=0;p<o.length;p++)o[p]!==e&&(h=$R.dom("<"+o[p].tagName.toLowerCase()+">"),0===u?d=h:d.append(h),u++);t.after(i.append(n)),t.after(d),this.caret.setStart(h)}else s=this.insertInline(s);else s=this.insertInline(s)}else s=this.insertInline(s);return s},insertInline:function(t){var e=document.createElement(this.tag);return t=this.insertion.insertNode(e,"start"),this.applyArgs(t,!1)},hasSameArgs:function(t){if(0===t.attributes.length&&!1===this.args)return!0;var e=!0;if(this.args){var i=0;for(var n in this.args){var s=$R.dom(t),r=this.args[n],o=this.utils.toParams(r),a=s.attr(n);if(r)if("style"===n){o=o.trim().replace(/;$/,"");for(var l=this.utils.styleToObj(s.attr("style")),c=o.split(";"),d=0,h=0;h<c.length;h++){var u=c[h].split(":"),p=u[0].trim(),f=u[1].trim();if(-1!==p.search(/color/)){var m=s.css(p);!m||m!==f&&this.utils.rgb2hex(m)!==f||d++}else s.css(p)===f&&d++}d===c.length&&Object.keys(l).length===c.length&&i++}else a===o&&i++;else a&&""!==a||i++}e=i===Object.keys(this.args).length}return e},formatUncollapsed:function(){var t=this.selection.getInlines({all:!0,inside:!0});this.detector.isIe()?this.selection.saveMarkers():this.selection.save(),this._convertTags("u"),this._convertTags("del"),this._convertToStrike(t),this.detector.isIe()?this.selection.restoreMarkers():this.selection.restore(),document.execCommand("strikethrough"),this._clearDecoration(),this.selection.save();var e=this._revertToInlines();e=this.applyArgs(e,!1);for(var i=0;i<e.length;i++){var n=e[i],s=n.tagName.toLowerCase(),r=n.attributes.length;s===this.tag&&0===r&&this.args&&($R.dom(n).unwrap(),e.splice(i,1))}return this.selection.restore(),this._clearEmptyStyle(),e=this._normalizeBlocks(e)},_convertTags:function(e){this.tag!==e&&this.editor.getElement().find(e).each(function(t){this.utils.replaceToTag(t,"span").addClass("redactor-convertable-"+e)}.bind(this))},_revertTags:function(i){this.editor.getElement().find("span.redactor-convertable-"+i).each(function(t){var e=this.utils.replaceToTag(t,i);e.removeClass("redactor-convertable-"+i),this.utils.removeEmptyAttr(e,"class")&&e.removeAttr("class")}.bind(this))},_convertToStrike:function(t){for(var e=this.selection.getText().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=0;i<t.length;i++){var n=this.arrangeTag(t[i].tagName.toLowerCase()),s=t[i],r=$R.dom(s),o=this.hasSameArgs(s);n===this.tag&&("span"===this.tag&&this._isTextSelected(s,e)?r.addClass("redactor-convertable-apply"):o&&"a"!==this.tag?this._replaceToStrike(r):"span"===this.tag?r.addClass("redactor-unconvertable-apply"):o||r.addClass("redactor-convertable-apply"))}},_replaceToStrike:function(t){t.replaceWith(function(){return $R.dom("<strike>").append(t.contents())})},_revertToInlines:function(){var i=[],t=this.editor.getElement();return"u"!==this.tag&&t.find("u").unwrap(),t.find(".redactor-convertable-u").each(function(t){i.push(t)}.bind(this)),t.find(".redactor-convertable-apply").each(function(t){var e=$R.dom(t);e.find("strike").unwrap(),this._forceRemoveClass(e,"redactor-convertable-apply"),i.push(t)}.bind(this)),t.find("span.redactor-unconvertable-apply").each(function(t){var e=$R.dom(t);this._forceRemoveClass(e,"redactor-unconvertable-apply")}.bind(this)),t.find("strike").each(function(t){var e=this.utils.replaceToTag(t,this.tag);i.push(e.get())}.bind(this)),this._revertTags("u"),this._revertTags("del"),i},_normalizeBlocks:function(e){var t=this.opts.inlineTags,i=this.selection.getBlocks();if(i)for(var n=0;n<i.length;n++){if("PRE"===i[n].tagName)$R.dom(i[n]).find(t.join(",")).not(".redactor-selection-marker").each(function(t){-1!==e.indexOf(t)&&(e=this.utils.removeFromArrayByValue(e,t)),$R.dom(t).unwrap()}.bind(this))}return e},_clearDecoration:function(){this.editor.getElement().find(this.opts.inlineTags.join(",")).each(function(t){if("line-through"===t.style.textDecoration||"line-through"===t.style.textDecorationLine){var e=$R.dom(t);e.css("textDecorationLine",""),e.css("textDecoration",""),e.wrap("<strike>")}})},_clearEmptyStyle:function(){for(var t=this.getInlines(),e=0;e<t.length;e++){this._clearEmptyStyleAttr(t[e]);var i=t[e].childNodes;if(i)for(var n=0;n<i.length;n++)this._clearEmptyStyleAttr(i[n])}},_clearEmptyStyleAttr:function(t){3!==t.nodeType&&this.utils.removeEmptyAttr(t,"style")&&(t.removeAttribute("style"),t.removeAttribute("data-redactor-style-cache"))},_forceRemoveClass:function(t,e){t.removeClass(e),this.utils.removeEmptyAttr(t,"class")&&t.removeAttr("class")},_isTextSelected:function(t,e){var i=this.utils.removeInvisibleChars(t.textContent);return e===i||-1!==e.search(new RegExp("^"+this.utils.escapeRegExp(i)+"$"))},getInlines:function(t){return t?this.selection.getInlines({tags:t,all:!0}):this.selection.getInlines({all:!0})},getElements:function(t){return $R.dom(this.getInlines(t))},clearFormat:function(){this.selection.save();for(var t=this.selection.getInlines({all:!0}),e=0;e<t.length;e++){var i=$R.dom(t[e]);this.selection.getInline(t[e])&&i.unwrap()}this.selection.restore()}}),$R.add("service","autoparser",{init:function(t){this.app=t},observe:function(){var t=this.editor.getElement().find(".redactor-autoparser-object").each(function(t){var e=$R.dom(t);e.removeClass("redactor-autoparser-object"),""===e.attr("class")&&e.removeAttr("class")});0<t.length&&t.each(function(t){var e,i=!1,n=t.tagName;"A"===n?e="link":"IMG"===n?e="image":"IFRAME"===n&&(e="video"),e&&(i=$R.create(e+".component",this.app,t),this.app.broadcast(e+".inserted",i),this.app.broadcast("autoparse",e,i))}.bind(this))},format:function(t,e){this._isKey(e)&&this._format(e===this.keycodes.ENTER)},parse:function(t){var e=["figure","form","pre","iframe","code","a","img"],i=[],n=0;t=this.cleaner.encodePreCode(t);for(var s=0;s<e.length;s++){var r="img"===e[s]?"<"+e[s]+"[^>]*>":"<"+e[s]+"([\\w\\W]*?)</"+e[s]+">";if(null!==(p=t.match(new RegExp(r,"gi"))))for(var o=0;o<p.length;o++)t=t.replace(p[o],"#####replaceparse"+n+"#####"),i.push(p[o]),n++}if(this.opts.autoparseImages&&t.match(this.opts.regex.imageurl)){var a=t.match(this.opts.regex.imageurl);for(s=0;s<a.length;s++)t=t.replace(a[s],'<img class="redactor-autoparser-object" src="'+a[s]+'">')}if(this.opts.autoparseVideo&&(t.match(this.opts.regex.youtube)||t.match(this.opts.regex.vimeo))){var l,c,d='<iframe width="500" height="281" src="',h='" frameborder="0" allowfullscreen></iframe>';t.match(this.opts.regex.youtube)?(l="//www.youtube.com/embed/$1",c=this.opts.regex.youtube):t.match(this.opts.regex.vimeo)&&(l="//player.vimeo.com/video/$2",c=this.opts.regex.vimeo);var u=this.component.create("video",d+l+h);t=t.replace(c,u.get().outerHTML)}for(s=0;s<e.length;s++){var p;r="img"===e[s]?"<"+e[s]+"[^>]*>":"<"+e[s]+"([\\w\\W]*?)</"+e[s]+">";if(null!==(p=t.match(new RegExp(r,"gi"))))for(o=0;o<p.length;o++)t=t.replace(p[o],"#####replaceparse"+n+"#####"),i.push(p[o]),n++}return this.opts.autoparseLinks&&t.match(this.opts.regex.url)&&(t=this._formatLinks(t)),t=this._restoreReplaced(i,t),t=this._restoreReplaced(i,t)},_isKey:function(t){return t===this.keycodes.ENTER||t===this.keycodes.SPACE},_format:function(t){var e=this.selection.getParent(),i=$R.dom(e);if(!(e&&0!==i.closest("figure, pre, code, img, a, iframe").length)&&this.selection.isCollapsed()){var n=this.utils.createInvisibleChar();this.selection.getRange().insertNode(n);var s=this.selection.getCurrent(),r=this.inspector.parse(s),o=$R.dom(s);if(n.parentNode.removeChild(n),s&&3===s.nodeType){var a,l=s.textContent;if(this.opts.autoparseImages&&l.match(this._convertToRegExp(this.opts.regex.imageurl))){var c=r.isList(),d=l.match(this.opts.regex.imageurl),h=c?undefined:"<figure><img></figure>",u=this.component.create("image",h);u.setSrc(d[0]),u.addClass("redactor-autoparser-object"),l=l.replace(d[0],u.get().outerHTML),a="image"}else if(this.opts.autoparseVideo&&(l.match(this._convertToRegExp(this.opts.regex.youtube))||l.match(this._convertToRegExp(this.opts.regex.vimeo)))){var p,f,m='<iframe width="500" height="281" src="',g='" frameborder="0" allowfullscreen></iframe>';l.match(this.opts.regex.youtube)?(p="//www.youtube.com/embed/$1",f=this.opts.regex.youtube):l.match(this.opts.regex.vimeo)&&(p="//player.vimeo.com/video/$2",f=this.opts.regex.vimeo);var v=this.component.create("video",m+p+g);v.addClass("redactor-autoparser-object"),l=l.replace(f,v.get().outerHTML),a="video"}else this.opts.autoparseLinks&&l.match(this._convertToRegExp(this.opts.regex.url))&&(l=this._formatLinks(l,t),a="link");if(a){t?(this.selection.save(),o.replaceWith(l),this.selection.restore()):o.replaceWith(l);var b=this.editor.getElement().find(".redactor-autoparser-object").removeClass("redactor-autoparser-object");if(b="link"===a?$R.create("link.component",this.app,b):b,"link"===a)t||this.caret.setAfter(b),this.app.broadcast("link.inserted",b);else{this.caret.setAfter(b);var y=b.clone();b.remove(),b=this.insertion.insertHtml(y),b=this.component.build(b)}this.app.broadcast("autoparse",a,b)}}}},_formatLinks:function(t,e){for(var i=t.match(this.opts.regex.url),n={},s=0;s<i.length;s++){e&&-1!==i[s].search(/\.$/)&&(i[s]=i[s].replace(/\.$/,""));var r=i[s],o=r,a=null!==r.match(/(https?|ftp):\/\//i)?"":"http://",l=-1!==["/","&","="].indexOf(r.slice(-1))?"":"\\b",c=!1!==this.opts.pasteLinkTarget?' target="'+this.opts.pasteLinkTarget+'"':"";o=-1===(o=o.length>this.opts.linkSize?o.substring(0,this.opts.linkSize)+"...":o).search("%")?decodeURIComponent(o):o;var d=' class="redactor-autoparser-object"';n["("+r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")"]='<a href="'+a+r.trim()+'"'+c+d+">"+o.trim()+"</a>"}for(var h in n)t=t.replace(new RegExp(h,"g"),n[h]);return t},_restoreReplaced:function(t,e){for(var i=0;i<t.length;i++)e=e.replace("#####replaceparse"+i+"#####",t[i]);return e},_convertToRegExp:function(t){return new RegExp(String(t).replace(/^\//,"").replace(/\/ig$/,"").replace(/\/gi$/,"")+"$","gi")}}),$R.add("service","storage",{init:function(t){this.app=t,this.data=[]},observeImages:function(){this.opts.imageObserve&&this.editor.getElement().find("[data-image]").each(this._addImage.bind(this))},observeFiles:function(){this.editor.getElement().find("[data-file]").each(this._addFile.bind(this))},setStatus:function(t,e){this.data[t].status=e},getChanges:function(){var t=this.editor.getElement();for(var e in this.data){var i=this.data[e],n=t.find("[data-"+i.type+'="'+i.id+'"]');this.setStatus(i.id,0!==n.length)}return this.data},add:function(t,e){var i=$R.dom(e),n=i.attr("data-"+t);this.data[n]={type:t,status:!0,node:i.get(),id:i.attr("data-"+t)}},_addImage:function(t){this.add("image",t)},_addFile:function(t){this.add("file",t)}}),$R.add("service","utils",{init:function(t){this.app=t},isEmpty:function(t){var e=!1;return(t=$R.dom(t).get())&&(e=3===t.nodeType?""===t.textContent.trim().replace(/\n/,""):""===t.innerHTML),e},isEmptyHtml:function(t,e,i){return t=(t=(t=(t=(t=(t=this.removeInvisibleChars(t)).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,e?"br":"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/^<div>[^\W\w\D\d]*?<\/div>$/i,""),i&&(t=(t=t.replace(/<ul(.*?[^>])>$/i,"ul")).replace(/<ol(.*?[^>])>$/i,"ol")),""===(t=(t=(t=(t=(t=(t=t.replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).trim())},trimSpaces:function(t){return this.removeInvisibleChars(t.trim())},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(t){return t.search(/^\uFEFF$/g)},removeInvisibleChars:function(t){return t.replace(/\uFEFF/g,"")},trimInvisibleChars:function(t){if(this.selection.isCollapsed()){var e=this.selection.getCurrent(),i="left"===t?this.selection.getTextBeforeCaret():this.selection.getTextAfterCaret();if(e&&3===e.nodeType&&0===this.searchInvisibleChars(i))if("left"===t)$R.dom(e).replaceWith(e.textContent.trim());else{var n=this.offset.get();this.offset.set({start:n.start+1,end:n.end+1})}}},buildWrapper:function(t){return $R.dom("<div>").html(t)},getWrapperHtml:function(t){var e=t.html();return t.remove(),e},createTmpContainer:function(t){var e=$R.dom("<div>");return"string"==typeof t?e.html(t):e.append($R.dom(t).clone(!0)),e.get()},createFragment:function(t){for(var e,i,n,s=this.createTmpContainer(t),r=document.createDocumentFragment(),o=[],a=0;e=s.firstChild;){a++;var l=r.appendChild(e);1===a&&(i=l),o.push(l),n=l}return{frag:r,first:i,last:n,nodes:o}},isFragment:function(t){return"object"==typeof t&&t.frag},parseHtml:function(t){var e=this.createTmpContainer(t);return{html:e.innerHTML,nodes:e.childNodes}},splitNode:function(t,e,i,n){var s;e=this.isFragment(e)?e.frag:e,s=n?this.inspector.isInlineTag(t.tagName)?t:this.selection.getInline(t):this.inspector.isBlockTag(t.tagName)?t:this.selection.getBlock(t);var r=$R.dom(s);if(!n&&this.isEmptyHtml(s.innerHTML,!0))return r.after(e),r.remove(),e;var o=r.get().tagName.toLowerCase(),a=this.caret.isEnd(s),l=this.caret.isStart(s);if(!a&&!l){var c=this.extractHtmlFromCaret(n),d=$R.dom("<"+o+" />");d=this.cloneAttributes(s,d),r.after(d.append(c))}if(l)return r.before(e);if(i)return r.append(e);e=r.after(e);var h=r.html();return""===(h=(h=this.removeInvisibleChars(h)).replace(/&nbsp;/gi,""))&&r.remove(),e},extractHtmlFromCaret:function(t,e){var i=this.selection.getRange();if(i&&(e=e||(t?this.selection.getInline():this.selection.getBlock()))){var n=i.cloneRange();return n.selectNodeContents(e),n.setStart(i.endContainer,i.endOffset),n.extractContents()}},createMarkup:function(t){var e=document.createElement(this.opts.markup);this.opts.breakline&&e.setAttribute("data-redactor-tag","br"),$R.dom(t).after(e),this.caret.setStart(e)},createMarkupBefore:function(t){var e=document.createElement(this.opts.markup);this.opts.breakline&&e.setAttribute("data-redactor-tag","br"),$R.dom(t).before(e),this.caret.setEnd(e)},getNode:function(t){var e=$R.dom(t).get(),i=this.editor.getElement().get();return void 0===t?i:e||!1},findSiblings:function(t,e){for(t=$R.dom(t).get(),e="next"===e?"nextSibling":"previousSibling";t=t[e];)if((3!==t.nodeType||""!==t.textContent.trim())&&"BR"!==t.tagName)return t;return!1},getElementsFromHtml:function(t,e,i){var n=document.createElement("div");n.innerHTML=t;var s=n.querySelectorAll(e);return function(t,e){if("number"==typeof this.length&&"function"==typeof t){var i=[];if("object"==typeof this)for(var n=0;n<this.length;n++){if(!(n in this))return;i[n]=t.call(e||this,this[n],n,this)}return i}}.call(s,function(t){var e=t.getAttribute("data-redactor-type");if(!i||!e||e!==i)return t.outerHTML})},getChildNodes:function(t,e,i){var n=(t=t&&t.nodeType&&11===t.nodeType?t:$R.dom(t).get()).childNodes,s=[];if(n)for(var r=0;r<n.length;r++)if(!(!0===i&&3===n[r].nodeType||3===n[r].nodeType&&this.isEmpty(n[r])||(s.push(n[r]),!1===e))){var o=this.getChildNodes(n[r],i);0<o.length&&(s=s.concat(o))}return s},getChildElements:function(t){return this.getChildNodes(t,!0,!0)},getFirstNode:function(t){return this._getFirst(this.getChildNodes(t,!1))},getLastNode:function(t){return this._getLast(this.getChildNodes(t,!1))},getFirstElement:function(t){return this._getFirst(this.getChildNodes(t,!1,!0))},getLastElement:function(t){return this._getLast(this.getChildNodes(t,!1,!0))},replaceToTag:function(t,s){return $R.dom(t).replaceWith(function(t){var e=$R.dom("<"+s+">").append($R.dom(t).contents());if(t.attributes)for(var i=t.attributes,n=0;n<i.length;n++)e.attr(i[n].nodeName,i[n].value);return e})},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},removeFromArrayByValue:function(t,e){for(var i,n=arguments,s=n.length;1<s&&t.length;)for(e=n[--s];-1!==(i=t.indexOf(e));)t.splice(i,1);return t},removeEmptyAttr:function(t,e){var i=$R.dom(t);return void 0===i.attr(e)||null===i.attr(e)||""===i.attr(e)&&(i.removeAttr(e),!0)},cloneAttributes:function(t,e){t=$R.dom(t).get(),e=$R.dom(e);for(var i=t.attributes,n=i.length;n--;){var s=i[n];e.attr(s.name,s.value)}return e},toParams:function(t){if("object"!=typeof t)return t;var e=Object.keys(t);if(!e.length)return"";for(var i="",n=0;n<e.length;n++){var s=e[n];i+=s+":"+t[s]+";"}return i},styleToObj:function(t){var e={};if(t)for(var i=t.replace(/;$/,"").split(";"),n=0;n<i.length;n++){var s=i[n].split(":");e[s[0].trim()]=s[1].trim()}return e},checkProperty:function(t,e){for(var i=e&&Array.isArray(e)?e:[].slice.call(arguments,1),n=0;n<i.length;n++){if(!t||"undefined"==typeof t[i[n]])return!1;t=t[i[n]]}return t},extendData:function(r,t){for(var e in t){if("elements"===e)$R.dom(t[e]).each(function(t){var e=$R.dom(t);if("FORM"===t.tagName){var i=e.serialize(!0);for(var n in i)r=this._setData(r,n,i[n])}else{var s=e.attr("name")?e.attr("name"):e.attr("id");r=this._setData(r,s,e.val())}}.bind(this));else r=this._setData(r,e,t[e])}return r},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t},normalizeTextNodes:function(t){(t=$R.dom(t).get())&&t.normalize()},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},hex2long:function(t){return-1!==t.search(/^#/)&&4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t},escapeRegExp:function(t){return t.replace(/[-\/\\^$*~+?.()|[\]{}]/g,"\\$&")},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},_getFirst:function(t){return 0!==t.length&&t[0]},_getLast:function(t){return 0!==t.length&&t[t.length-1]}}),$R.add("service","progress",{init:function(t){this.app=t,this.$box=null,this.$bar=null},show:function(){this._is()||this._build(),this.$box.show()},hide:function(){this._is()&&this.animate.start(this.$box,"fadeOut",this._destroy.bind(this))},update:function(t){this.show(),this.$bar.css("width",t+"%")},_is:function(){return null!==this.$box},_build:function(){this.$bar=$R.dom("<span />"),this.$box=$R.dom('<div id="redactor-progress" />'),this.$box.append(this.$bar),this.$body.append(this.$box)},_destroy:function(){this._is()&&this.$box.remove(),this.$box=null,this.$bar=null}}),$R.add("module","starter",{init:function(t){this.app=t,this.opts=t.opts,this.plugin=t.plugin,this.module=t.module},onstart:function(){var t=["element","container","source","editor","statusbar","toolbar"],e=["element","container","source","editor","statusbar","contextbar","input"];this._startStop("start",this.app,t),this._startStop("start",this.module,e)},onstop:function(){var t=["observer","element","container","source","editor","contextbar"];this._startStop("stop",this.module,t)},onenable:function(){var t=["observer","toolbar"],e=this.opts.plugins;this._startStop("start",this.module,t),this._startStop("start",this.plugin,e)},ondisable:function(){var t=["observer","toolbar"],e=this.opts.plugins;this._startStop("stop",this.module,t),this._startStop("stop",this.plugin,e)},_startStop:function(t,e,i){for(var n=0;n<i.length;n++)"undefined"!=typeof e[i[n]]&&this.app.callInstanceMethod(e[i[n]],t)}}),$R.add("module","element",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.namespace=t.namespace,this.element=t.element,this.rootOpts=$R.extend({},!0,$R.options,t.rootOpts)},start:function(){this._build(),this._buildModes(),this._buildMarkup()},stop:function(){this.element.getElement().removeData(this.namespace+"-uuid")},_build:function(){this.element.getElement().data(this.namespace+"-uuid",this.uuid)},_buildModes:function(){var t=this.element.getType();"inline"===t&&this._redefineOptions(this.opts.modes.inline),"div"===t&&this._redefineOptions(this.opts.modes.original),"inline"!==t&&(this._isRootOption("styles")&&this.rootOpts.styles&&(this.opts.styles=!0),this._isRootOption("source")&&!this.rootOpts.source&&(this.opts.showSource=!1))},_buildMarkup:function(){"inline"===this.element.getType()?this.opts.emptyHtml="":this.opts.breakline?(this.opts.markup="div",this.opts.emptyHtml='<div data-redactor-tag="br">'+this.opts.markerChar+"</div>"):this.opts.emptyHtml="<"+this.opts.markup+"></"+this.opts.markup+">"},_redefineOptions:function(t){for(var e in t)this.opts[e]=t[e]},_isRootOption:function(){return"undefined"!=typeof this.rootOpts.styles}}),$R.add("module","editor",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.editor=t.editor,this.source=t.source,this.element=t.element,this.component=t.component,this.container=t.container,this.inspector=t.inspector,this.autoparser=t.autoparser,this.placeholder=!1,this.events=!1},onenable:function(){this.enable()},ondisable:function(){this.disable()},onenablefocus:function(){this._enableFocus()},oncontextmenu:function(t){this.component.setOnEvent(t,!0)},onclick:function(t){this.component.setOnEvent(t)},onkeyup:function(t){this.inspector.parse(t.target).isComponent()||this.component.clearActive()},onenablereadonly:function(){this._enableReadOnly()},ondisablereadonly:function(){this._disableReadOnly()},onautoparseobserve:function(){this.autoparser.observe()},onplaceholder:{build:function(){this._buildPlaceholder()},toggle:function(){this._togglePlacehodler()}},start:function(){this._build(),this._buildEvents(),this._buildOptions(),this._buildAccesibility()},stop:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=["redactor-in","redactor-in-"+this.uuid,"redactor-structure","redactor-placeholder","notranslate"];""!==this.opts.stylesClass&&i.push(this.opts.stylesClass);var n=["redactor-focus","redactor-blur","redactor-over","redactor-styles-on","redactor-styles-off","redactor-toolbar-on","redactor-text-labeled-on","redactor-source-view"];t.removeAttr("spellcheck"),t.removeAttr("dir"),t.removeAttr("contenteditable"),t.removeAttr("placeholder"),t.removeAttr("data-gramm_editor"),t.removeClass(i.join(" ")),e.removeClass(n.join(" ")),this._destroyEvents(),0===t.get().classList.length&&t.removeAttr("class")},enable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.addClass("redactor-in redactor-in-"+this.uuid),t.attr({contenteditable:!0}),this.opts.structure&&t.addClass("redactor-structure"),!this.opts.toolbar||this.opts.air||this.opts.toolbarExternal||e.addClass("redactor-toolbar-on"),this._disableBrowsersEditing()},disable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.removeClass("redactor-in redactor-in-"+this.uuid),t.removeClass("redactor-structure"),t.removeAttr("contenteditable"),e.addClass("redactor-toolbar-on")},_build:function(){var t=this.editor.getElement(),e=this.element.getElement(),i=this.container.getElement();i.addClass("redactor-blur"),this.opts.grammarly||t.attr("data-gramm_editor",!1),this.opts.notranslate&&t.addClass("notranslate"),this.opts.styles?(t.addClass(this.opts.stylesClass),i.addClass("redactor-styles-on")):i.addClass("redactor-styles-off"),this.opts.buttonsTextLabeled&&i.addClass("redactor-text-labeled-on"),this.element.isType("textarea")&&e.before(t)},_buildEvents:function(){this.events=$R.create("editor.events",this.app)},_buildOptions:function(){var t=this.editor.getElement();t.attr("dir",this.opts.direction),this.opts.spellcheck||t.attr("spellcheck",!1),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&t.css("min-height",this.opts.minHeight),this.opts.maxHeight&&t.css("max-height",this.opts.maxHeight),this.opts.maxWidth&&t.css({"max-width":this.opts.maxWidth,margin:"auto"})},_buildAccesibility:function(){this.editor.getElement().attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},_buildPlaceholder:function(){this.placeholder=$R.create("editor.placeholder",this.app)},_enableFocus:function(){this.opts.showSource?this._enableFocusSource():this._enableFocusEditor()},_enableFocusSource:function(){var t=this.source.getElement();this.opts.focus?(t.focus(),t.get().setSelectionRange(0,0)):this.opts.focusEnd&&t.focus()},_enableFocusEditor:function(){this.opts.focus?setTimeout(this.editor.startFocus.bind(this.editor),100):this.opts.focusEnd&&setTimeout(this.editor.endFocus.bind(this.editor),100)},_togglePlacehodler:function(){this.placeholder&&this.placeholder.toggle()},_disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1);var t=this.editor.getElement().get();t.addEventListener?t.addEventListener("mscontrolselect",function(t){t.preventDefault()}):t.attachEvent("oncontrolselect",function(t){t.returnValue=!1})}catch(e){}},_destroyEvents:function(){this.events&&this.events.destroy()},_enableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).removeAttr("contenteditable"),t.removeAttr("contenteditable"),t.addClass("redactor-read-only"),this.events&&this.events.destroy()},_disableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).attr({contenteditable:!0}),t.removeClass("redactor-read-only"),t.attr({contenteditable:!0}),this._buildEvents()},_getEditables:function(t){return t.find("figcaption, td, th")}}),$R.add("class","editor.placeholder",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.element=t.element,this.build()},build:function(){var t=this.element.getElement(),e=this.editor.getElement();if(!1!==this.opts.placeholder||t.attr("placeholder")){var i=!1!==this.opts.placeholder?this.opts.placeholder:t.attr("placeholder");e.attr("placeholder",i),this.toggle()}},toggle:function(){return this.editor.isEmpty(!0)?this.show():this.hide()},show:function(){this.editor.getElement().addClass("redactor-placeholder")},hide:function(){this.editor.getElement().removeClass("redactor-placeholder")}}),$R.add("class","editor.events",{init:function(t){this.app=t,this.opts=t.opts,this.$doc=t.$doc,this.uuid=t.uuid,this.source=t.source,this.editor=t.editor,this.cleaner=t.cleaner,this.container=t.container,this.insertion=t.insertion,this.inspector=t.inspector,this.selection=t.selection,this.component=t.component,this.blurNamespace=".redactor-blur."+this.uuid,this.eventsList=["paste","click","contextmenu","keydown","keyup","mouseup","touchstart","cut","copy","dragenter","dragstart","drop","dragover","dragleave"],this._init()},destroy:function(){this.editor.getElement().off(".redactor-focus"),this.$doc.off("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace),this._loop("off")},focus:function(t){
var e=this.container.getElement();this.editor.isPasting()||e.hasClass("redactor-focus")||(e.addClass("redactor-focus"),e.removeClass("redactor-blur"),this.app.broadcast("observe",t),this.app.broadcast("focus",t),this.isFocused=!0,this.isBlured=!1)},blur:function(t){var e=this.container.getElement(),i=$R.dom(t.target),n=[".redactor-in-"+this.uuid,".redactor-toolbar",".redactor-dropdown",".redactor-context-toolbar","#redactor-modal","#redactor-image-resizer"];this.app.broadcast("originalblur",t),this.app.stopBlur||this.app.isStarted()&&!this.editor.isPasting()&&0===i.closest(n.join(",")).length&&(this.isBlured||e.hasClass("redactor-blur")||(e.removeClass("redactor-focus"),e.addClass("redactor-blur"),this.app.broadcast("blur",t),this.isFocused=!1,this.isBlured=!0))},cut:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),this.component.isNonEditable(e)&&(this._passSelectionToClipboard(t,i,!0),t.preventDefault())},copy:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),this.component.isNonEditable(e)&&(this._passSelectionToClipboard(t,i,!1),t.preventDefault())},drop:function(t){if((t=t.originalEvent||t).stopPropagation(),this._removeOverClass(),!1!==this.opts.dragUpload){if(this.app.isDragComponentInside()){var e=$R.dom(this.app.getDragComponentInside()),i=e.clone(!0);return this.insertion.insertToPoint(t,i),e.remove(),this.app.setDragComponentInside(!1),this.app.broadcast("state",t),this.app.broadcast("drop",t),this.app.broadcast("image.observe",t),void t.preventDefault()}if(this.app.isDragInside()&&this.opts.input){this.insertion.insertPoint(t);var n=t.dataTransfer.getData("text/html"),s=this.selection.getRange();if(s){var r=this.selection.getBlocks();s.deleteContents();for(var o=0;o<r.length;o++)""===r[o].innerHTML&&$R.dom(r[o]).remove()}return $R.create("input.paste",this.app,t,!0,n,!0),this.app.broadcast("state",t),this.app.broadcast("drop",t),this.app.setDragInside(!1),void t.preventDefault()}this.app.broadcast("state",t),this.app.broadcast("paste",t,t.dataTransfer),this.app.broadcast("drop",t)}else t.preventDefault()},dragenter:function(t){t.preventDefault()},dragstart:function(t){this.app.setDragComponentInside(!1),this.app.setDragInside(!1);var e=this.inspector.parse(t.target);!e.isComponent()||e.isComponentEditable()||e.isFigcaption()?this.selection.is()&&!this.selection.isCollapsed()&&(this.app.setDragInside(!0),this._setDragData(t)):this.app.setDragComponentInside(e.getComponent()),this.app.broadcast("dragstart",t)},dragover:function(t){this.app.broadcast("dragover",t)},dragleave:function(t){this.app.broadcast("dragleave",t)},paste:function(t){this.app.broadcast("paste",t)},contextmenu:function(){},click:function(t){if(3===t.detail){t.preventDefault();var e=this.selection.getBlock();if(e){var i=document.createRange();i.selectNodeContents(e),this.selection.setRange(i)}}var n=$R.dom(t.target);if(n.hasClass("redactor-in")){var s=n.offset().top,r=parseFloat(n.css("padding-bottom"));s+n.height()-2*r<t.pageY?this.app.broadcast("bottomclick",t):n.hasClass("redactor-placeholder")&&this.editor.startFocus(this.editor)}this.app.broadcast("state",t),this.app.broadcast("click",t)},keydown:function(t){if(this.app.broadcast("state",t),!1===this.app.broadcast("keydown",t))return t.preventDefault()},keyup:function(t){this.app.broadcast("keyup",t)},mouseup:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},touchstart:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},_init:function(){this.editor.getElement().on("focus.redactor-focus click.redactor-focus",this.focus.bind(this)),this.$doc.on("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace,this.blur.bind(this)),this._loop("on")},_removeOverClass:function(){this.editor.getElement().removeClass("over")},_loop:function(t){for(var e=this.editor.getElement(),i=0;i<this.eventsList.length;i++){var n=this.eventsList[i]+".redactor-events",s=this.eventsList[i];e[t](n,this[s].bind(this))}},_passAllToClipboard:function(t){var e=t.clipboardData,i=this.source.getCode();e.setData("text/html",i),e.setData("text/plain",i.toString().replace(/\n$/,""))},_passSelectionToClipboard:function(t,e,i){var n=t.clipboardData,s=e.getComponent(),r=$R.dom(s).clone();r.find(".redactor-component-caret").remove(),r.removeClass("redactor-component-active"),r.removeAttr("contenteditable"),r.removeAttr("tabindex");var o=r.get().outerHTML;i&&this.component.remove(s),n.setData("text/html",o),n.setData("text/plain",o.toString().replace(/\n$/,""))},_setDragData:function(t){var e=(t=t.originalEvent||t).dataTransfer;e.effectAllowed="move",e.setData("text/Html",this.selection.getHtml())}}),$R.add("module","container",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.lang=t.lang,this.element=t.element,this.container=t.container},start:function(){this._build(),this._buildAccesibility()},stop:function(){var t=this.element.getElement(),e=this.container.getElement();e.after(t),e.remove(),t.show()},_build:function(){var t=this.element.getElement(),e=this.container.getElement();e.addClass("redactor-box"),e.attr("dir",this.opts.direction),this.element.isType("inline")&&e.addClass("redactor-inline"),t.after(e),e.append(t)},_buildAccesibility:function(){var t=this.container.getElement(),e=$R.dom("<span />");e.addClass("redactor-voice-label"),e.attr({id:"redactor-voice-"+this.uuid,"aria-hidden":!1}),e.html(this.lang.get("accessibility-help-label")),t.prepend(e)}}),$R.add("module","source",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.element=t.element,this.source=t.source,this.editor=t.editor,this.toolbar=t.toolbar,this.cleaner=t.cleaner,this.component=t.component,this.container=t.container,this.autoparser=t.autoparser,this.selection=t.selection,this.syncedHtml=""},onstartcode:function(){var t=this.source.getStartedContent(),e=this.editor.getElement(),i=this.source.getElement();this.opts.autoparse&&this.opts.autoparseStart&&(t=this.autoparser.parse(t));var n=this.cleaner.input(t,!0,!0),s=this.cleaner.output(n);e.html(n),i.val(s),this.syncedHtml=s,this.app.broadcast("placeholder.build"),this.app.broadcast("autoparseobserve"),this.component.executeScripts()},onstartcodeshow:function(){this.show()},ontrytosync:function(){this.sync()},onhardsync:function(){var t=this.editor.getElement().html();t=this.app.broadcast("syncBefore",t),t=this.cleaner.output(t),this._syncing(t)},start:function(){this._build(),this._buildClasses()},stop:function(){var t=this.element.getElement(),e=this.source.getElement();t.removeClass("redactor-source redactor-source-open"),e.off("input.redactor-source"),e.removeAttr("data-gramm_editor"),0===e.get().classList.length&&e.removeAttr("class"),this.source.isNameGenerated()||t.removeAttr("name"),this.element.isType("textarea")||e.remove()},getCode:function(){return this.source.getCode()},toggle:function(){if(this.opts.source)return this.source.getElement().hasClass("redactor-source-open")?this.hide():this.show()},show:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),n=e.val();this.app.isStarted()&&(n=this.app.broadcast("source.open",n));var s=t.height();if(t.hide(),e.height(s),e.val(n.trim()),e.show(),e.addClass("redactor-source-open"),e.on("input.redactor-source-events",this._onChangedSource.bind(this)),e.on("keydown.redactor-source-events",this._onTabKey.bind(this)),e.on("focus.redactor-source-events",this._onFocus.bind(this)),this.opts.source.hasOwnProperty("codemirror")){var r="object"==typeof this.opts.source.codemirror?this.opts.source.codemirror:{},o="undefined"!=typeof this.opts.source.codemirrorSrc?this.opts.source.codemirrorSrc:CodeMirror;this.codemirror=o.fromTextArea(e.get(),r),this.codemirror.setSize(null,s),this.codemirror.on("change",function(t){t.save()}),this.codemirror.on("change",this._onChangedSource.bind(this))}else i.addClass("redactor-source-view");setTimeout(function(){this._disableButtons(),this._setActiveSourceButton()}.bind(this),100),this.app.isStarted()&&this.app.broadcast("source.opened")}},hide:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),n=e.val();this.opts.source.hasOwnProperty("codemirror")&&(n=this.codemirror.getValue(),this.codemirror.toTextArea()),n=this.cleaner.input(n,!0),n=this.utils.isEmptyHtml(n)?this.opts.emptyHtml:n,n=this.app.broadcast("source.close",n),this._enableButtons(),this._setInactiveSourceButton(),e.hide(),e.removeClass("redactor-source-open"),e.off(".redactor-source-events"),t.show(),t.html(n),i.removeClass("redactor-source-view"),setTimeout(function(){this.editor.startFocus(),this.component.executeScripts()}.bind(this),0),this.app.broadcast("source.closed")}},sync:function(){var t=this,e=this.editor.getElement().html();e=this.app.broadcast("syncBefore",e),e=this.cleaner.output(e),this._isSync(e)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){t._syncing(e)},200))},_build:function(){var t=this.source.getElement(),e=this.element.getElement();t.hide(),this.opts.grammarly||t.attr("data-gramm_editor",!1),this.element.isType("textarea")||e.after(t)},_buildClasses:function(){this.source.getElement().addClass("redactor-source")},_syncing:function(t){t=this.app.broadcast("syncing",t),this.source.getElement().val(t),this.app.broadcast("synced",t),this.app.broadcast("changed",t)},_isSync:function(t){return this.syncedHtml!==t&&(this.syncedHtml=t,!0)},_onChangedSource:function(){var t=this.source.getElement().val();this.app.broadcast("changed",t),this.app.broadcast("source.changed",t)},_onTabKey:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=this.source.getElement(),i=e.get(),n=i.selectionStart;e.val(e.val().substring(0,n)+"    "+e.val().substring(i.selectionEnd)),i.selectionStart=i.selectionEnd=n+4},_onFocus:function(){this.app.broadcast("sourcefocus")},_disableButtons:function(){this.toolbar.disableButtons()},_enableButtons:function(){this.toolbar.enableButtons()},_setActiveSourceButton:function(){var t=this.toolbar.getButton("html");t.enable(),t.setActive()},_setInactiveSourceButton:function(){this.toolbar.getButton("html").setInactive()}}),$R.add("module","observer",{init:function(t){this.app=t,this.editor=t.editor,this.observerUnit=!1},start:function(){if(window.MutationObserver){var t=this.editor.getElement().get();this.observerUnit=this._build(t),this.observerUnit.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observerUnit&&this.observerUnit.disconnect()},_build:function(e){var i=this;return new MutationObserver(function(t){i._observe(t[t.length-1],e)})},_observe:function(t,e){this.app.isReadOnly()||"attributes"===t.type&&t.target===e||(this.app.broadcast("observe"),this.app.broadcast("trytosync"),this.app.broadcast("placeholder.toggle"))}}),$R.add("module","clicktoedit",{init:function(t){this.app=t,this.opts=t.opts,this.source=t.source,this.editor=t.editor,this.container=t.container,this.selection=t.selection},onstartclicktoedit:function(){this.start()},onenablereadonly:function(){this._isEnabled()||this.stop()},ondisablereadonly:function(){this._isEnabled()||this.start()},onstop:function(){this.stop()},start:function(){this._build()},stop:function(){this.buttonSave&&this.buttonSave.stop(),this.buttonCancel&&this.buttonCancel.stop(),this._destroy(),this.app.broadcast("disable")},enable:function(){this.app.broadcast("clickStart");var t=this.editor.isEmpty();t||this.selection.saveMarkers(),this._setFocus(),this._destroy(),this.app.broadcast("enable"),this.buttonSave.enable(),this.buttonCancel.enable(),t||this.selection.restoreMarkers(),t&&this.editor.focus(),this.container.getElement().addClass("redactor-clicktoedit-enabled"),this.source.rebuildStartedContent(),this.app.broadcast("startcode"),this.app.broadcast("image.observe")},save:function(t){t&&t.preventDefault();var e=this.source.getCode();this.app.broadcast("disable"),this.app.broadcast("clickSave",e),this.app.broadcast("clickStop"),this.app.broadcast("toolbar.removeexternal"),this._build()},cancel:function(t){t&&t.preventDefault();var e=this.saved;this.editor.getElement().html(e),this.saved="",this.app.broadcast("disable"),this.app.broadcast("clickCancel",e),this.app.broadcast("clickStop"),this.app.broadcast("toolbar.removeexternal"),this._build()},_build:function(){this.buttonSave=$R.create("clicktoedit.button","save",this.app,this),this.buttonCancel=$R.create("clicktoedit.button","cancel",this.app,this),this.buttonSave.stop(),this.buttonCancel.stop();var t=this.editor.getElement(),e=this.container.getElement();t.on("click.redactor-click-to-edit mouseup.redactor-click-to-edit",this.enable.bind(this)),e.addClass("redactor-over"),e.removeClass("redactor-clicktoedit-enabled")},_isEnabled:function(){return this.container.getElement().hasClass("redactor-clicktoedit-enabled")},_destroy:function(){var t=this.editor.getElement(),e=this.container.getElement();t.off(".redactor-click-to-edit"),e.removeClass("redactor-over redactor-clicktoedit-enabled")},_setFocus:function(){this.saved=this.source.getCode(),this.buttonSave.start(),this.buttonCancel.start()}}),$R.add("class","clicktoedit.button",{init:function(t,e,i){this.app=e,this.opts=e.opts,this.toolbar=e.toolbar,this.context=i,this.type=t,this.name="save"===t?"clickToSave":"clickToCancel",this.objected=!1,this.enabled=!1,this.namespace=".redactor-click-to-edit",this._build()},enable:function(){if(this.objected){var t=this.opts[this.name];t.api="module.clicktoedit."+this.type,this.toolbar.addButton(this.type,t),this.enabled=!0}},start:function(){this.objected||(this.$button.off(this.namespace),this.$button.show(),this.$button.on("click"+this.namespace,this.context[this.type].bind(this.context)))},stop:function(){!this.objected&&this.enabled&&this.$button.hide()},_build:function(){this.objected="object"==typeof this.opts[this.name],this.objected||(this.$button=$R.dom(this.opts[this.name]),this.enabled=!0)}}),$R.add("module","statusbar",{init:function(t){this.app=t,this.opts=t.opts,this.element=t.element,this.statusbar=t.statusbar,this.container=t.container},start:function(){if(!this.element.isType("inline")){var t=this.statusbar.getElement(),e=this.container.getElement();t.addClass("redactor-statusbar"),e.append(t)}}}),$R.add("module","contextbar",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$win=t.$win,this.$doc=t.$doc,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body},onstop:function(){this.stop()},onenablereadonly:function(){this.stop()},ondisablereadonly:function(){this.start()},oncontextbar:{close:function(){this.close()}},start:function(){if(this.opts.toolbarContext){var t=this.editor.getElement();this._build(),t.on("click.redactor-context mouseup.redactor-context",this.open.bind(this)),this.opts.scrollTarget?$R.dom(this.opts.scrollTarget).on("scroll.redactor-context",this.close.bind(this)):!1!==this.opts.maxHeight&&t.on("scroll.redactor-context",this.close.bind(this))}},stop:function(){this.editor.getElement().off(".redactor-context"),this.$doc.off(".redactor-context"),this.$win.off(".redactor-context"),this.$contextbar&&this.$contextbar.remove(),this.opts.scrollTarget&&$R.dom(this.opts.scrollTarget).off(".redactor-context")},is:function(){return this.$contextbar&&this.$contextbar.hasClass("open")},set:function(t,e,i,n){for(var s in this.$contextbar.html(""),this.$el=$R.dom(e),i){var r=$R.create("contextbar.button",this.app,i[s]);""!==r.html()&&this.$contextbar.append(r)}var o=this._buildPosition(t,this.$el,n);this.$contextbar.css(o),this.$contextbar.show(),this.$contextbar.addClass("open"),this.$doc.on("click.redactor-context mouseup.redactor-context",this.close.bind(this)),this.$win.on("resize.redactor-context",this.close.bind(this))},open:function(t){setTimeout(function(){this.app.broadcast("contextbar",t,this)}.bind(this),0)},close:function(t){if(this.$contextbar){if(t){var e=$R.dom(t.target);if(this.$el&&0!==e.closest(this.$el).length)return}this.$contextbar.hide(),this.$contextbar.removeClass("open"),this.$doc.off(".redactor.context")}},_build:function(){this.$contextbar=$R.dom("<div>"),this.$contextbar.attr("id","redactor-context-toolbar-"+this.uuid),this.$contextbar.attr("dir",this.opts.direction),this.$contextbar.addClass("redactor-context-toolbar"),this.$contextbar.hide(),this.$target.append(this.$contextbar)},_buildPosition:function(t,e,i){var n,s,r=this.toolbar.isTarget(),o=r?e.position():e.offset(),a=e.width(),l=e.height(),c=this.$contextbar.width(),d=this.$contextbar.height(),h=r?this.$target.scrollTop()+this.$doc.scrollTop():this.$doc.scrollTop(),u=this.$target.offset(),p=r?u.left:0,f=r?u.top:0;return i?"top"===i?(n=o.top-d,s=o.left+a/2-c/2):"bottom"===i&&(n=o.top+l,s=o.left+a/2-c/2):(n=t.clientY+h-d,s=t.clientX-c/2),s<0&&(s=0),{top:n-f+"px",left:s-p+"px"}}}),$R.add("class","contextbar.button",{mixins:["dom"],init:function(t,e){this.app=t,this.obj=e,this._init()},_init:function(){if(this.parse("<a>"),"string"!=typeof this.obj.title){var t=this.obj.title.attr("href");this.attr("href",t),-1===t.search(/^#/)&&this.attr("target","_blank"),this.text(this.obj.html||t)}else this.attr("href","#"),this._buildTitle(),this._buildMessage()},_buildTitle:function(){this.html(this.obj.title)},_buildMessage:function(){"undefined"==typeof this.obj.message&&"undefined"==typeof this.obj.api||this.on("click",this._toggle.bind(this))},_toggle:function(t){t.preventDefault(),this.obj.message?this.app.broadcast(this.obj.message,this.obj.args):this.obj.api&&this.app.api(this.obj.api,this.obj.args)}}),$R.add("module","toolbar",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.toolbar=t.toolbar,this.buttons=[],this.toolbarModule=!1},onsource:{open:function(){!this.toolbar.isAir()&&this.toolbar.isFixed()&&this.toolbarModule.resetPosition()},opened:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.createSourceHelper(),setTimeout(function(){$R.dom(".re-button-tooltip-"+this.uuid).remove()}.bind(this),100)},close:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.destroySourceHelper()},closed:function(){this.toolbar.is()&&this.opts.air&&this.toolbarModule.openSelected()}},ontoolbar:{removeexternal:function(){!this.opts.air&&this.opts.toolbarExternal&&this.opts.clickToEdit&&$R.dom(this.opts.toolbarExternal).html("")}},onobserve:function(){this.toolbar.is()&&this.toolbar.observe()},onfocus:function(){this._setExternalOnFocus()},onsourcefocus:function(){this._setExternalOnFocus()},onempty:function(){this.toolbar.isFixed()&&this.toolbarModule.resetPosition()},onenablereadonly:function(){this.toolbar.isAir()&&this.toolbarModule.close()},start:function(){this.toolbar.is()&&(this._buildButtons(),this._initToolbar(),this._initButtons())},stop:function(){this.toolbarModule&&this.toolbarModule.stop(),$R.dom(".redactor-dropdown-"+this.uuid).remove()},_buildButtons:function(){this.buttons=this.opts.buttons.concat(),this._buildImageButton(),this._buildFileButton(),this._buildSourceButton(),this._buildAdditionalButtons(),this._buildHiddenButtons()},_buildImageButton:function(){this.opts.imageUpload||this.opts.imageManagerJson||this.utils.removeFromArrayByValue(this.buttons,"image")},_buildFileButton:function(){this.opts.fileUpload||this.utils.removeFromArrayByValue(this.buttons,"file")},_buildSourceButton:function(){this.opts.source||this.utils.removeFromArrayByValue(this.buttons,"html")},_buildAdditionalButtons:function(){var t,e;if(0!==this.opts.buttonsAdd.length&&(this.opts.buttonsAdd=this._removeExistButtons(this.opts.buttonsAdd),this.buttons=this.buttons.concat(this.opts.buttonsAdd)),0!==this.opts.buttonsAddFirst.length&&(this.opts.buttonsAddFirst=this._removeExistButtons(this.opts.buttonsAddFirst),this.buttons.unshift(this.opts.buttonsAddFirst)),!1!==this.opts.buttonsAddAfter){t=this.buttons.indexOf(this.opts.buttonsAddAfter.after)+1,e=this.opts.buttonsAddAfter.buttons;for(var i=0;i<e.length;i++)this.buttons.splice(t+i,0,e[i])}if(!1!==this.opts.buttonsAddBefore){t=this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1,e=this.opts.buttonsAddBefore.buttons;for(i=0;i<e.length;i++)this.buttons.splice(t-(1-i),0,e[i])}},_buildHiddenButtons:function(){if(0!==this.opts.buttonsHide.length)for(var t=this.opts.buttonsHide,e=0;e<t.length;e++)this.utils.removeFromArrayByValue(this.buttons,t[e])},_removeExistButtons:function(t){for(var e=0;e<t.length;e++)-1!==this.opts.buttons.indexOf(t[e])&&this.utils.removeFromArrayByValue(t,t[e]);return t},_setExternalOnFocus:function(){!this.opts.air&&this.opts.toolbarExternal&&this.toolbarModule.setExternal()},_initToolbar:function(){this.toolbarModule=this.opts.air?$R.create("toolbar.air",this.app):$R.create("toolbar.standard",this.app)},_initButtons:function(){this.toolbar.setButtons(this.buttons);for(var t=0;t<this.buttons.length;t++){var e=this.buttons[t];$R.buttons[e]&&this.toolbar.addButton(e,$R.buttons[e],!1,!1,!0)}}}),$R.add("class","toolbar.air",{init:function(t){this.app=t,this.uuid=t.uuid,this.$doc=t.$doc,this.$win=t.$win,this.utils=t.utils,this.editor=t.editor,this.animate=t.animate,this.toolbar=t.toolbar,this.container=t.container,this.inspector=t.inspector,this.selection=t.selection,this.clicks=0,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.editor.getElement().off(".redactor-air-trigger-"+this.uuid),this.$doc.off(".redactor-air-"+this.uuid),this.$doc.off(".redactor-air-trigger-"+this.uuid),this.toolbar.stopObservers()},createSourceHelper:function(){this.$airHelper=$R.dom("<span>"),this.$airHelper.addClass("redactor-air-helper"),this.$airHelper.html('<i class="re-icon-html"></i>'),this.$airHelper.on("click",function(t){t.preventDefault(),this.app.api("module.source.hide")}.bind(this)),this.container.getElement().append(this.$airHelper)},destroySourceHelper:function(){this.$airHelper&&this.$airHelper.remove()},openSelected:function(){setTimeout(function(){this._isSelection()&&this._open(!1)}.bind(this),0)},close:function(){this.$doc.off(".redactor-air-"+this.uuid);var t=this.toolbar.getElement();t.removeClass("open"),t.hide()},_init:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement(),i=this.editor.getElement(),n=this.container.getElement();t.addClass("redactor-toolbar-wrapper-air"),e.addClass("redactor-air"),e.hide(),t.append(e),n.prepend(t),this.openSelected(),this.$doc.on("mouseup.redactor-air-trigger-"+this.uuid,this._open.bind(this)),i.on("keyup.redactor-air-trigger-"+this.uuid,this._openCmd.bind(this))},_isSelection:function(){return this.selection.is()&&!this.selection.isCollapsed()},_isOpened:function(){return this.toolbar.getElement().hasClass("open")},_open:function(t){var e=!!t&&t.target,i=!!t&&$R.dom(t.target),n=this.inspector.parse(e),s=n.isComponent()&&!n.isComponentType("table"),r=n.isFigcaption(),o=i&&0!==i.closest(".redactor-modal").length,a=t&&0!==i.closest(".re-button").length;if(!(t&&0!==i.closest(".redactor-dropdown").length||a||o||r||s||this.toolbar.isContextBar())&&this._isSelection()){var l=this.selection.getPosition();setTimeout(function(){this.app.isReadOnly()||this._isSelection()&&this._doOpen(l)}.bind(this),1)}},_openCmd:function(){if(this.selection.isAll()){var t=this.toolbar.getElement(),e=this.selection.getPosition();e.top=e.top<20?0:e.top-t.height(),e.height=0,this._doOpen(e)}},_doOpen:function(t){var e=this.toolbar.getWrapper(),i=this.toolbar.getElement(),n=this.container.getElement().offset(),s=0,r=this.$win.width(),o=i.width();r<t.left+o&&(s=o-this.selection.getPosition().width);e.css({left:t.left-n.left-s+"px",top:t.top-n.top+t.height+this.$doc.scrollTop()+"px"}),this.app.broadcast("airOpen"),i.addClass("open"),i.show(),this.$doc.on("click.redactor-air-"+this.uuid,this._close.bind(this)),this.$doc.on("keydown.redactor-air-"+this.uuid,this._close.bind(this)),this.app.broadcast("airOpened")},_close:function(t){var e=!!t&&$R.dom(t.target),i=t&&0!==e.closest("[data-dropdown], .redactor-dropdown-not-close").length;(!i&&t&&0!==e.closest(".re-button").length||!i&&this._isOpened())&&(this.app.broadcast("airClose"),this.close(),this.app.broadcast("airClosed"))}}),$R.add("class","toolbar.fixed",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$doc=t.$doc,this.$win=t.$win,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.container=t.container,this._init()},stop:function(){this.$fixedTarget.off(".redactor-toolbar-"+this.uuid),this.$win.off(".redactor-toolbar-"+this.uuid)},reset:function(){var t=this.toolbar.getElement();this.toolbar.getWrapper().css("height",""),t.removeClass("redactor-toolbar-fixed"),t.css({position:"",top:"",left:"",width:""});var e=this.toolbar.getDropdown();e&&e.updatePosition()},_init:function(){this.$fixedTarget=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$win,this._doFixed(),this.toolbar.isTarget()&&(this.$win.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$win.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this))),this.$fixedTarget.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$fixedTarget.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this))},_doFixed:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=this.toolbar.getElement(),n=this.toolbar.getWrapper();if(!this.editor.isSourceMode()&&0===e.parents().filter(function(t){return"none"===getComputedStyle(t,null).display&&t}).length){var s=t.height()<100,r=this.editor.isEmpty();if(s||r)this.reset();else if(!this.editor.isSourceMode()){var o=i.height(),a=60,l=(this.toolbar.isTarget()?e.position():e.offset()).top,c=l+e.height()-a,d=this.$fixedTarget.scrollTop()+this.opts.toolbarFixedTopOffset,h=this.toolbar.isTarget()?this.$fixedTarget.offset().top-this.$win.scrollTop():0;if(this.toolbar.isTarget()&&"fixed"===this.$fixedTarget.css("position")){var u=this.$fixedTarget.hasClass("modal")&&this.$fixedTarget.hasClass("fade")?e.closest(".modal-dialog").position().top:0;h=this.$fixedTarget.scrollTop()-u}if(l<d&&d<c){var p=this.detector.isDesktop()?"fixed":"absolute";h=this.detector.isDesktop()?h:d-l,this.detector.isMobile()&&(this.fixedScrollTimeout&&clearTimeout(this.fixedScrollTimeout),i.hide(),this.fixedScrollTimeout=setTimeout(function(){i.show()},250)),n.height(o),i.addClass("redactor-toolbar-fixed"),e.hasClass("redactor-box-fullscreen")?i.css({position:p,top:"0px",width:e.width()+"px"}):i.css({position:p,top:h+this.opts.toolbarFixedTopOffset+"px",width:e.width()+"px"});var f=this.toolbar.getDropdown();f&&f.updatePosition(),this.app.broadcast("toolbar.fixed")}else this.reset(),this.app.broadcast("toolbar.unfixed")}}}}),$R.add("class","toolbar.standard",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$body=t.$body,this.toolbar=t.toolbar,this.container=t.container,this.isExternalMultiple=!1,this.toolbarFixed=!1,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.toolbarFixed&&this.toolbarFixed.stop(),this.opts.toolbarExternal&&this._findToolbars(),this.toolbar.stopObservers(),this.$body.find(".re-button-tooltip-"+this.uuid).remove()},setExternal:function(){(this._findToolbars(),this.isExternalMultiple)&&(this.$toolbars.hide(),this.$external.find(".redactor-toolbar-external-"+this.uuid).show())},resetPosition:function(){this.toolbarFixed&&this.toolbarFixed.reset()},_init:function(){(this._build(),this.opts.toolbarExternal)?this._buildExternal():(this._buildFixed(),this.toolbar.getElement().show())},_build:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement();(t.addClass("redactor-toolbar-wrapper"),e.addClass("redactor-toolbar"),e.hide(),t.append(e),this.opts.toolbarExternal)||this.container.getElement().prepend(t)},_buildExternal:function(){(this._initExternal(),this._findToolbars(),this.isExternalMultiple)?this._hideToolbarsExceptFirst():this.toolbar.getElement().show()},_buildFixed:function(){this.opts.toolbarFixed&&(this.toolbarFixed=$R.create("toolbar.fixed",this.app))},_initExternal:function(){var t=this.toolbar.getElement(),e=this.toolbar.getElement();t.addClass("redactor-toolbar-external redactor-toolbar-external-"+this.uuid),this.$external=$R.dom(this.opts.toolbarExternal),this.$external.append(e)},_findToolbars:function(){this.$toolbars=this.$external.find(".redactor-toolbar-external"),this.isExternalMultiple=1<this.$toolbars.length},_hideToolbarsExceptFirst:function(){this.$toolbars.hide(),this.$toolbars.first().show()}}),$R.add("module","line",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("line")){var n=i.getComponent(),s={remove:{title:this.lang.get("delete"),api:"module.line.remove",args:n}};e.set(t,n,s,"bottom")}},insert:function(){var t=this.component.create("line");this.insertion.insertRaw(t)},remove:function(t){this.component.remove(t)}}),$R.add("class","line.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==undefined?e:this._init(e)},_init:function(t){var e,i;if(void 0!==t){var n=$R.dom(t),s=n.get();"HR"===s.tagName?i=s:"FIGURE"===s.tagName&&(e=s,i=n.find("hr").get())}this._buildWrapper(e),this._buildElement(i),this._initWrapper()},_buildElement:function(t){t?this.$element=$R.dom(t):(this.$element=$R.dom("<hr>"),this.append(this.$element))},_buildWrapper:function(t){t=t||"<figure>",this.parse(t)},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"line",tabindex:"-1",contenteditable:!1})}}),$R.add("module","link",{modals:{link:'<form action="">                 <div class="form-item">                     <label for="modal-link-url">URL <span class="req">*</span></label>                     <input type="text" id="modal-link-url" name="url">                 </div>                 <div class="form-item">                     <label for="modal-link-text">## text ##</label>                     <input type="text" id="modal-link-text" name="text">                 </div>                 <div class="form-item form-item-title">                     <label for="modal-link-title">## title ##</label>                     <input type="text" id="modal-link-title" name="title">                 </div>                 <div class="form-item form-item-target">                     <label class="checkbox">                         <input type="checkbox" name="target"> ## link-in-new-tab ##                     </label>                 </div>             </form>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.inline=t.inline,this.editor=t.editor,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.isCurrentLink=!1,this.currentText=!1},onmodal:{link:{open:function(t,e){this._setFormData(e,t)},opened:function(t,e){this._setFormFocus(e)},update:function(t,e){var i=e.getData();this._validateData(e,i)&&this._update(i)},insert:function(t,e){var i=e.getData();this._validateData(e,i)&&this._insert(i)},unlink:function(){this._unlink()}}},onbutton:{link:{observe:function(t){this._observeButton(t)}}},ondropdown:{link:{observe:function(t){this._observeUnlink(t),this._observeEdit(t)}}},oncontextbar:function(t,e){var i=this._getCurrent(),n=this.inspector.parse(i);if(n.isLink()||n.isFile()){var s=n.isFile()?n.getFile():n.getLink(),r=$R.dom(s),o=$R.dom("<a>"),a=r.attr("href");o.text(this._truncateText(a)),o.attr("href",a),o.attr("target","_blank");var l={link:{title:o,html:this._truncateText(a)},edit:{title:this.lang.get("edit"),api:"module.link.open"},unlink:{title:this.lang.get("unlink"),api:"module.link.unlink"}};e.set(t,s,l,"bottom")}},open:function(){this.$link=this._buildCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},update:function(t){this._update(t)},unlink:function(){this._unlink()},_observeButton:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);i.isPre()||i.isCode()?t.disable():t.enable()},_observeUnlink:function(t){var e=t.getItem("unlink");0===this._getLinks().length?e.disable():e.enable()},_observeEdit:function(t){var e=this._getCurrent(),i=t.getItem("link"),n=this.inspector.parse(e),s=n.isLink()||n.isFile()?this.lang.get("link-edit"):this.lang.get("link-insert");i.setTitle(s)},_unlink:function(){this.app.api("module.modal.close");var t=[],e=this._getLinks();this.selection.save();for(
var i=0;i<e.length;i++){var n=$R.create("link.component",this.app,e[i]);t.push(this.selection.getElement(e[i])),n.unwrap(),this.app.broadcast("link.deleted",n)}this.selection.restore();for(i=0;i<t.length;i++){var s=t[i]?t[i]:this.editor.getElement();this.utils.normalizeTextNodes(s)}this._resetCurrent()},_update:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._setLinkData(e,t,"updated"),this._resetCurrent(),this.app.broadcast("link.changed",e)},_insert:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._insertSingle(e,t)||(this._removeInSelection(e),this._insertMultiple(t)),this._resetCurrent()},_removeInSelection:function(t){this.selection.save();for(var e=0;e<t.length;e++){var i=$R.create("link.component",this.app,t[e]),n=i.clone();i.unwrap(),this.app.broadcast("link.deleted",n)}this.selection.restore()},_insertMultiple:function(t){var e=this.selection.getRange();e&&this._isCurrentTextChanged(t)&&this._deleteContents(e);var i=this.inline.format({tag:"a"});this._setLinkData(i,t,"inserted")},_insertSingle:function(t,e){var i=this.selection.getInline();if(1===t.length&&t[0].textContext===this.selection.getText()||i&&"A"===i.tagName){var n=$R.create("link.component",this.app,t[0]);return n.setData(e),this.caret.setAfter(n),this.app.broadcast("link.inserted",n),!0}return!1},_setLinkData:function(t,e,i){e.text=""===e.text.trim()?this._truncateText(e.url):e.text;var n=!this.currentText||this.currentText!==e.text;this.selection.save();for(var s=0;s<t.length;s++){var r=$R.create("link.component",this.app,t[s]),o={};e.text&&n&&(o.text=e.text),e.url&&(o.url=e.url),e.title!==undefined&&(o.title=e.title),e.target!==undefined&&(o.target=e.target),r.setData(o),this.app.broadcast("link."+i,r)}setTimeout(this.selection.restore.bind(this.selection),0)},_deleteContents:function(t){var e=this.selection.getHtml(),i=this.utils.parseHtml(e).nodes[0];if(i&&3!==i.nodeType){var n=i.tagName.toLowerCase(),s=document.createElement(n);this.insertion.insertNode(s,"start")}else t.deleteContents()},_getModalData:function(){var t;return t=this._isLink()?{update:{title:this.lang.get("save")},unlink:{title:this.lang.get("unlink"),type:"danger"},cancel:{title:this.lang.get("cancel")}}:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}},{name:"link",title:this._isLink()?this.lang.get("link-edit"):this.lang.get("link-insert"),handle:this._isLink()?"update":"insert",commands:t}},_isLink:function(){return this.currentLink},_isCurrentTextChanged:function(t){return this.currentText&&this.currentText!==t.text},_buildCurrent:function(){var t,e=this._getCurrent(),i=this.inspector.parse(e);if(i.isLink()||i.isFile())this.currentLink=!0,t=i.isFile()?i.getFile():i.getLink(),t=$R.create("link.component",this.app,t);else{this.currentLink=!1,t=$R.create("link.component",this.app);var n={text:this.selection.getText()};t.setData(n)}return t},_getCurrent:function(){return this.selection.getInlinesAllSelected({tags:["a"]})[0]},_getLinks:function(){for(var t=this.selection.getInlines({all:!0,tags:["a"]}),e=[],i=0;i<t.length;i++){var n=this.inspector.parse(t[i]);(n.isLink()||n.isFile())&&e.push(t[i])}return e},_resetCurrent:function(){this.isCurrentLink=!1,this.currentText=!1},_truncateText:function(t){return t&&t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},_validateData:function(t,e){return""!==e.url.trim()||t.setError("url")},_setFormFocus:function(t){t.getField("url").focus()},_setFormData:function(t,e){var i=this.$link.getData(),n={url:i.url,text:i.text,title:i.title,target:this.opts.linkTarget||i.target};this.opts.linkNewTab||e.find(".form-item-target").hide(),this.opts.linkTitle||e.find(".form-item-title").hide(),t.setData(n),this.currentText=t.getField("text").val()}}),$R.add("class","link.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,this.reUrl=/^(?:(?:(?:https?|ftp):)?\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i,e&&e.cmnt!==undefined?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["url","text","target","title"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},_init:function(t){var e=$R.dom(t);t===undefined?this.parse("<a>"):this.parse(e)},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_get_target:function(){return!!this.attr("target")&&this.attr("target")},_get_url:function(){return this.attr("href")},_get_title:function(){return this.attr("title")},_get_text:function(){return this._getContext().text()},_getContext:function(){return this._findDeepestChild(this).element},_set_target:function(t){!1===t?this.removeAttr("target"):t&&this.attr("target",!0===t?"_blank":t)},_set_text:function(t){this._getContext().html(t)},_set_title:function(t){t&&""!==t?this.attr("title",t):this.removeAttr("title")},_set_url:function(t){this.opts.linkValidation&&(t=this._cleanUrl(t),this._isMailto(t)?t="mailto:"+t.replace("mailto:",""):this._isUrl(t)&&-1===t.search(/^(ftp|https?)/i)&&(t="http://"+t.replace(/(ftp|https?):\/\//i,""))),this.attr("href",t)},_isMailto:function(t){return-1!==t.search("@")&&!1===/(ftp|https?):\/\//i.test(t)},_isUrl:function(t){return this.reUrl.test(t)},_cleanUrl:function(t){return(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")).trim().replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,"")},_findDeepestChild:function(n){var s={depth:0,element:n};return n.children().each(function(t){var e=$R.dom(t);if(t.outerHTML===n.html()){var i=this._findDeepestChild(e);i.depth+1>s.depth&&(s={depth:1+i.depth,element:i.element})}}.bind(this)),s}}),$R.add("module","modal",{init:function(t){this.app=t,this.uuid=t.uuid,this.lang=t.lang,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.utils=t.utils,this.editor=t.editor,this.animate=t.animate,this.detector=t.detector,this.selection=t.selection,this.$box=!1,this.$modal=!1,this.selectionMarkers=!1,this.defaults={name:!1,url:!1,title:!1,width:"600px",height:!1,handle:!1,commands:!1}},build:function(t){this._open(t)},close:function(){this._close()},onstop:function(){this.$body.find("#redactor-modal-"+this.uuid).remove(),this.$body.find("#redactor-overlay-"+this.uuid).remove()},stop:function(){this.$box&&(this.$box.remove(),this.$box=!1,this.$modal=!1),this.$overlay&&this.$overlay.remove(),this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal")},resize:function(){this.$modal.setWidth(this.p.width),this.$modal.updatePosition()},_isOpened:function(){return this.$modal&&this.$modal.hasClass("open")},_open:function(t){this._buildDefaults(t),this.p.url?this._openUrl():this._openTemplate()},_openUrl:function(){$R.ajax.post({url:this.p.url,success:this._doOpen.bind(this)})},_openTemplate:function(){if("undefined"!=typeof $R.modals[this.p.name]){var t=this.lang.parse($R.modals[this.p.name]);this._doOpen(t)}},_doOpen:function(t){this.stop(),this.selection.isCollapsed()?(this.selection.save(),this.selectionMarkers=!1):(this.selection.saveMarkers(),this.selectionMarkers=!0),this.detector.isDesktop()||document.activeElement.blur(),this._createModal(t),this._buildModalBox(),this._buildOverlay(),this._buildModal(),this._buildModalForm(),this._buildModalCommands(),this._broadcast("open"),this.$modal.updatePosition(),this._buildModalTabs(),this.animate.start(this.$box,"fadeIn",this._opened.bind(this)),this.animate.start(this.$overlay,"fadeIn")},_opened:function(){this.$modal.addClass("open"),this.$box.on("mousedown.redactor.modal",this._close.bind(this)),this.$doc.on("keyup.redactor.modal",this._handleEscape.bind(this)),this.$win.on("resize.redactor.modal",this.resize.bind(this)),this.$modal.getBody().find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor.modal",this._handleEnter.bind(this)),window.jQuery&&jQuery(document).off("focusin.modal"),this._broadcast("opened")},_close:function(t){if(this.$box&&this._isOpened()){if(t){if(!this._needToClose(t.target))return;t.stopPropagation(),t.preventDefault()}this.selectionMarkers?this.selection.restoreMarkers():this.selection.restore(),this.selectionMarkers=!1,this._broadcast("close"),this.animate.start(this.$box,"fadeOut",this._closed.bind(this)),this.animate.start(this.$overlay,"fadeOut")}},_closed:function(){this.$modal.removeClass("open"),this.$box.off(".redactor.modal"),this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal"),this._broadcast("closed")},_createModal:function(t){this.$modal=$R.create("modal.element",this.app,t)},_broadcast:function(t){this.app.broadcast("modal."+t,this.$modal,this.$modalForm),this.app.broadcast("modal."+this.p.name+"."+t,this.$modal,this.$modalForm)},_buildDefaults:function(t){this.p=$R.extend({},this.defaults,t)},_buildModalBox:function(){this.$box=$R.dom("<div>"),this.$box.attr("id","redactor-modal-"+this.uuid),this.$box.addClass("redactor-modal-box redactor-animate-hide"),this.$box.html(""),this.$body.append(this.$box)},_buildOverlay:function(){this.$overlay=$R.dom("#redactor-overlay-"+this.uuid),0===this.$overlay.length&&(this.$overlay=$R.dom("<div>"),this.$overlay.attr("id","redactor-overlay-"+this.uuid),this.$overlay.addClass("redactor-overlay redactor-animate-hide"),this.$body.prepend(this.$overlay))},_buildModal:function(){this.$box.append(this.$modal),this.$modal.setTitle(this.p.title),this.$modal.setHeight(this.p.height),this.$modal.setWidth(this.p.width)},_buildModalCommands:function(){if(this.p.commands){var t=this.p.commands,e=this.$modal.getFooter();for(var i in t){var n=$R.dom("<button>");n.html(t[i].title),n.attr("data-command",i),"cancel"===i&&(n.attr("data-action","close"),n.addClass("redactor-button-unstyled")),"undefined"!=typeof t[i].type&&"danger"===t[i].type&&n.addClass("redactor-button-danger"),n.on("click",this._handleCommand.bind(this)),e.append(n)}}},_buildModalTabs:function(){var t=this.$modal.getBody(),e=t.find(".redactor-modal-tab"),s=t.find(".redactor-modal-tabs");1<e.length&&((s=0===s.length?$R.dom("<div>"):s.html("")).addClass("redactor-modal-tabs"),e.each(function(t,e){var i=$R.dom(t),n=$R.dom("<a>");n.attr("href","#"),n.attr("rel",e),n.text(i.attr("data-title")),n.on("click",this._showTab.bind(this)),0===e&&n.addClass("active"),s.append(n)}.bind(this)),t.prepend(s)),1===e.length&&e.show()},_buildModalForm:function(){this.$modalForm=$R.create("modal.form",this.app,this.$modal.getForm())},_showTab:function(t){t.preventDefault();var e=$R.dom(t.target),i=e.attr("rel"),n=this.$modal.getBody(),s=n.find(".redactor-modal-tab");s.hide(),s.eq(i).show(),n.find(".redactor-modal-tabs a").removeClass("active"),e.addClass("active")},_needToClose:function(t){var e=$R.dom(t);return!("close"!==e.attr("data-action")&&!this.$modal.isCloseNode(t)&&0!==e.closest(".redactor-modal").length)},_handleCommand:function(t){var e=$R.dom(t.target).closest("button").attr("data-command");"cancel"!==e&&t.preventDefault(),this._broadcast(e)},_handleEnter:function(t){13===t.which&&this.p.handle&&(t.preventDefault(),this._broadcast(this.p.handle))},_handleEscape:function(t){27===t.which&&this._close()}}),$R.add("class","modal.element",{mixins:["dom"],init:function(t,e){this.app=t,this.opts=t.opts,this.$win=t.$win,this._init(e)},getForm:function(){return this.find("form")},getHeader:function(){return this.$modalHeader},getBody:function(){return this.$modalBody},getFooter:function(){return this.$modalFooter},setTitle:function(t){t&&this.$modalHeader.html(t)},setWidth:function(t){t=parseInt(t)>=this.$win.width()?"96%":t,this.css("max-width",t)},setHeight:function(t){!1!==t&&this.$modalBody.css("height",t)},updatePosition:function(){var t=this.width();this.css({left:"50%","margin-left":"-"+t/2+"px"});var e=this.$win.height(),i=this.height(),n=e/2-i/2;i<e&&0!==n&&this.css("margin-top",n+"px")},isCloseNode:function(t){return t===this.$modalClose.get()},_init:function(t){this._build(),this._buildClose(),this._buildHeader(),this._buildBody(),this._buildFooter(),this._buildTemplate(t)},_build:function(){this.parse("<div>"),this.addClass("redactor-modal"),this.attr("dir",this.opts.direction)},_buildClose:function(){this.$modalClose=$R.dom("<span>"),this.$modalClose.addClass("redactor-close"),this.append(this.$modalClose)},_buildHeader:function(){this.$modalHeader=$R.dom("<div>"),this.$modalHeader.addClass("redactor-modal-header"),this.append(this.$modalHeader)},_buildBody:function(){this.$modalBody=$R.dom("<div>"),this.$modalBody.addClass("redactor-modal-body"),this.append(this.$modalBody)},_buildFooter:function(){this.$modalFooter=$R.dom("<div>"),this.$modalFooter.addClass("redactor-modal-footer"),this.append(this.$modalFooter)},_buildTemplate:function(t){this.$modalBody.html(t)}}),$R.add("class","modal.form",{mixins:["dom"],init:function(t,e){this.app=t,this.build(e)},build:function(t){this.parse(t)},getData:function(){var i={};return this.find("[name]").each(function(t){var e=$R.dom(t);i[e.attr("name")]=e.val()}),i},setData:function(n){this.find("[name]").each(function(t){var e=$R.dom(t),i=e.attr("name");n.hasOwnProperty(i)&&(t.type&&"checkbox"===t.type?t.checked=n[i]:e.val(n[i]))})},getField:function(t){return this.find("[name="+t+"]")},setError:function(t){var e=this.getField(t);return e.addClass("error"),e.one(this._getFieldEventName(e.get()),this._clearError),!1},_clearError:function(){return $R.dom(this).removeClass("error")},_getFieldEventName:function(t){return"SELECT"===t.tagName||"checkbox"===t.type||"radio"===t.type?"change":"keyup"}}),$R.add("module","block",{init:function(t){this.app=t,this.block=t.block},format:function(t){var e=this.block.format(t);this.app.broadcast("format","block",e)},clearformat:function(){this.block.clearFormat()},clearstyle:function(){this.block.clearStyle()},clearclass:function(){this.block.clearClass()},clearattr:function(){this.block.clearAttr()},add:function(t,e){this.block.add(t,e)},toggle:function(t,e){this.block.toggle(t,e)},set:function(t,e){this.block.set(t,e)},remove:function(t,e){this.block.remove(t,e)}}),$R.add("module","inline",{init:function(t){this.app=t,this.inline=t.inline},format:function(t){var e=this.inline.format(t);this.app.broadcast("format","inline",e)},clearformat:function(){this.inline.clearFormat()},clearstyle:function(){this.inline.clearStyle()},clearclass:function(){this.inline.clearClass()},clearattr:function(){this.inline.clearAttr()},add:function(t,e){this.inline.add(t,e)},toggle:function(t,e){this.inline.toggle(t,e)},set:function(t,e){this.inline.set(t,e)},remove:function(t,e){this.inline.remove(t,e)}}),$R.add("module","autosave",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.source=t.source},onsynced:function(){this.opts.autosave&&this._send()},_send:function(){var e=this.opts.autosaveName?this.opts.autosaveName:this.source.getName(),i={};i[e]=this.source.getCode(),i=this.utils.extendData(i,this.opts.autosaveData),$R.ajax.post({url:this.opts.autosave,data:i,success:function(t){this._complete(t,e,i)}.bind(this)})},_complete:function(t,e,i){var n=t&&t.error?"autosaveError":"autosave";this.app.broadcast(n,e,i,t)}}),$R.add("module","input",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.editor=t.editor,this.keycodes=t.keycodes,this.element=t.element,this.selection=t.selection,this.insertion=t.insertion,this.inspector=t.inspector,this.autoparser=t.autoparser,this.lastShiftKey=!1},onpaste:function(t,e){if(this.opts.input)return $R.create("input.paste",this.app,t,e)},onkeydown:function(t){if(this.opts.input){var e=t.which;if(!$R.create("input.shortcut",this.app,t).is()){if((t.ctrlKey||t.metaKey)&&!t.altKey&&65===e)return t.preventDefault(),this._selectAll();var i=[this.keycodes.ENTER,this.keycodes.SPACE,this.keycodes.BACKSPACE,this.keycodes.DELETE],n=[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.LEFT,this.keycodes.RIGHT],s=-1!==i.indexOf(e),r=-1!==n.indexOf(e),o=(t.ctrlKey||t.metaKey)&&88===e,a=!t.ctrlKey&&!t.metaKey&&(48<=e&&e<=57||65<=e&&e<=90);if(this.selection.isAll()&&r&&(o||!t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.shiftKey)){if(o)return this.editor.disableNonEditables(),void this.app.broadcast("empty");if(this._isArrowKey(e))return!0;if(s&&t.preventDefault(),this.element.isType("inline"))this.editor.getElement().html(""),this.editor.startFocus();else this.insertion.set(this.opts.emptyHtml);if(s)return;this.app.broadcast("empty")}if(this.opts.autoparse&&this.autoparser.format(t,e),!a||!this.selection.hasNonEditable())return e===this.keycodes.ENTER?$R.create("input.enter",this.app,t,e):t.metaKey&&219===e?(t.preventDefault(),void this.app.api("module.list.outdent")):e===this.keycodes.TAB||t.metaKey&&221===e?$R.create("input.tab",this.app,t,e):e===this.keycodes.SPACE?$R.create("input.space",this.app,t,e,this.lastShiftKey):this._isDeleteKey(e)?$R.create("input.delete",this.app,t,e):this._isArrowKey(e)?$R.create("input.arrow",this.app,t,e):void 0;t.preventDefault()}}},onkeyup:function(t){if(this.opts.input){var e=t.which;if(this.lastShiftKey=t.shiftKey,this.app.broadcast("contextbar.close"),!$R.create("input.shortcode",this.app,t,e).is()){if(e===this.keycodes.BACKSPACE){var i=this.editor.getElement(),n=this.utils.trimSpaces(i.html());if(""===(n=(n=n.replace(/<br\s?\/?>/g,"")).replace(/<div><\/div>/,"")))return t.preventDefault(),this.editor.setEmpty(),void this.editor.startFocus()}this.editor.isEmpty()&&this.app.broadcast("empty")}}},start:function(){this.opts.shortcutsAdd&&(this.opts.shortcuts=$R.extend({},!0,this.opts.shortcuts,this.opts.shortcutsAdd))},_selectAll:function(){var t,e=this.selection.getCurrent(),i=this.inspector.parse(e);return i.isComponentType("table")?(t=i.getTable(),void this.selection.setAll(t)):i.isComponentType("code")?(t=i.getComponentCodeElement(),void this.selection.setAll(t)):void this.selection.setAll()},_isArrowKey:function(t){return-1!==[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(t)},_isDeleteKey:function(t){return t===this.keycodes.BACKSPACE||t===this.keycodes.DELETE}}),$R.add("class","input.arrow",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.offset=t.offset,this.marker=t.marker,this.editor=t.editor,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.key=i,this._init(e)},_init:function(t){if(!this._isRightLeftKey()||!this._isExitVariable(t)){if(this._isRightDownKey()){if(this._isExitOnDownRight(t))return;if(this._selectComponent(t,"End","next"))return}if(this._isLeftUpKey()){if(this._isExitOnUpLeft(t))return;if(this._selectComponent(t,"Start","prev"))return}this.key===this.keycodes.LEFT?this.utils.trimInvisibleChars("left"):this.key===this.keycodes.RIGHT&&this.utils.trimInvisibleChars("right")}},_isRightDownKey:function(){return-1!==[this.keycodes.DOWN,this.keycodes.RIGHT].indexOf(this.key)},_isLeftUpKey:function(){return-1!==[this.keycodes.UP,this.keycodes.LEFT].indexOf(this.key)},_isRightLeftKey:function(){return-1!==[this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(this.key)},_isExitVariable:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),n=i.getComponent();if(i.isComponentType("variable")&&i.isComponentActive()){t.preventDefault();var s=this.key===this.keycodes.LEFT?"setBefore":"setAfter";this.caret[s](n)}else;},_isExitOnUpLeft:function(t){var e=this.selection.getCurrent(),i=this.selection.getBlock(e),n=this.inspector.parse(e),s=i.previousElementSibling,r=this.caret.isStart(i);if(r&&s&&"TABLE"===s.tagName)return t.preventDefault(),this.caret.setEnd(s),!0;if(n.isFigcaption()){i=n.getFigcaption(),r=this.caret.isStart(i);var o=$R.dom(i).closest(".redactor-component");if(r&&0!==o.length)return t.preventDefault(),this.caret.setEnd(o),!0}else{if(n.isTable()&&r)return t.preventDefault(),this.caret.setEnd(i.previousElementSibling),!0;if(!n.isComponentEditable()&&n.isComponent()&&!n.isComponentType("variable")){var a=n.getComponent();if(!a.previousElementSibling)return t.preventDefault(),this.component.clearActive(),this._exitPrevElement(t,n.getComponent());if(a.previousElementSibling)return t.preventDefault(),this.component.clearActive(),this.caret.setEnd(a.previousElementSibling),!0}}},_isExitOnDownRight:function(t){var e,i,n=this.editor.getElement(),s=this.selection.getCurrent(),r=this.inspector.parse(s),o=this.caret.isEnd();if(r.isTable()){if(e=r.getTable(),(i=this.caret.isEnd(e))||o)return this._exitNextElement(t,r.getComponent())}else if(r.isFigcaption()){if(e=r.getFigcaption(),(i=this.caret.isEnd(e))||o)return this._exitNextElement(t,r.getComponent())}else if(r.isComponentType("code")){var a=r.getComponent(),l=$R.dom(r.getComponentCodeElement()).closest("pre");i=this.caret.isEnd(e);var c=l&&l.get().nextElementSibling;if(i&&!c)return this._exitNextElement(t,a)}else if(r.isPre()||r.isBlockquote()||r.isDl()){if(o){if(r.isPre())return this._exitNextElement(t,r.getPre());if(r.isBlockquote())return this._exitNextElement(t,r.getBlockquote());if(r.isDl())return this._exitNextElement(t,r.getDl())}}else if(r.isList()){var d=$R.dom(s).parents("ul, ol",n).last();if((i=this.caret.isEnd(d))||o)return this._exitNextElement(t,d.get())}else if(r.isComponent()&&!r.isComponentType("variable")&&"span"!==r.getTag())return this.component.clearActive(),this._exitNextElement(t,r.getComponent())},_exitPrevElement:function(t,e){return t.preventDefault(),e.previousElementSibling?this.caret.setEnd(e.previousElementSibling):this.utils.createMarkupBefore(e),!0},_exitNextElement:function(t,e){return t.preventDefault(),e.nextElementSibling?this.caret.setStart(e.nextElementSibling):this.utils.createMarkup(e),!0},_selectComponent:function(t,e,i){var n=this.selection.getCurrent(),s=this.selection.getBlock(n),r=this.utils.findSiblings(n,i),o=this.utils.findSiblings(s,i);r&&this.caret["is"+e](n)?this._selectComponentItem(t,r,e):o&&this.caret["is"+e](s)&&this._selectComponentItem(t,o,e)},_selectComponentItem:function(t,e,i){if(this.component.isNonEditable(e))return t.preventDefault(),this.caret["set"+i](e),!0}}),$R.add("class","input.delete",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.marker=t.marker,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.insertion=t.insertion,this.key=i,this._init(e)},_init:function(t){if(!this._removeActiveComponent(t)&&!this._removeAllSelectedTable(t)){if(this.key===this.keycodes.BACKSPACE){var e=this.editor.getElement();if(this.utils.trimSpaces(e.html())===this.opts.emptyHtml)return void t.preventDefault()}if(this._detectVariableOrNonEditable()||this.selection.hasNonEditable())t.preventDefault();else{if(this.selection.isAll())return t.preventDefault(),void this.insertion.set(this.opts.emptyHtml);this.selection.isCollapsed()&&(this.key===this.keycodes.BACKSPACE?this._traverseBackspace(t):this.key===this.keycodes.DELETE&&this._traverseDelete(t)),this.key===this.keycodes.BACKSPACE&&this.utils.trimInvisibleChars("left"),this._removeUnwantedStyles(),this._removeEmptySpans(),this._removeSpanTagsInHeadings(),this._removeInlineTagsInPre()}}},_detectVariableOrNonEditable:function(){var t,e=this.selection.getBlock(),i=this.caret.isStart(e),n=this.caret.isEnd(e);if(this.key===this.keycodes.BACKSPACE&&i){if(t=e.previousSibling,this._isNonEditable(t))return!0}else if(this.key===this.keycodes.DELETE&&n&&(t=e.nextSibling,this._isNonEditable(t)))return!0;var s=this.selection.getCurrent(),r=this.caret.isStart(s),o=this.caret.isEnd(s),a=""===this.selection.getTextBeforeCaret().trim(),l=""===this.selection.getTextAfterCaret().trim();if(this.key===this.keycodes.BACKSPACE&&r&&!a){if(t=s.previousSibling,this._isVariable(t))return this.caret.setEnd(t),!0;if(this._isNonEditable(t))return!0}else if(this.key===this.keycodes.DELETE&&o&&!l){if(t=s.nextSibling,this._isVariable(t))return this.caret.setStart(t),!0;if(this._isNonEditable(t))return!0}},_isVariable:function(t){return 0!==$R.dom(t).closest('[data-redactor-type="variable"]').length},_isNonEditable:function(t){return 0!==$R.dom(t).closest(".non-editable").length},_getBlock:function(){var t=this.editor.getElement(),e=this.selection.getBlock(),i=this.inspector.parse(e);return e=i.isList()?$R.dom(e).parents("ul, ol",t).last().get():e,e=i.isDl()?i.getDl():e,e=i.isTable()?i.getTable():e},_traverseDelete:function(t){var e,i,n,s=this.selection.getCurrent(),r=this.inspector.parse(s);if(r.isFigcaption()){if(e=r.getFigcaption(),i=this.caret.isEnd(e))return void t.preventDefault()}else if(r.isComponentType("code")&&(e=r.getComponent(),i=this.caret.isEnd(e)))return void t.preventDefault();e=this._getBlock();var o=this.utils.findSiblings(e,"next");if(o){i=this.caret.isEnd(e);var a=this.inspector.parse(o),l="P"===o.tagName||"DIV"===o.tagName;if(i&&a.isComponentEditable())return t.preventDefault(),void this.component.remove(o,!1);if(i&&a.isComponent())return t.preventDefault(),this.caret.setStart(o),void(this.utils.isEmptyHtml(e.innerHTML)&&$R.dom(e).remove());if(i&&a.isList()){var c=$R.dom(e);if(n=$R.dom(o),r.isList())return t.preventDefault(),c.append(n),void n.unwrap();var d=n.children("li").first(),h=d.find("ul, ol");if(0!==h.length)return t.preventDefault(),n.prepend(h),h.unwrap(),c.append(d),void d.unwrap()}else if(i&&!r.isList()&&!r.isTable()&&l&&!this.utils.isEmptyHtml(e.innerHTML)){t.preventDefault();var u=$R.dom(e);return n=$R.dom(o),u.append(n),void n.unwrap()}}},_traverseBackspace:function(t){var e,i,n,s,r=this.selection.getCurrent(),o=this.inspector.parse(r);if(o.isFigcaption()){if(e=o.getFigcaption(),i=this.caret.isStart(e))return void t.preventDefault()}else if(o.isComponentType("code")&&(e=o.getComponent(),(i=this.caret.isStart(e))&&e.previousElementSibling))return t.preventDefault(),this.caret.setEnd(e.previousElementSibling),!0;e=this._getBlock();var a=this.utils.findSiblings(e,"prev");if(a){i=this.caret.isStart(e);var l=this.inspector.parse(a),c="P"===a.tagName||"DIV"===a.tagName;if(i&&l.isComponentEditable())return t.preventDefault(),void this.component.remove(a,!1);if(i&&l.isComponent())return t.preventDefault(),this.caret.setStart(a),void(this.utils.isEmptyHtml(e.innerHTML)&&$R.dom(e).remove());if(i&&o.isList())if(t.preventDefault(),s=$R.dom(e),n=$R.dom(a),l.isList())s.children("li").first().prepend(this.marker.build("start")),n.append(s),s.unwrap(),this.selection.restoreMarkers();else{var d=s.children("li").first(),h=d.get(),u=d.find("ul, ol"),p=this.utils.replaceToTag(h,this.opts.markup);this.opts.breakline&&p.attr("data-redactor-tag","br"),s.before(p),this.caret.setStart(p),0!==u.length&&(s.prepend(u),u.unwrap())}else if(i&&c){if(t.preventDefault(),this.utils.isEmpty(a))return void(n=$R.dom(a)).remove();var f=this.utils.createInvisibleChar(),m=$R.dom(e);return n=$R.dom(a),this.caret.setEnd(n),m.prepend(f),n.append(m.contents()),void m.remove()}}else setTimeout(this._replaceBlock.bind(this),1)},_replaceBlock:function(){var t=this.selection.getBlock(),e=$R.dom(t);if("p"===this.opts.markup&&t&&this._isNeedToReplaceBlock(t)){var i=document.createElement(this.opts.markup);e.replaceWith(i),this.caret.setStart(i)}this.opts.breakline&&t&&"DIV"===t.tagName&&e.attr("data-redactor-tag","br")},_isNeedToReplaceBlock:function(t){return"DIV"===t.tagName&&this.utils.isEmptyHtml(t.innerHTML)},_removeActiveComponent:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),n=i.getComponent();if(i.isComponent()&&this.component.isActive(n))return t.preventDefault(),this.component.remove(n),!0},_removeAllSelectedTable:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e).getTable();if(i&&this.selection.isAll(i))return t.preventDefault(),this.component.remove(i),!0},_removeUnwantedStyles:function(){var t=this.editor.getElement();setTimeout(function(){t.find("*[style]").not("img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]").removeAttr("style")},0)},_removeEmptySpans:function(){var t=this.editor.getElement();setTimeout(function(){t.find("span").each(function(t){0===t.attributes.length&&$R.dom(t).replaceWith(t.childNodes)})},0)},_removeSpanTagsInHeadings:function(){var t=this.editor.getElement();setTimeout(function(){t.find("h1, h2, h3, h4, h5, h6").each(function(t){var e=$R.dom(t);0===e.closest("figure").length&&e.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]").unwrap()})},1)},_removeInlineTagsInPre:function(){var t=this.editor.getElement(),i=this.opts.inlineTags;setTimeout(function(){t.find("pre").each(function(t){var e=$R.dom(t);0===e.closest("figure").length&&e.find(i.join(",")).not("code, .redactor-selection-marker").unwrap()})},1)}}),$R.add("class","input.enter",{init:function(t,e){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.editor=t.editor,this.insertion=t.insertion,this.selection=t.selection,this.inspector=t.inspector,this._init(e)},_init:function(t){return this.opts.enterKey?!1===this.app.broadcast("enter",t)?t.preventDefault():this.selection.hasNonEditable()?void t.preventDefault():t.ctrlKey||t.shiftKey?this._insertBreak(t):void(this._isExit(t)||this._traverse(t)):this._disable(t)},_disable:function(t){t.preventDefault();var e=this.selection.getRange();e&&!e.collapsed&&e.deleteContents()},_insertBreak:function(t){t.preventDefault();var e=this.selection.getCurrent(),i=this.inspector.parse(e);i.isComponent()&&!i.isComponentEditable()||i.isCode()||(i.isPre()?this.insertion.insertNewline():this.insertion.insertBreakLine())},_isExit:function(t){var e=this.editor.getElement(),i=this.selection.getBlock(),n=this.inspector.parse(i),s=this.caret.isEnd(i),r=this.selection.getCurrent(),o=r.previousSibling;if(n.isBlockquote()){var a=s&&this._isExitableBlock(i,"P"),l=s&&this._isExitableDblBreak(o);if(a||l)return this._exitFromElement(t,l?o:i,n.getBlockquote())}else if(!n.isComponentType("code")&&n.isPre()){if(s){var c=i.innerHTML;if(null!==(c=this.utils.removeInvisibleChars(c)).match(/(\n\n\n)$/))return $R.dom(o.previousSibling.previousSibling).remove(),this._exitFromElement(t,o,i)}}else if(n.isDl()){if(s&&this._isExitableBlock(i,"DT"))return this._exitFromElement(t,i,n.getDl())}else if(n.isList()){var d=$R.dom(r).parents("ul, ol",e).last();if((s=this.caret.isEnd(d))&&this._isExitableBlock(i,"LI"))return this._exitFromElement(t,i,d)}else if(n.isComponent()&&n.isComponentActive()&&!n.isFigcaption()&&!n.isComponentEditable())return this._exitFromElement(t,!1,n.getComponent())},_isExitableDblBreak:function(t){var e=!!t&&t.nextSibling;if(e){var i=this.utils.removeInvisibleChars(e.textContent);return 3===e.nodeType&&""===i.trim()}},_isExitableBlock:function(t,e){return t&&t.tagName===e&&this.utils.isEmptyHtml(t.innerHTML)},_exitFromElement:function(t,e,i){return t.preventDefault(),e&&$R.dom(e).remove(),this.utils.createMarkup(i),!0},_exitNextElement:function(t,e){return t.preventDefault(),e.nextSibling?this.caret.setStart(e.nextSibling):this.utils.createMarkup(e),!0},_traverse:function(t){var e=this.selection.getCurrent(),i=this.selection.isText(),n=this.selection.getBlock(),s=this.inspector.parse(e),r=!!n&&n.tagName.toLowerCase(),o=$R.dom(e).closest("[data-redactor-type=variable]");if(0!==o.length&&this.caret.setAfter(o),s.isPre())return t.preventDefault(),this.insertion.insertNewline();if(s.isBlockquote())return(n=this.selection.getBlock(e))&&"BLOCKQUOTE"===n.tagName?(t.preventDefault(),this.insertion.insertBreakLine()):void 0;if(s.isFigcaption()){n=s.getFigcaption();var a=this.caret.isEnd(n),l=this.caret.isEnd();return a||l?this._exitNextElement(t,s.getComponent()):void t.preventDefault()}return s.isDl()?(t.preventDefault(),this._traverseDl(e)):this.opts.breakline&&"div"===r?void setTimeout(this._replaceBlock.bind(this),1):i?(t.preventDefault(),this.insertion.insertBreakLine()):void setTimeout(this._replaceBlock.bind(this),1)},_traverseDl:function(t){var e=this.selection.getBlock(t),i=this.inspector.parse(e).getTag(),n=$R.dom(e),s=n.get().nextSibling||!1,r=$R.dom(s),o=s&&r.is("dd"),a=s&&r.is("dt"),l=this.caret.isEnd(e);if("dt"===i&&!o&&l){var c=document.createElement("dd");return n.after(c),void this.caret.setStart(c)}if("dd"!==i||a||!l)return this.insertion.insertBreakLine();var d=document.createElement("dt");return n.after(d),void this.caret.setStart(d)},_replaceBlock:function(){var t=this.selection.getBlock(),e=$R.dom(t);if(
"p"===this.opts.markup&&t&&this._isNeedToReplaceBlock(t)){var i=document.createElement(this.opts.markup);e.replaceWith(i),this.caret.setStart(i)}else if(t)if(this.utils.isEmptyHtml(t.innerHTML))this._clearBlock(e,t);else{var n=this.utils.getFirstNode(t);n&&"BR"===n.tagName&&($R.dom(n).remove(),this.caret.setStart(t))}t&&this._isNeedToCleanBlockStyle(t)&&this.opts.cleanOnEnter&&e.removeAttr("class style"),this.opts.breakline&&t&&"DIV"===t.tagName&&e.attr("data-redactor-tag","br")},_clearBlock:function(t,e){(this.opts.cleanInlineOnEnter||"<br>"===e.innerHTML)&&t.html(""),this.caret.setStart(e)},_isNeedToReplaceBlock:function(t){return"DIV"===t.tagName&&this.utils.isEmptyHtml(t.innerHTML)},_isNeedToCleanBlockStyle:function(t){return"P"===t.tagName&&this.utils.isEmptyHtml(t.innerHTML)}}),$R.add("class","input.paste",{init:function(t,e,i,n,s){this.app=t,this.opts=t.opts,this.editor=t.editor,this.cleaner=t.cleaner,this.container=t.container,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.autoparser=t.autoparser,this.pasteHtml=n,this.pointInserted=s,this.dataTransfer=i,this._init(e)},_init:function(t){var e,i=this.dataTransfer||t.clipboardData,n=this.selection.getCurrent(),s=this.inspector.parse(n);if(this.dropPasted=this.dataTransfer,this.isRawCode=s.isPre()||s.isCode(),this.editor.enablePasting(),this.editor.saveScroll(),this.dropPasted||this.selection.saveMarkers(),this.isRawCode||!i)return e=this.isRawCode||i||!window.clipboardData?i.getData("text/plain"):window.clipboardData.getData("text"),t.preventDefault(),void this._insert(t,e);if(this.pasteHtml)t.preventDefault(),this._insert(t,this.pasteHtml);else{var r=i.getData("URL"),o=this._isPlainText(i)?i.getData("text/plain"):i.getData("text/html");if(o=r&&""!==r?r:o,null!==i.files&&0<i.files.length&&""===o){for(var a=[],l=0;l<i.files.length;l++){var c=i.files[l]||i.items[l].getAsFile();c&&a.push(c)}if(0<a.length)return t.preventDefault(),void this._insertFiles(t,a)}t.preventDefault(),this._insert(t,o)}},_isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");if(!e||!i)return null!==e;var n=document.createElement("div");return n.innerHTML=i,n.textContent===e?!n.querySelector(":not(meta)"):void 0},_restoreSelection:function(){this.editor.restoreScroll(),this.editor.disablePasting(),this.dropPasted||this.selection.restoreMarkers()},_insert:function(t,e){var i=this.app.broadcast("pasteBefore",e);if(e=(e=i===undefined?e:i).trim(),e=(e=this.isRawCode?e:this.cleaner.paste(e)).trim(),e=this.isRawCode?this.cleaner.encodePhpCode(e):e,e=(i=this.app.broadcast("pasting",e))===undefined?e:i,this._restoreSelection(),this.opts.input){var n=[];if(this.isRawCode){var s=document.createTextNode(e);n=this.insertion.insertNode(s,"after"),this.app.broadcast("pasted",n)}else this.opts.autoparse&&this.opts.autoparsePaste&&(e=this.autoparser.parse(e)),n=this.dropPasted?this.insertion.insertToPoint(t,e,this.pointInserted):this.insertion.insertHtml(e),this.app.broadcast("pasted",n),this.app.broadcast("autoparseobserve")}},_insertFiles:function(t,e){this._restoreSelection();var i=-1!==this.opts.imageTypes.indexOf(e[0].type),n="undefined"==typeof this.dropPasted;i?this.app.broadcast("dropimage",t,e,n):this.app.broadcast("dropfile",t,e,n)}}),$R.add("class","input.shortcode",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.marker=t.marker,this.keycodes=t.keycodes,this.selection=t.selection,this.worked=!1,i===this.keycodes.SPACE&&this._init()},is:function(){return this.worked},_init:function(){var t=this.selection.getCurrent();if(t&&3===t.nodeType){var e=this.utils.removeInvisibleChars(t.textContent),i=this.opts.shortcodes;for(var n in i){var s=new RegExp("^"+this.utils.escapeRegExp(n));if(null!==e.match(s)&&"undefined"!=typeof i[n].format)return this._format(i[n].format,t,s)}}},_format:function(t,e,i){var n=(e=this.marker.insert("start").previousSibling).textContent;n=(n=this.utils.trimSpaces(n)).replace(i,""),e.textContent=n;var s="ul"===t||"ol"===t?"module.list.toggle":"module.block.format";this.app.api(s,t),this.selection.restoreMarkers(),this.worked=!0}}),$R.add("class","input.shortcut",{init:function(t,e){this.app=t,this.opts=t.opts,this.worked=!1,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},this._init(e)},is:function(){return this.worked},_init:function(t){if(!1!==this.opts.shortcuts)for(var e in this.opts.shortcuts)this._build(t,e,this.opts.shortcuts[e]);else!t.ctrlKey&&!t.metaKey||66!==t.which&&73!==t.which||t.preventDefault()},_build:function(t,e,i){for(var n=e.split(","),s=n.length,r=0;r<s;r++)"string"==typeof n[r]&&this._handler(t,n[r].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var n=this.hotkeys[t.keyCode],s=String.fromCharCode(t.which).toLowerCase(),r="",o={},a=["meta","ctrl","alt","shift"],l=0;l<a.length;l++){var c=a[l];t[c+"Key"]&&n!==c&&(r+=c+"+")}n&&(o[r+n]=!0),s&&(o[r+s]=!0,o[r+this.hotkeysShiftNums[s]]=!0,"shift+"===r&&(o[this.hotkeysShiftNums[s]]=!0));var d=e.length;for(l=0;l<d;l++)if(o[e[l]])return t.preventDefault(),this.worked=!0,void(i.message?(this.app.broadcast(i.message,i.args),this.app.broadcast("buffer.trigger")):i.api&&(this.app.api(i.api,i.args),this.app.broadcast("buffer.trigger")))}}),$R.add("class","input.space",{init:function(t,e,i,n){this.app=t,this.keycodes=t.keycodes,this.insertion=t.insertion,this.selection=t.selection,this.key=i,this.lastShiftKey=n,this._init(e)},_init:function(t){if(!this.selection.hasNonEditable())return this.lastShiftKey||this.key!==this.keycodes.SPACE||!t.ctrlKey&&!t.shiftKey||t.metaKey?void 0:(t.preventDefault(),void this.insertion.insertChar("&nbsp;"));t.preventDefault()}}),$R.add("class","input.tab",{init:function(t,e){this.app=t,this.opts=t.opts,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this._init(e)},_init:function(t){if(this.opts.tabKey){if(!1===this.app.broadcast("tab",t))return t.preventDefault();this._traverse(t)}},_traverse:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);return!i.isComponent()&&t.shiftKey?this._insertHardTab(t,4):i.isList()?(t.preventDefault(),this.app.api("module.list.indent")):i.isPre()||i.isComponentType("code")&&!i.isFigcaption()?this._tabCode(t):!1!==this.opts.tabAsSpaces?this._insertHardTab(t,this.opts.tabAsSpaces):void 0},_insertHardTab:function(t,e){t.preventDefault();var i=document.createTextNode(Array(e+1).join("\xa0"));return this.insertion.insertNode(i,"end")},_tabCode:function(t){t.preventDefault();var e=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join("\xa0")):document.createTextNode("\t");return this.insertion.insertNode(e,"end")}}),$R.add("module","upload",{init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.utils=t.utils,this.editor=t.editor,this.progress=t.progress,this.defaults={event:!1,element:!1,name:!1,files:!1,url:!1,data:!1,paramName:!1}},build:function(t){this.p=$R.extend(this.defaults,t),this.$el=$R.dom(this.p.element),"INPUT"===this.$el.get().tagName?this._buildInput():this._buildBox()},send:function(t){this.p=$R.extend(this.defaults,t),this.$uploadbox=this.editor.getElement(),this._send(this.p.event,this.p.files)},complete:function(t,e){this._complete(t,e)},_buildInput:function(){this.box=!1,this.prefix="",this.$uploadbox=$R.dom('<div class="upload-redactor-box" />'),this.$el.hide(),this.$el.after(this.$uploadbox),this.opts.multipleUpload?this.$el.attr("multiple","multiple"):this.$el.removeAttr("multiple"),"file"!==this.p.name&&this.$el.attr("accept","image/*"),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.box=!0,this.prefix="box-",this.$uploadbox=this.$el,this.$uploadbox.attr("ondragstart","return false;"),this.$uploadbox.on("drop.redactor.upload",this._onDropBox.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_buildPlaceholder:function(){this.$placeholder=$R.dom('<div class="upload-redactor-placeholder" />'),this.$placeholder.html(this.lang.get("upload-label")),this.$uploadbox.append(this.$placeholder)},_buildEvents:function(){this.$el.on("change.redactor.upload",this._onChange.bind(this)),this.$uploadbox.on("click.redactor.upload",this._onClick.bind(this)),this.$uploadbox.on("drop.redactor.upload",this._onDrop.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_onClick:function(t){t.preventDefault(),this.$el.click()},_onChange:function(t){this._send(t,this.$el.get().files)},_onDrop:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this._send(t)},_onDragOver:function(t){return t.preventDefault(),this._setStatusHover(),!1},_onDragLeave:function(t){return t.preventDefault(),this._removeStatusHover(),!1},_onDropBox:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this._send(t)},_removeStatusHover:function(){this.$uploadbox.removeClass("upload-redactor-"+this.prefix+"hover")},_setStatusDrop:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"drop")},_setStatusHover:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"hover")},_setStatusError:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"error")},_setStatusSuccess:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"success")},_clear:function(){for(var t=["drop","hover","error","success"],e=0;e<t.length;e++)this.$uploadbox.removeClass("upload-redactor-"+this.prefix+t[e]);this.$uploadbox.removeAttr("ondragstart")},_send:function(t,e){t=t.originalEvent||t,e=e||t.dataTransfer.files;var i=new FormData,n=this._getUploadParam();i=this._buildData(n,e,i),i=this.utils.extendData(i,this.p.data),!1!==this.app.broadcast("upload.start",t,i,e)&&this._sendData(i,e,t)},_sendData:function(t,e,i){if(this.progress.show(),"function"==typeof this.p.url){var n=this.p.url(t,e,i,this);n instanceof Promise||this._complete(n,i)}else $R.ajax.post({url:this.p.url,data:t,before:function(t){return this.app.broadcast("upload.beforeSend",t)}.bind(this),success:function(t){this._complete(t,i)}.bind(this)})},_getUploadParam:function(){return this.p.paramName?this.p.paramName:"file"},_buildData:function(t,e,i){if(1===e.length)i.append(t+"[]",e[0]);else if(1<e.length&&!1!==this.opts.multipleUpload)for(var n=0;n<e.length;n++)i.append(t+"[]",e[n]);return i},_complete:function(t,e){this._clear(),this.progress.hide(),t&&t.error?(this._setStatusError(),this.app.broadcast("upload."+this.p.name+".error",t,e),this.app.broadcast("upload.error",t)):(this._setStatusSuccess(),this.app.broadcast("upload."+this.p.name+".complete",t,e),this.app.broadcast("upload.complete",t),setTimeout(this._clear.bind(this),500))}}),$R.add("class","code.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==undefined?e:this._init(e)},_init:function(t){var e;if(void 0!==t){var i=$R.dom(t).closest("figure");0!==i.length?this.parse(i):(this.parse("<figure>"),this.append(t)),e=this.find("pre code, pre").last()}else e=$R.dom("<pre>"),this.parse("<figure>"),this.append(e);this._initElement(e),this._initWrapper()},_initElement:function(t){t.attr({tabindex:"-1",contenteditable:!0})},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"code",tabindex:"-1",contenteditable:!1})}}),$R.add("module","form",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector},onform:{remove:function(t){this._remove(t)}},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("form")){var n=i.getComponent(),s={remove:{title:this.lang.get("delete"),api:"module.form.remove",args:n}};e.set(t,n,s,"top")}},_remove:function(t){this.component.remove(t)}}),$R.add("class","form.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.utils=t.utils,e&&e.cmnt!==undefined?e:this._init(e)},_init:function(t){if(void 0!==t)if(0!==$R.dom(t).closest("form").length){var e=this.utils.replaceToTag(t,"figure");this.parse(e)}else this.parse("<figure>"),this.append(t);else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"form",tabindex:"-1",contenteditable:!1})}}),$R.add("module","image",{modals:{image:'<div class="redactor-modal-tab redactor-modal-tab-upload" data-title="## upload ##"><form action="">                 <input type="file" name="file">             </form></div>',imageedit:'<div class="redactor-modal-group">                 <div id="redactor-modal-image-preview" class="redactor-modal-side"></div>                 <form action="" class="redactor-modal-area">                     <div class="form-item">                         <label for="modal-image-title"> ## title ##</label>                         <input type="text" id="modal-image-title" name="title" />                     </div>                     <div class="form-item form-item-caption">                         <label for="modal-image-caption">## caption ##</label>                         <input type="text" id="modal-image-caption" name="caption" aria-label="## caption ##" />                     </div>                     <div class="form-item form-item-align">                         <label>## image-position ##</label>                         <select name="align" aria-label="## image-position ##">                             <option value="none">## none ##</option>                             <option value="left">## left ##</option>                             <option value="center">## center ##</option>                             <option value="right">## right ##</option>                         </select>                     </div>                     <div class="form-item form-item-link">                         <label for="modal-image-url">## link ##</label>                         <input type="text" id="modal-image-url" name="url" aria-label="## link ##" />                     </div>                     <div class="form-item form-item-link">                         <label class="checkbox"><input type="checkbox" name="target" aria-label="## link-in-new-tab ##"> ## link-in-new-tab ##</label>                     </div>                 </form>             </div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.justResized=!1},oninsert:function(){this._observeImages()},onstarted:function(){this.storage.observeImages(),this.opts.imageResizable&&(this.resizer=$R.create("image.resize",this.app)),this._observeImages()},ondropimage:function(t,e,i){if(this.opts.imageUpload){var n={url:this.opts.imageUpload,event:!i&&t,files:e,name:"imagedrop",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.send",n)}},onstop:function(){this.resizer&&this.resizer.stop()},onbottomclick:function(){this.insertion.insertToEnd(this.editor.getLastNode(),"image")},onimageresizer:{stop:function(){this.resizer&&this.resizer.hide()}},onsource:{open:function(){this.resizer&&this.resizer.hide()},closed:function(){this._observeImages(),this.resizer&&this.resizer.rebuild()}},onupload:{complete:function(){this._observeImages()},image:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},imageedit:{complete:function(t){this._change(t)},error:function(t){this._uploadError(t)}},imagedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}},imagereplace:{complete:function(t){this._change(t,!1)},error:function(t){this._uploadError(t)}}},onmodal:{image:{open:function(t,e){this._setUpload(t,e)}},imageedit:{open:function(t,e){this._setFormData(t,e)},opened:function(t,e){this._setFormFocus(e)},remove:function(){this._remove(this.$image)},save:function(t,e){this._save(t,e)}}},onimage:{observe:function(){this._observeImages()},resized:function(){this.justResized=!0}},oncontextbar:function(t,e){if(this.justResized)this.justResized=!1;else{var i=this.selection.getCurrent(),n=this.inspector.parse(i),s=$R.dom(i).closest("img");if(!n.isFigcaption()&&n.isComponentType("image")||0!==s.length){var r=0!==s.length?s.get():n.getComponent(),o={edit:{title:this.lang.get("edit"),api:"module.image.open"},remove:{title:this.lang.get("delete"),api:"module.image.remove",args:r}};e.set(t,r,o)}}},open:function(){this.$image=this._getCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_getModalData:function(){return this._isImage()&&this.opts.imageEditable?{name:"imageedit",width:"800px",title:this.lang.get("edit"),handle:"save",commands:{save:{title:this.lang.get("save")},remove:{title:this.lang.get("delete"),type:"danger"},cancel:{title:this.lang.get("cancel")}}}:{name:"image",title:this.lang.get("image")}},_isImage:function(){return this.$image},_getCurrent:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=$R.dom(t).closest("img");return 0!==i.length?this.component.create("image",i):!(!e.isComponentType("image")||!e.isComponentActive())&&this.component.create("image",e.getComponent())},_insert:function(t,e){if(this.app.api("module.modal.close"),Array.isArray(t)){for(var i={},n=0;n<t.length;n++)i=$R.extend(i,t[n]);t=i}else"string"==typeof t&&(t={file:{url:t}});if("object"==typeof t){var s=0;for(var r in t)"object"==typeof t[r]&&s++;1<s?this._insertMultiple(t,e):this._insertSingle(t,e)}},_insertSingle:function(t,e){for(var i in t)if("object"==typeof t[i]){var n=this._createImageAndStore(t[i]),s=e?this.insertion.insertToPoint(e,n,!1,!1):this.insertion.insertHtml(n,!1);this._removeSpaceBeforeFigure(s[0]),this.component.setActive(s[0]),this.app.broadcast("image.uploaded",s[0],t)}},_insertMultiple:function(t,e){var i,n=0,s=[];for(var r in t)if("object"==typeof t[r]){n++;var o=this._createImageAndStore(t[r]);if(1===n)s=e?this.insertion.insertToPoint(e,o,!1,!1):this.insertion.insertHtml(o,!1);else $R.dom(s[0]).after(o),s=[o.get()],this.app.broadcast("image.inserted",o);i=s[0],this._removeSpaceBeforeFigure(s[0]),this.app.broadcast("image.uploaded",s[0],t)}this.component.setActive(i)},_createImageAndStore:function(t){var e=this.component.create("image");return e.addClass("redactor-uploaded-figure"),e.setData({src:t.url,id:t.id?t.id:this.utils.getRandomId()}),this.storage.add("image",e.getElement()),e},_removeSpaceBeforeFigure:function(t){if(t){var e=t.previousSibling,i=t.nextSibling,n=$R.dom(e),s=$R.dom(i);this.opts.breakline&&(i&&"br"===s.attr("data-redactor-tag")&&s.find("br").first().remove(),e&&"br"===n.attr("data-redactor-tag")&&n.find("br").last().remove()),e&&(this._removeInvisibleSpace(e),this._removeInvisibleSpace(e.previousSibling))}},_removeInvisibleSpace:function(t){t&&3===t.nodeType&&-1!==this.utils.searchInvisibleChars(t.textContent)&&t.parentNode.removeChild(t)},_save:function(t,e){var i=e.getData(),n={title:i.title};this.opts.imageLink&&(n.link={url:i.url,target:i.target}),this.opts.imageCaption&&(n.caption=i.caption),this.opts.imagePosition&&(n.align=i.align),this.$image.setData(n),this.resizer&&this.resizer.rebuild(),this.app.broadcast("image.changed",this.$image),this.app.api("module.modal.close")},_change:function(t,e){if("string"==typeof t&&(t={file:{url:t}}),"object"==typeof t){var i;for(var n in t)if("object"==typeof t[n]){(i=$R.dom("<img>")).attr("src",t[n].url),this.$image.changeImage(t[n]),this.app.broadcast("image.changed",this.$image,t),this.app.broadcast("image.uploaded",this.$image,t),this.app.broadcast("hardsync");break}!1!==e&&i.on("load",function(){this.$previewBox.html(i)}.bind(this))}},_uploadError:function(t){this.app.broadcast("image.uploadError",t)},_remove:function(t){this.app.api("module.modal.close"),this.component.remove(t)},_observeImages:function(){var t=this.editor.getElement(),i=this;t.find("img").each(function(t){var e=$R.dom(t);e.off(".drop-to-replace"),e.on("dragover.drop-to-replace dragenter.drop-to-replace",function(t){t.preventDefault()}),e.on("drop.drop-to-replace",function(t){if(!i.app.isDragComponentInside())return i._setReplaceUpload(t,e)})})},_setFormData:function(t,e){this._buildPreview(t),this._buildPreviewUpload();var i=this.$image.getData(),n={title:i.title};this.opts.imageCaption?n.caption=i.caption:t.find(".form-item-caption").hide(),this.opts.imagePosition?n.align=i.align:t.find(".form-item-align").hide(),this.opts.imageLink?i.link&&(n.url=i.link.url,i.link.target&&(n.target=!0)):t.find(".form-item-link").hide(),e.setData(n)},_setFormFocus:function(t){t.getField("title").focus()},_setReplaceUpload:function(t,e){if((t=t.originalEvent||t).stopPropagation(),t.preventDefault(),this.opts.imageUpload){this.$image=this.component.create("image",e);var i={url:this.opts.imageUpload,files:t.dataTransfer.files,name:"imagereplace",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.send",i)}},_setUpload:function(t,e){this.opts.imageUpload||t.getBody().find(".redactor-modal-tab-upload").remove();var i={url:this.opts.imageUpload,element:e.getField("file"),name:"image",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.build",i)},_buildPreview:function(t){this.$preview=t.find("#redactor-modal-image-preview");var e=this.$image.getData(),i=$R.dom("<img>");i.attr("src",e.src),this.$previewBox=$R.dom("<div>"),this.$previewBox.append(i),this.$preview.html(""),this.$preview.append(this.$previewBox)},_buildPreviewUpload:function(){if(this.opts.imageUpload){var t=$R.dom('<div class="desc">');t.html(this.lang.get("upload-change-label")),this.$preview.append(t);var e={url:this.opts.imageUpload,element:this.$previewBox,name:"imageedit",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.build",e)}}}),$R.add("class","image.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,this.selection=t.selection,e&&e.cmnt!==undefined?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["src","title","caption","align","link","id"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},getElement:function(){return this.$element},changeImage:function(t){this.$element.attr("src",t.url)},_init:function(t){var e=$R.dom(t),i=e.closest("figure");t===undefined?(this.$element=$R.dom("<img>"),this.parse("<figure>"),this.append(this.$element)):0===i.length?(this.parse("<figure>"),this.$element=e,this.$element.wrap(this)):(this.parse(i),this.$element=this.find("img")),this._initWrapper()},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_set_src:function(t){this.$element.attr("src",t)},_set_id:function(t){this.opts.imageObserve&&this.$element.attr("data-image",t)},_set_title:function(t){""===(t=t.trim().replace(/(<([^>]+)>)/gi,""))?this.$element.removeAttr("alt"):this.$element.attr("alt",t)},_set_caption:function(t){var e=this.find("figcaption");return 0===e.length&&((e=$R.dom("<figcaption>")).attr("contenteditable","true"),this.append(e)),""===t?e.remove():e.html(t),e},_set_align:function(t){var e="",i="",n="",s=this,r=this.find("img"),o=this.find("figcaption");if("object"==typeof this.opts.imagePosition){var a=this.opts.imagePosition;for(var l in a)s.removeClass(a[l]);var c="undefined"!=typeof a[t]&&a[t];c&&s.addClass(c)}else{var d=r.width();switch(t){case"left":e="left",i="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":e="right",i="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":n="center"}s.css({"float":e,width:d+"px",maxWidth:d+"px",margin:i,"text-align":n}),s.attr("rel",s.attr("style")),"none"===t&&(s.css("max-width",""),s.css("width","")),"center"===t?(s.css("max-width",""),s.css("width",""),o.css("text-align","center")):o.css("text-align","")}},_set_link:function(t){var e=this._findLink();if(""!==t.url)return e||(e=$R.dom("<a>"),this.$element.wrap(e)),e.attr("href",t.url),t.target?e.attr("target",!0===t.target?"_blank":t.target):e.removeAttr("target"),e;e&&e.unwrap()},_get_src:function(){return this.$element.attr("src")},_get_id:function(){return this.$element.attr("data-image")},_get_title:function(){var t=this.$element.attr("alt");return t||""},_get_caption:function(){var t=this.find("figcaption");return 0===t.length?"":t.html()},_get_align:function(){var t="";if("object"==typeof this.opts.imagePosition){t="none";var e=this.opts.imagePosition;for(var i in e)if(this.hasClass(e[i])){t=i;break}}else t="center"===this.css("text-align")?"center":this.css("float");return t},_get_link:function(){var t=this._findLink();if(t){var e=!!t.attr("target");return{url:t.attr("href"),target:e}}},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"image",tabindex:"-1",contenteditable:!1})},_findLink:function(){var t=this.find("a").filter(function(t){return 0===$R.dom(t).closest("figcaption").length});return 0!==t.length&&t}}),$R.add("class","image.resize",{init:function(t){this.app=t,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.inspector=t.inspector,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body,this._init()},rebuild:function(){this._setResizerPosition()},hide:function(){this.$target.find("#redactor-image-resizer").remove()},stop:function(){this.editor.getElement().off(".redactor.image-resize"),this.$doc.off(".redactor.image-resize"),this.$win.off("resize.redactor.image-resize"),this.hide()},_init:function(){this.editor.getElement().on("click.redactor.image-resize",this._build.bind(this)),this.$win.on("resize.redactor.image-resize",this._setResizerPosition.bind(this))},_build:function(t){this.$target.find("#redactor-image-resizer").remove();var e=this.inspector.parse(t.target),i=this.editor.getElement();e.isComponentType("image")&&(this.$resizableBox=i,this.$resizableImage=$R.dom(e.getImageElement()),this.$resizer=$R.dom("<span>"),this.$resizer.attr("id","redactor-image-resizer"),this.$target.append(this.$resizer),this._setResizerPosition(),this.$resizer.on("mousedown touchstart",this._set.bind(this)))},_setResizerPosition:function(){if(this.$resizer){var t=this.toolbar.isTarget(),e=this.$target.offset(),i=7,n=t?i-e.top+this.$target.scrollTop():i,s=t?i-e.left:i,r=this.$resizableImage.offset(),o=this.$resizableImage.width(),a=this.$resizableImage.height(),l=this.$resizer.width(),c=this.$resizer.height();this.$resizer.css({top:Math.round(r.top+a-c+n)+"px",left:Math.round(r.left+o-l+s)+"px"})}},_set:function(t){t.preventDefault(),this.resizeHandle={x:t.pageX,y:t.pageY,el:this.$resizableImage,$figure:this.$resizableImage.closest("figure"),ratio:this.$resizableImage.width()/this.$resizableImage.height(),h:this.$resizableImage.height()},(t=t.originalEvent||t).targetTouches&&(this.resizeHandle.x=t.targetTouches[0].pageX,this.resizeHandle.y=t.targetTouches[0].pageY),this.app.broadcast("contextbar.close"),this.app.broadcast("image.resize",this.$resizableImage),this._start()},_start:function(){this.$doc.on("mousemove.redactor.image-resize touchmove.redactor.image-resize",this._move.bind(this)),this.$doc.on("mouseup.redactor.image-resize touchend.redactor.image-resize",this._stop.bind(this))},_stop:function(){this.$doc.off(".redactor.image-resize"),this.app.broadcast("image.resized",this.$resizableImage)},_move:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.resizeHandle.h;t.targetTouches?e+=t.targetTouches[0].pageY-this.resizeHandle.y:e+=t.pageY-this.resizeHandle.y;var i=e*this.resizeHandle.ratio;i=Math.round(i),(e=Math.round(e))<20||i<100||this._getResizableBoxWidth()<=i||(0!==this.resizeHandle.$figure.length&&""!==this.resizeHandle.$figure.css("max-width")&&this.resizeHandle.$figure.css("max-width",i+"px"),this.resizeHandle.el.attr({width:i,height:e}),this.resizeHandle.el.width(i),this.resizeHandle.el.height(e),this._setResizerPosition())},_getResizableBoxWidth:function(){return this.$resizableBox.width()-parseInt(this.$resizableBox.css("padding-left"))-parseInt(this.$resizableBox.css("padding-right"))}}),$R.add("module","file",{modals:{file:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <div class="form-item form-item-title">                     <label for="modal-file-title"> ## filename ## <span class="desc">(## optional ##)</span></label>                     <input type="text" id="modal-file-title" name="title" />                 </div>                 <input type="file" name="file">             </form></div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection},onstarted:function(){this.storage.observeFiles()},ondropfile:function(t,e,i){if(this.opts.fileUpload){var n={url:this.opts.fileUpload,event:!i&&t,files:e,name:"filedrop",data:this.opts.fileData};this.app.api("module.upload.send",n)}},onmodal:{file:{open:function(t,e){this._setFormData(t,e),this._setUpload(e)},opened:function(t,e){this._setFormFocus(e),this.$form=e}}},onupload:{file:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},filedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}}},open:function(){this._open()},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_open:function(){this.app.api("module.modal.build",this._getModalData())},_getModalData:function(){return{name:"file",title:this.lang.get("file")}},_insert:function(t,e){if(this.app.api("module.modal.close"),"object"==typeof t){if(Array.isArray(t)){for(var i={},n=0;n<t.length;n++)i=$R.extend(i,t[n]);t=i}1<Object.keys(t).length?this._insertMultiple(t,e):this._insertSingle(t,e),this.$form=!1}},_insertSingle:function(t,e){var i=[];for(var n in t){var s=this._createFileAndStore(t[n]);i=this.opts.fileAttachment?this._insertAsAttachment(s):e?this.insertion.insertToPoint(e,s):this.insertion.insertRaw(s),this.app.broadcast("file.uploaded",i[0],t)}},_insertMultiple:function(t,e){var i,n=0,s=[];for(var r in t){n++;var o=this._createFileAndStore(t[r]);if(this.opts.fileAttachment)s=this._insertAsAttachment(o,t);else if(1===n)s=e?this.insertion.insertToPoint(e,o):this.insertion.insertRaw(o);else $R.dom(s[0]).after(o).after(" "),s=[o.get()],this.app.broadcast("file.inserted",o);i=o,this.app.broadcast("file.uploaded",s[0],t)}this.opts.fileAttachment||this.caret.setAfter(i)},_insertAsAttachment:function(t,e){var i=$R.dom(this.opts.fileAttachment),n=t.wrapAttachment();i.append(n);var s=[n.get()];return this.app.broadcast("file.appended",s[0],e),s},_createFileAndStore:function(t){var e=!!this.$form&&this.$form.getData(),i=t.name?t.name:t.url,n=!this.opts.fileAttachment&&e&&""!==e.title?e.title:this._truncateUrl(i),s=this.component.create("file");return s.attr("href",t.url),s.attr("data-file",t.id?t.id:this.utils.getRandomId()),s.attr("data-name",t.name),s.html(n),this.storage.add("file",s),s},_remove:function(t){this.selection.save();var e=this.component.create("file",t);!1!==this.app.broadcast("file.delete",e)?(e.unwrap(),this.selection.restore(),this.app.broadcast("file.deleted",e)):this.selection.restore()},_truncateUrl:function(t){return-1!==t.search(/^http/)&&20<t.length?t.substring(0,20)+"...":t},_setUpload:function(t){var e={url:this.opts.fileUpload,element:t.getField("file"),name:"file",data:this.opts.fileData,paramName:this.opts.fileUploadParam};this.app.api("module.upload.build",e)},_setFormData:function(t,e){this.opts.fileAttachment?t.find(".form-item-title").hide():e.setData({title:this.selection.getText()})},_setFormFocus:function(t){t.getField("title").focus()},
_uploadError:function(t){this.app.broadcast("file.uploadError",t)}}),$R.add("class","file.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,e&&e.cmnt!==undefined?e:this._init(e)},wrapAttachment:function(){return this.$wrapper=$R.dom('<span class="redactor-file-item">'),this.$remover=$R.dom('<span class="redactor-file-remover">'),this.$remover.html("&times;"),this.$remover.on("click",this.removeAttachment.bind(this)),this.$wrapper.append(this),this.$wrapper.append(this.$remover),this.$wrapper},removeAttachment:function(t){t.preventDefault(),!1!==this.app.broadcast("file.delete",this,this.$wrapper)&&(this.$wrapper.remove(),this.app.broadcast("file.deleted",this),this.app.broadcast("file.removeAttachment",this))},_init:function(t){if(t===undefined)this.parse("<a>");else{var e=$R.dom(t).closest("a");this.parse(e)}}}),$R.add("module","buffer",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.offset=t.offset,this.keycodes=t.keycodes,this.selection=t.selection,this.state=!1,this.passed=!1,this.keyPressed=!1,this.undoStorage=[],this.redoStorage=[]},onkeydown:function(t){this._listen(t)},onsyncing:function(){this.keyPressed||this.trigger(),this.keyPressed=!1},onbuffer:{trigger:function(){this.trigger()}},onstate:function(t,e,i){t&&(t.ctrlKey||t.metaKey)||t&&(this._isUndo(t)||this._isRedo(t))||(this.passed=!1,this._saveState(e,i))},onenable:function(){this.clear()},clear:function(){this.state=!1,this.undoStorage=[],this.redoStorage=[]},undo:function(){this._getUndo()},redo:function(){this._getRedo()},trigger:function(){this.state&&!1===this.passed&&this._setUndo()},_saveState:function(t,e){var i=this.editor.getElement();this.state={html:t||i.html(),offset:e||this.offset.get()}},_listen:function(t){var e=t.which,i=t.ctrlKey||t.metaKey,n=i||t.shiftKey||t.altKey,s=[this.keycodes.SPACE,this.keycodes.ENTER,this.keycodes.BACKSPACE,this.keycodes.DELETE,this.keycodes.TAB,this.keycodes.LEFT,this.keycodes.RIGHT,this.keycodes.UP,this.keycodes.DOWN];return this._isUndo(t)?(t.preventDefault(),void this.undo()):this._isRedo(t)?(t.preventDefault(),void this.redo()):((i||-1===s.indexOf(e))&&(!i||88!==e&&67!==e)||(n=!0,this.trigger()),n||this._hasUndo()||this.trigger(),void(this.keyPressed=!0))},_isUndo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&90===e&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(90===e&&t.shiftKey||89===e&&!t.shiftKey)&&!t.altKey},_setUndo:function(){var t=this.undoStorage[this.undoStorage.length-1];void 0!==t&&t[0]===this.state.html||(this.undoStorage.push([this.state.html,this.state.offset]),this._removeOverStorage())},_setRedo:function(){var t=this.editor.getElement(),e=this.offset.get(),i=t.html();this.redoStorage.push([i,e]),this.redoStorage=this.redoStorage.slice(0,this.opts.bufferLimit)},_getUndo:function(){if(this._hasUndo()){this.passed=!0;var t=this.editor.getElement(),e=this.undoStorage.pop();this._setRedo(),t.html(e[0]),this.offset.set(e[1]),this.selection.restore(),this.app.broadcast("undo",e[0],e[1])}},_getRedo:function(){if(this._hasRedo()){this.passed=!0;var t=this.editor.getElement(),e=this.redoStorage.pop();this._setUndo(),t.html(e[0]),this.offset.set(e[1]),this.app.broadcast("redo",e[0],e[1])}},_removeOverStorage:function(){this.undoStorage.length>this.opts.bufferLimit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.bufferLimit))},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length}}),$R.add("module","list",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.block=t.block,this.toolbar=t.toolbar,this.inspector=t.inspector,this.selection=t.selection},onbutton:{list:{observe:function(t){this._observeButton(t)}}},ondropdown:{list:{observe:function(t){this._observeDropdown(t)}}},toggle:function(t){var e=this._getBlocks(),i=this.selection.getBlock(),n=$R.dom(i).parents("ul, ol",".redactor-in-"+this.uuid).last();return 0===e.length&&0!==n.length&&(e=[n.get()]),!i||"TD"!==i.tagName&&"TH"!==i.tagName||(e=this.block.format("div")),this.selection.saveMarkers(),e=0!==e.length&&this._isUnformat(t,e)?this._unformat(t,e):this._format(t,e),this.selection.restoreMarkers(),e},indent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),n=!!i.isList()&&i.getListItem(),s=$R.dom(n),r=s.prevElement(),o=r.get();if(t&&n&&o&&"LI"===o.tagName){this.selection.saveMarkers();var a=(r=$R.dom(o)).children("ul, ol"),l=s.closest("ul, ol");if(0!==a.length)a.append(s);else{var c=l.get().tagName.toLowerCase(),d=$R.dom("<"+c+">");d.append(s),r.append(d)}this.selection.restoreMarkers()}},outdent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),n=!!i.isList()&&i.getListItem(),s=$R.dom(n);if(t&&n){var r,o,a,l=s.parent(),c=l.closest("li",".redactor-in-"+this.uuid),d=s.prevElement(),h=s.nextElement(),u=d.get(),p=h.get(),f=!1===u,m=!1!==u&&!1!==p,g=!f&&!1===p;if(this.selection.saveMarkers(),0!==c.length)if(m){r=this._getAllNext(s.get()),a=$R.dom("<"+l.get().tagName.toLowerCase()+">");for(var v=0;v<r.length;v++)a.append(r[v]);c.after(s),s.append(a)}else c.after(s),0===l.children().length?l.remove():f&&s.append(l);else{var b=this._createUnformatContainer(s),y=b.find("ul, ol").first();if(f)l.before(b);else if(g)l.after(b);else if(m){a=$R.dom("<"+l.get().tagName.toLowerCase()+">"),r=this._getAllNext(s.get());for(v=0;v<r.length;v++)a.append(r[v]);l.after(b),b.after(a)}0!==y.length&&((o=b.nextElement().get())&&o.tagName===l.get().tagName?($R.dom(o).prepend(y),y.unwrap()):b.after(y)),s.remove()}this.selection.restoreMarkers()}},_getAllNext:function(t){for(var e=[];t;){if(!(t=$R.dom(t).nextElement().get()))return e;e.push(t)}return e},_isUnformat:function(t,e){for(var i=0,n=0;n<e.length;n++)if(3!==e[n].nodeType){var s=e[n].tagName.toLowerCase();s!==t&&"figure"!==s||i++}return i===e.length},_format:function(t,e){var i=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6","ul","ol"],n=this._uniteBlocks(e,i),s=[];for(var r in n){for(var o=n[r],a=this._createList(t,n[r]),l=0;l<o.length;l++){var c;if(3===o[l].nodeType||"UL"!==o[l].tagName&&"OL"!==o[l].tagName)c=this._createListItem(o[l]),this.utils.normalizeTextNodes(c),a.append(c);else{var d=$R.dom(o[l]);c=d.contents(),a.append(c),this.utils.isEmpty(d)&&d.remove()}}s.push(a.get())}return s},_uniteBlocks:function(t,e){for(var i=0,n={0:[]},s=!1,r=0;r<t.length;r++){var o=$R.dom(t[r]).closest("th, td");0!==o.length?(o.get()!==s&&(n[++i]=[]),this._isUniteBlock(t[r],e)&&n[i].push(t[r])):this._isUniteBlock(t[r],e)?n[i].push(t[r]):n[++i]=[],s=o.get()}return n},_isUniteBlock:function(t,e){return 3===t.nodeType||-1!==e.indexOf(t.tagName.toLowerCase())},_createList:function(t,e){var i=e[e.length-1],n=$R.dom(i),s=$R.dom("<"+t+">");return n.after(s),s},_createListItem:function(t){var e=$R.dom("<li>");if(3===t.nodeType)e.append(t);else{var i=$R.dom(t);e.append(i.contents()),i.remove()}return e},_unformat:function(t,e){if(1===e.length){var i=$R.dom(e[0]),n=i.find("li"),s=this.selection.getNodes({tags:["li"]}),r=this.selection.getBlock(),o=$R.dom(r).closest("li");if(0===s.length&&0!==o.length&&(s=[o.get()]),s.length===n.length)return this._unformatEntire(e[0]);var a=this._getItemsPosition(n,s);if("Top"===a)return this._unformatAtSide("before",s,i);if("Bottom"===a)return s.reverse(),this._unformatAtSide("after",s,i);if("Middle"===a){var l=$R.dom(s[s.length-1]),c=!1,d=!1,h=$R.dom("<"+i.get().tagName.toLowerCase()+">");n.each(function(t){if(c){var e=$R.dom(t);0!==e.closest(".redactor-split-item").length||!1!==d&&0!==e.closest(d).length||e.addClass("redactor-split-item"),d=e}t===l.get()&&(c=!0)}),n.filter(".redactor-split-item").each(function(t){$R.dom(t).removeClass("redactor-split-item"),h.append(t)}),i.after(h),s.reverse();for(var u=0;u<s.length;u++){var p=$R.dom(s[u]),f=this._createUnformatContainer(p);i.after(f),f.find("ul, ol").remove(),p.remove()}return}}else for(u=0;u<e.length;u++)3!==e[u].nodeType&&e[u].tagName.toLowerCase()===t&&this._unformatEntire(e[u])},_unformatEntire:function(t){var n=$R.dom(t);n.find("li").each(function(t){var e=$R.dom(t),i=this._createUnformatContainer(e);e.remove(),n.before(i)}.bind(this)),n.remove()},_unformatAtSide:function(t,n,e){for(var s=0;s<n.length;s++){var i=$R.dom(n[s]),r=this._createUnformatContainer(i);e[t](r);var o=r.find("ul, ol").first();i.append(o),o.each(function(t){var e=$R.dom(t),i=e.closest("li");i.get()===n[s]&&(e.unwrap(),i.addClass("r-unwrapped"))}),this.utils.isEmptyHtml(i.html())&&i.remove()}e.find(".r-unwrapped").each(function(t){var e=$R.dom(t);""===e.html().trim()?e.remove():e.removeClass("r-unwrapped")})},_getItemsPosition:function(t,e){var i="Middle",n=e[0],s=e[e.length-1],r=t.first().get(),o=t.last().get();return r===n&&o!==s?i="Top":r!==n&&o===s&&(i="Bottom"),i},_createUnformatContainer:function(t){var e=$R.dom("<"+this.opts.markup+">");return this.opts.breakline&&e.attr("data-redactor-tag","br"),e.append(t.contents()),e},_getBlocks:function(){return this.selection.getBlocks({first:!0})},_observeButton:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=e.isPre()||e.isCode()||e.isFigcaption();this._observeButtonsList(i,["lists","ul","ol","outdent","indent"]);var n=this.toolbar.getButton("outdent"),s=this.toolbar.getButton("indent");this._observeIndent(s,n)},_observeDropdown:function(t){var e=t.getItem("outdent"),i=t.getItem("indent");this._observeIndent(i,e)},_observeIndent:function(t,e){var i=this.selection.isCollapsed(),n=this.selection.getCurrent(),s=this.inspector.parse(n),r=!!s.isList()&&s.getListItem(),o=$R.dom(r).prevElement().get(),a=i&&r&&o&&"LI"===o.tagName;e&&(r&&i?e.enable():e.disable()),t&&(r&&a?t.enable():t.disable())},_observeButtonsList:function(t,e){for(var i=0;i<e.length;i++){var n=this.toolbar.getButton(e[i]);n&&(t?n.disable():n.enable())}}}),$R.add("class","video.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==undefined?e:this._init(e)},_init:function(t){if(void 0!==t){var e=$R.dom(t).closest("figure");0!==e.length?this.parse(e):(this.parse("<figure>"),this.append(t))}else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"video",tabindex:"-1",contenteditable:!1})}}),$R.add("class","widget.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==undefined?e:this._init(e)},getData:function(){return{html:this._getHtml()}},_init:function(t){if(void 0!==t){var e=$R.dom(t).closest("figure");0!==e.length?this.parse(e):(this.parse("<figure>"),this.html(t))}else this.parse("<figure>");this._initWrapper()},_getHtml:function(){var t=$R.dom("<div>");return t.html(this.html()),t.find(".redactor-component-caret").remove(),t.html()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"widget",tabindex:"-1",contenteditable:!1})}}),window.Redactor=window.$R=$R,window.addEventListener("load",function(){$R("[data-redactor]")}),"object"==typeof module&&module.exports&&(module.exports=Redactor,module.exports.Redactor=Redactor)}(),Redactor.add("plugin","alignment",{translations:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.block=t.block,this.toolbar=t.toolbar},start:function(){var t={};t.left={title:this.lang.get("align-left"),api:"plugin.alignment.set",args:"left"},t.center={title:this.lang.get("align-center"),api:"plugin.alignment.set",args:"center"},t.right={title:this.lang.get("align-right"),api:"plugin.alignment.set",args:"right"},t.justify={title:this.lang.get("align-justify"),api:"plugin.alignment.set",args:"justify"};var e=this.toolbar.addButtonAfter("sup","alignment",{title:this.lang.get("align")});e.setIcon('<i class="re-icon-alignment"></i>'),e.setDropdown(t)},set:function(t){if("left"===t&&"ltr"===this.opts.direction)return this._remove();var e={style:{"text-align":t}};this.block.toggle(e)},_remove:function(){this.block.remove({style:"text-align"})}}),function(d){d.add("plugin","fontcolor",{translations:{en:{fontcolor:"Text Color",text:"Text",highlight:"Highlight"}},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.inline=t.inline,this.toolbar=t.toolbar,this.selection=t.selection,this.colors=this.opts.fontcolors?this.opts.fontcolors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"]},onfontcolor:{set:function(t,e){this._set(t,e)},remove:function(t){this._remove(t)}},start:function(){var t={title:this.lang.get("fontcolor")},e=this._buildDropdown();this.$button=this.toolbar.addButtonAfter("sup","fontcolor",t),this.$button.setIcon('<i class="re-icon-fontcolor"></i>'),this.$button.setDropdown(e)},_buildDropdown:function(){var t=d.dom('<div class="redactor-dropdown-cells">');return this.$selector=this._buildSelector(),this.$selectorText=this._buildSelectorItem("text",this.lang.get("text")),this.$selectorText.addClass("active"),this.$selectorBack=this._buildSelectorItem("back",this.lang.get("highlight")),this.$selector.append(this.$selectorText),this.$selector.append(this.$selectorBack),this.$pickerText=this._buildPicker("textcolor"),this.$pickerBack=this._buildPicker("backcolor"),t.append(this.$selector),t.append(this.$pickerText),t.append(this.$pickerBack),this._buildSelectorEvents(),t.width(242),t},_buildSelector:function(){var t=d.dom("<div>");return t.addClass("redactor-dropdown-selector"),t},_buildSelectorItem:function(t,e){var i=d.dom("<span>");return i.attr("rel",t).html(e),i.addClass("redactor-dropdown-not-close"),i},_buildSelectorEvents:function(){this.$selectorText.on("mousedown",function(t){t.preventDefault(),this.$selector.find("span").removeClass("active"),this.$pickerBack.hide(),this.$pickerText.show(),this.$selectorText.addClass("active")}.bind(this)),this.$selectorBack.on("mousedown",function(t){t.preventDefault(),this.$selector.find("span").removeClass("active"),this.$pickerText.hide(),this.$pickerBack.show(),this.$selectorBack.addClass("active")}.bind(this))},_buildPicker:function(t){for(var e=d.dom('<div class="re-dropdown-box-'+t+'">'),i="backcolor"==t?"background-color":"color",n=this.colors.length,s=this,r=function(t){t.preventDefault();var e=d.dom(t.target);s._set(e.data("rule"),e.attr("rel"))},o=0;o<n;o++){var a=this.colors[o],l=d.dom("<span>");l.attr({rel:a,"data-rule":i}),l.css({"background-color":a,"font-size":0,border:"2px solid #fff",width:"22px",height:"22px"}),l.on("mousedown",r),e.append(l)}var c=d.dom("<a>");return c.attr({href:"#"}),c.css({display:"block",clear:"both",padding:"8px 5px","font-size":"12px","line-height":1}),c.html(this.lang.get("none")),c.on("click",function(t){t.preventDefault(),s._remove(i)}),e.append(c),"backcolor"==t&&e.hide(),e},_set:function(t,e){var i={};i[t]=e;var n={tag:"span",style:i,type:"toggle"};this.inline.format(n)},_remove:function(t){this.inline.remove({style:t})}})}(Redactor),Redactor.add("plugin","fontsize",{translations:{en:{size:"Size","remove-size":"Remove Font Size"}},init:function(t){this.app=t,this.lang=t.lang,this.inline=t.inline,this.toolbar=t.toolbar,this.sizes=[10,11,12,14,16,18,20,24,28,30]},start:function(){for(var t={},e=0;e<this.sizes.length;e++){var i=this.sizes[e];t[e]={title:i+"px",api:"plugin.fontsize.set",args:i}}t.remove={title:this.lang.get("remove-size"),api:"plugin.fontsize.remove"};var n=this.toolbar.addButtonAfter("sup","fontsize",{title:this.lang.get("size")});n.setIcon('<i class="re-icon-fontsize"></i>'),n.setDropdown(t)},set:function(t){var e={tag:"span",style:{"font-size":t+"px"},type:"toggle"};this.inline.format(e)},remove:function(){this.inline.remove({style:"font-size"})}}),function(r){r.add("plugin","table",{translations:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(t){this.app=t,this.lang=t.lang,this.opts=t.opts,this.caret=t.caret,this.editor=t.editor,this.toolbar=t.toolbar,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection},ondropdown:{table:{observe:function(t){this._observeDropdown(t)}}},onbottomclick:function(){this.insertion.insertToEnd(this.editor.getLastNode(),"table")},start:function(){var t={observe:"table","insert-table":{title:this.lang.get("insert-table"),api:"plugin.table.insert"},"insert-row-above":{title:this.lang.get("insert-row-above"),classname:"redactor-table-item-observable",api:"plugin.table.addRowAbove"},"insert-row-below":{title:this.lang.get("insert-row-below"),classname:"redactor-table-item-observable",api:"plugin.table.addRowBelow"},"insert-column-left":{title:this.lang.get("insert-column-left"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnLeft"},"insert-column-right":{title:this.lang.get("insert-column-right"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnRight"},"add-head":{title:this.lang.get("add-head"),classname:"redactor-table-item-observable",api:"plugin.table.addHead"},"delete-head":{title:this.lang.get("delete-head"),classname:"redactor-table-item-observable",api:"plugin.table.deleteHead"},"delete-column":{title:this.lang.get("delete-column"),classname:"redactor-table-item-observable",api:"plugin.table.deleteColumn"},"delete-row":{title:this.lang.get("delete-row"),classname:"redactor-table-item-observable",api:"plugin.table.deleteRow"},"delete-table":{title:this.lang.get("delete-table"),classname:"redactor-table-item-observable",api:"plugin.table.deleteTable"}},e={title:this.lang.get("table")},i=this.toolbar.addButtonAfter("lists","table",e);i.setIcon('<i class="re-icon-table"></i>'),i.setDropdown(t)},insert:function(){for(var t=2,e=3,i=this.component.create("table"),n=0;n<t;n++)i.addRow(e);i=this.insertion.insertHtml(i),this.caret.setStart(i)},addRowAbove:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent(),i=t.addRowTo(e,"before");this.caret.setStart(i)}},addRowBelow:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent(),i=t.addRowTo(e,"after");this.caret.setStart(i)}},addColumnLeft:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent();this.selection.save(),t.addColumnTo(e,"left"),this.selection.restore()}},addColumnRight:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent();this.selection.save(),t.addColumnTo(e,"right"),this.selection.restore()}},addHead:function(){var t=this._getComponent();t&&(this.selection.save(),t.addHead(),this.selection.restore())},deleteHead:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent();0!==r.dom(e).closest("thead").length?(t.removeHead(),this.caret.setStart(t)):(this.selection.save(),t.removeHead(),this.selection.restore())}},deleteColumn:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent(),i=r.dom(e).closest("td, th"),n=i.nextElement().get(),s=i.prevElement().get();t.removeColumn(e),n?this.caret.setStart(n):s?this.caret.setEnd(s):this.deleteTable()}},deleteRow:function(){var t=this._getComponent();if(t){var e=this.selection.getCurrent(),i=r.dom(e).closest("tr"),n=i.nextElement().get(),s=i.prevElement().get();t.removeRow(e),n?this.caret.setStart(n):s?this.caret.setEnd(s):this.deleteTable()}},deleteTable:function(){var t=this._getTable();t&&this.component.remove(t)},_getTable:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t);if(e.isTable())return e.getTable()},_getComponent:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t);if(e.isTable()){var i=e.getTable();return this.component.create("table",i)}},_observeDropdown:function(t){var e=this._getTable(),i=t.getItemsByClass("redactor-table-item-observable"),n=t.getItem("insert-table");e?(this._observeItems(i,"enable"),n.disable()):(this._observeItems(i,"disable"),n.enable())},_observeItems:function(t,e){for(var i=0;i<t.length;i++)t[i][e]()}})}(Redactor),function(o){o.add("class","table.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==undefined?e:this._init(e)},addHead:function(){this.removeHead();var t=this.$element.find("tr").first().children("td, th").length,e=o.dom("<thead>"),i=this._buildRow(t,"<th>");e.append(i),this.$element.prepend(e)},addRow:function(t){var e=this._buildRow(t);return this.$element.append(e),e},addRowTo:function(t,e){return this._addRowTo(t,e)},addColumnTo:function(t,s){var e=o.dom(t),i=e.closest("tr"),n=e.closest("td, th"),r=0;i.find("td, th").each(function(t,e){t===n.get()&&(r=e)}),this.$element.find("tr").each(function(t){var e=o.dom(t).find("td, th").get(r),i=o.dom(e),n=i.clone();n.html(""),"right"===s?i.after(n):i.before(n)})},removeHead:function(){var t=this.$element.find("thead");0!==t.length&&t.remove()},removeRow:function(t){o.dom(t).closest("tr").remove()},removeColumn:function(t){var e=o.dom(t),i=e.closest("tr"),n=e.closest("td, th"),s=0;i.find("td, th").each(function(t,e){t===n.get()&&(s=e)}),this.$element.find("tr").each(function(t){var e=o.dom(t).find("td, th").get(s);o.dom(e).remove()})},_init:function(t){var e,i;if(void 0!==t){var n=o.dom(t),s=n.get(),r=n.closest("figure");0!==r.length?i=(e=r).find("table").get():"TABLE"===s.tagName&&(i=s)}this._buildWrapper(e),this._buildElement(i),this._initWrapper()},_addRowTo:function(t,e){var i=o.dom(t).closest("tr");if(0!==i.length){var n=i.children("td, th").length,s=this._buildRow(n);return i[e](s),s}},_buildRow:function(t,e){e=e||"<td>";for(var i=o.dom("<tr>"),n=0;n<t;n++){var s=o.dom(e);s.attr("contenteditable",!0),i.append(s)}return i},_buildElement:function(t){t?this.$element=o.dom(t):(this.$element=o.dom("<table>"),this.append(this.$element))},_buildWrapper:function(t){t=t||"<figure>",this.parse(t)},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"table",tabindex:"-1",contenteditable:!1}),this.app.detector.isIe()&&this.removeAttr("contenteditable")}})}(Redactor),Redactor.add("plugin","video",{translations:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},modals:{video:'<form action="">                     <div class="form-item">                         <label for="modal-video-input">## video-html-code ##</label>                         <textarea id="modal-video-input" name="video" style="height: 160px;"></textarea>                     </div>                 </form>'},init:function(t){this.app=t,this.lang=t.lang,this.opts=t.opts,this.toolbar=t.toolbar,this.component=t.component,this.insertion=t.insertion,this.inspector=t.inspector},onmodal:{video:{opened:function(t,e){e.getField("video").focus()},insert:function(t,e){var i=e.getData();this._insert(i)}}},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("video")){var n=i.getComponent(),s={remove:{title:this.lang.get("delete"),api:"plugin.video.remove",args:n}};e.set(t,n,s,"bottom")}},start:function(){var t={title:this.lang.get("video"),api:"plugin.video.open"};this.toolbar.addButtonAfter("image","video",t).setIcon('<i class="re-icon-video"></i>')},open:function(){var t={title:this.lang.get("video"),width:"600px",name:"video",handle:"insert",commands:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}}};this.app.api("module.modal.build",t)},remove:function(t){this.component.remove(t)},_insert:function(t){if(this.app.api("module.modal.close"),""!==t.video.trim()&&(t.video=this._matchData(t.video),this._isVideoIframe(t.video))){var e=this.component.create("video",t.video);this.insertion.insertHtml(e)}},_isVideoIframe:function(t){return null!==t.match(/<iframe|<video/gi)},_matchData:function(t){var e='<iframe style="width: 500px; height: 281px;" src="',i='" frameborder="0" allowfullscreen></iframe>';if(this._isVideoIframe(t)){var n=["iframe","video","source"],s=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;t=(t=t.replace(/<p(.*?[^>]?)>([\w\W]*?)<\/p>/gi,"")).replace(s,function(t,e){return-1===n.indexOf(e.toLowerCase())?"":t})}else t.match(this.opts.regex.youtube)?t=t.replace(this.opts.regex.youtube,e+"//www.youtube.com/embed/$1"+i):t.match(this.opts.regex.vimeo)&&(t=t.replace(this.opts.regex.vimeo,e+"//player.vimeo.com/video/$2"+i));return t}}),Redactor.add("plugin","widget",{translations:{en:{widget:"Widget","widget-html-code":"Widget HTML Code"}},modals:{widget:'<form action="">                     <div class="form-item">                         <label for="modal-widget-input">## widget-html-code ##</label>                         <textarea id="modal-widget-input" name="widget" style="height: 200px;"></textarea>                     </div>                 </form>'},init:function(t){this.app=t,this.lang=t.lang,this.opts=t.opts,this.toolbar=t.toolbar,this.component=t.component,this.insertion=t.insertion,this.inspector=t.inspector,this.selection=t.selection},onmodal:{widget:{opened:function(t,e){if(e.getField("widget").focus(),this.$currentItem){var i=decodeURI(this.$currentItem.attr("data-widget-code"));e.getField("widget").val(i)}},insert:function(t,e){var i=e.getData();this._insert(i)}}},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(!i.isFigcaption()&&i.isComponentType("widget")){var n=i.getComponent(),s={edit:{title:this.lang.get("edit"),api:"plugin.widget.open",args:n},remove:{title:this.lang.get("delete"),api:"plugin.widget.remove",args:n}};e.set(t,n,s,"bottom")}},onbutton:{widget:{observe:function(t){this._observeButton(t)}}},start:function(){var t={title:this.lang.get("widget"),api:"plugin.widget.open",observe:"widget"};this.toolbar.addButtonBefore("html","widget",t).setIcon('<i class="re-icon-widget"></i>')},open:function(){this.$currentItem=this._getCurrent();var t={title:this.lang.get("widget"),width:"600px",name:"widget",handle:"insert",commands:{insert:{title:this.$currentItem?this.lang.get("save"):this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}}};this.app.api("module.modal.build",t)},remove:function(t){this.component.remove(t)},_getCurrent:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t);if(e.isComponentType("widget"))return this.component.build(e.getComponent())},_insert:function(t){if(this.app.api("module.modal.close"),""!==t.widget.trim()){var e=this._isHtmlString(t.widget)?t.widget:document.createTextNode(t.widget),i=this.component.create("widget",e);i.attr("data-widget-code",encodeURI(t.widget.trim())),this.insertion.insertHtml(i)}},_isHtmlString:function(t){return!("string"==typeof t&&!/^\s*<(\w+|!)[^>]*>/.test(t))},_observeButton:function(t){var e=this.selection.getCurrent();this.inspector.parse(e).isComponentType("table")?t.disable():t.enable()}}),function(s){s.add("plugin","properties",{modals:{properties:'<form action="">                     <div class="form-item">                         <label>Id</label>                         <input type="text" name="id">                     </div>                     <div class="form-item">                         <label>Class</label>                         <input type="text" name="classname">                     </div>                 </form>'},translations:{en:{properties:"Properties"}},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.$body=t.$body,this.toolbar=t.toolbar,this.inspector=t.inspector,this.selection=t.selection,this.labelStyle={"font-family":"monospace",position:"absolute",padding:"2px 5px","line-height":1,"border-radius":"3px","font-size":"11px",color:"rgba(255, 255, 255, .9)"}},onmodal:{properties:{open:function(t,e){if(this.$block){var i=this._getData(this.$block);e.setData(i)}},opened:function(t,e){e.getField("id").focus()},save:function(t,e){var i=e.getData();this._save(i)}}},onbutton:{properties:{observe:function(t){this._observeButton(t)}}},start:function(){var t={title:this.lang.get("properties"),api:"plugin.properties.open",observe:"properties"};this.toolbar.addButtonAfter("link","properties",t).setIcon('<i class="re-icon-properties"></i>'),this._createLabel()},stop:function(){this._removeLabel()},open:function(){var t=this.selection.getBlock();if(t){this.$block=s.dom(t);var e={title:this.lang.get("properties"),width:"500px",name:"properties",handle:"save",commands:{save:{title:this.lang.get("save")},cancel:{title:this.lang.get("cancel")}}};this.app.api("module.modal.build",e)}},_save:function(t){this.app.api("module.modal.close"),""===t.id?this.$block.removeAttr("id"):this.$block.attr("id",t.id),""===t.classname?this.$block.removeAttr("class"):this.$block.attr("class",t.classname)},_getData:function(t){var e=s.dom(t);return{id:e.attr("id"),classname:e.attr("class")}},_showData:function(t,e){var i="";if(e.id&&(i+="#"+e.id+" "),e.classname&&(i+="."+e.classname),""!==i){var n=s.dom(t).offset();this.$label.css({top:n.top-12+"px",left:n.left+"px","z-index":this.opts.zindex?this.opts.zindex+3:"auto"}),this.$label.html(i),this.$label.show()}else this.$label.hide()},_createLabel:function(){this.$label=s.dom("<span />"),this.$label.hide(),this.$label.css(this.labelStyle).css("background","rgba(229, 57, 143, .7)"),this.$body.append(this.$label)},_removeLabel:function(){this.$label&&this.$label.remove()},_observeButton:function(t){var e=this.selection.getBlock(),i=this.inspector.parse(e);if(e&&!i.isComponent()){var n=this._getData(e);this._showData(e,n),t.enable()}else t.disable(),this.$label&&this.$label.hide()}})}(Redactor),$(document).on("ready page:load",function(){var t,e=$("meta[name=csrf-token]").attr("content"),i=$("meta[name=csrf-param]").attr("content");i!==undefined&&e!==undefined&&(t=i+"="+encodeURIComponent(e)),$R(".custom_redactor",{path:"/assets/redactor3-rails",fileUpload:"/redactor3_rails/files?"+t,imageUpload:"/redactor3_rails/images?"+t,imageResizable:!0,imagePosition:!0,spellcheck:!0,minHeight:"450px",maxHeight:"720px",toolbarExternal:"#redactor_toolbar",plugins:["alignment","fontcolor","fontsize","table","properties","video","widget"],buttons:["format","bold","italic","sup","lists","link","image","html"]})}),$(document).on("ready page:load",function(){function t(){"blog"==$("#page_page_type").children("option:selected").val()?$("#non-blog-fields").slideUp():$("#non-blog-fields").slideDown()}t(),$("#page_page_type").change(function(){t()})});